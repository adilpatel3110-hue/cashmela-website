<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CashMela - One Fintech for all Banking and Finance Services</title>
    <meta name="description" content="One fintech company for all your banking and finance services. CashMela provides state-of-the-art digital finance solutions.">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Chart.js for Calculator -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- jsPDF for PDF Download -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

    <!-- React & ReactDOM for SIP Planner -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Prop Types (Required for Recharts) -->
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    
    <!-- Recharts for SIP Planner Charts -->
    
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        // CASHMELA BLUE THEME
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            500: '#4169E1', // CashMela Blue
                            600: '#3b5dd1', // Slightly darker blue
                            700: '#2e4ab8',
                            900: '#1e3a8a',
                        },
                    },
                    animation: {
                        'shine': 'shine 1s',
                        'float': 'float-slow 6s ease-in-out infinite',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        shine: {
                            '100%': { left: '125%' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Universal Reset - Remove ALL default margins and padding */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            margin: 0 !important;
            padding: 0 !important;
            width: 100%;
            height: 100%;
        }
        
        body { font-family: 'Inter', sans-serif; }
        
        /* Cashmela Specific Gradients - Updated to Dark Theme */
        .hero-gradient { background: radial-gradient(100.00% 100.00% at 50% 0%, #1A1A1A 0%, #000000 100%); }
        .card-gradient-1 { background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%); } /* Home Loan (Retaining for visual variety) */
        .card-gradient-2 { background: linear-gradient(135deg, #0f766e 0%, #115e59 100%); } /* Personal Loan (Retaining for visual variety) */
        .card-gradient-3 { background: linear-gradient(135deg, #7e22ce 0%, #581c87 100%); } /* Car Loan (Retaining for visual variety) */
        .card-gradient-4 { background: linear-gradient(135deg, #ea580c 0%, #c2410c 100%); } /* Credit Card (Retaining for visual variety) */

        /* Smooth Scroll */
        html { scroll-behavior: smooth; }

        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Range Slider Styling - Updated Thumb to Urban Green */
        input[type=range] {
            -webkit-appearance: none; 
            width: 100%; 
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #00D09C; /* Urban Green */
            cursor: pointer;
            margin-top: -8px; 
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            transition: transform 0.1s;
        }
        input[type=range]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #e2e8f0;
            border-radius: 2px;
        }

        /* --- Enhanced Animations (No Change) --- */
        
        /* Premium Reveal on Scroll */
        .reveal {
            opacity: 0;
            transform: translateY(40px);
            transition: all 1.2s cubic-bezier(0.22, 1, 0.36, 1);
        }
        .reveal.active {
            opacity: 1;
            transform: translateY(0);
        }

        /* Staggered delays */
        .reveal-delay-100 { transition-delay: 0.1s; }
        .reveal-delay-200 { transition-delay: 0.2s; }
        .reveal-delay-300 { transition-delay: 0.3s; }
        .reveal-delay-400 { transition-delay: 0.4s; }

        /* Floating Animation for Hero Elements */
        @keyframes float-slow {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        .animate-float { animation: float-slow 6s ease-in-out infinite; }
        .animate-float-delayed { animation: float-slow 7s ease-in-out infinite 1s; }

        /* Pulse Ring for Map - Updated to Urban Green */
        @keyframes pulse-ring {
            0% { transform: scale(0.33); opacity: 1; }
            80%, 100% { opacity: 0; }
        }
        .animate-pulse-ring::before {
            content: '';
            position: absolute;
            left: -50%;
            top: -50%;
            width: 200%;
            height: 200%;
            border-radius: 50%;
            background-color: rgba(65, 105, 225, 0.5); /* CashMela Blue Opacity */
            animation: pulse-ring 2s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }
        
        /* Text Rotator Animation */
        .text-flip-wrapper {
            display: inline-block;
            height: 1.1em; /* Tighter height to prevent bleed */
            overflow: hidden;
            vertical-align: bottom;
            position: relative;
            top: 2px; 
        }
        .text-flip-list {
            animation: text-flip 9s cubic-bezier(0.23, 1, 0.32, 1) infinite;
        }
        @keyframes text-flip {
            0%, 26% { transform: translateY(0); }
            33%, 59% { transform: translateY(-33.33%); }
            66%, 92% { transform: translateY(-66.66%); }
            100% { transform: translateY(0); } 
        }
        
        /* Smooth Fade In */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }

        /* Card Hover Lift & Shine */
        .hover-lift {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }
        .hover-lift:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px -5px rgba(0, 0, 0, 0.2), 0 10px 15px -6px rgba(0, 0, 0, 0.1);
        }
        /* Shine effect on hover */
        .hover-lift::after {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 50%;
            height: 100%;
            background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0) 100%);
            transform: skewX(-25deg);
            transition: none;
        }
        .hover-lift:hover::after {
            left: 150%;
            transition: all 1s ease-in-out;
        }

        /* Button Shimmer */
        .btn-shimmer {
            position: relative;
            overflow: hidden;
        }
        .btn-shimmer::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        .btn-shimmer:hover::before {
            left: 100%;
            transition: left 0.7s ease-in-out;
        }

        /* Slider Animations */
        .slide {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transition: opacity 0.8s ease-in-out, visibility 0.8s;
            overflow: hidden;
        }
        .slide.active {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
            z-index: 1;
        }
        .slide-content {
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.8s ease-out 0.3s;
        }
        .slide.active .slide-content {
            transform: translateY(0);
            opacity: 1;
        }
        .slide-graphic {
            transform: translateX(20px);
            opacity: 0;
            transition: all 0.8s ease-out 0.5s;
        }
        .slide.active .slide-graphic {
            transform: translateX(0);
            opacity: 1;
        }

        .slider-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .slider-dot.active {
            background-color: white;
            width: 24px;
            border-radius: 4px;
        }
        
        .chart-container {
            position: relative;
            height: 220px;
            width: 220px;
            margin: 0 auto;
        }

        /* Glassmorphism Card CSS */
        .glass-card {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        /* --- CashMela Style Timeline Animations (No Change, already correct) --- */
        .um-timeline-path {
            stroke-dasharray: 2000;
            stroke-dashoffset: 2000;
            transition: stroke-dashoffset 2.5s ease-in-out;
        }
        .um-timeline.active .um-timeline-path {
            stroke-dashoffset: 0;
        }
        
        .um-step-icon {
            transform: scale(0);
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .um-timeline.active .um-step-icon {
            transform: scale(1);
        }
        /* Staggered Icon Delays */
        .um-timeline.active .um-icon-1 { transition-delay: 0s; }
        .um-timeline.active .um-icon-2 { transition-delay: 0.8s; }
        .um-timeline.active .um-icon-3 { transition-delay: 1.6s; }
        .um-timeline.active .um-icon-4 { transition-delay: 2.4s; }

        .um-step-text {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease-out;
        }
        .um-timeline.active .um-step-text {
            opacity: 1;
            transform: translateY(0);
        }
        /* Staggered Text Delays */
        .um-timeline.active .um-text-1 { transition-delay: 0.2s; }
        .um-timeline.active .um-text-2 { transition-delay: 1.0s; }
        .um-timeline.active .um-text-3 { transition-delay: 1.8s; }
        .um-timeline.active .um-text-4 { transition-delay: 2.6s; }
        
        /* Application View Full Height Fix */
        .view-application-wrap {
            min-height: calc(100vh - 80px); /* Full viewport minus nav height */
        }
        @media (max-width: 768px) {
            .view-application-wrap {
                min-height: auto;
            }
        }

        .view-section:not(.hidden) ~ nav,
        #application-view:not(.hidden) ~ nav {
            display: none !important;
        }
        
        body:has(#application-view:not(.hidden)) #navbar {
            display: none !important;
        }
        
        #application-view {
            margin: 0 !important;
            padding: 0 !important;
        }
        
        #application-view > div {
            margin: 0 !important;
            padding: 0 !important;
        }
        
        /* Remove ALL margins and padding from application journey */
        #pl-step-1, #pl-step-2, #pl-step-3,
        #pl-step-1 > div, #pl-step-2 > div, #pl-step-3 > div {
            margin: 0 !important;
            padding: 0 !important;
        }
        
        /* Ensure no body margin when in application view */
        body:has(#application-view:not(.hidden)) {
            margin: 0 !important;
            padding: 0 !important;
        }

        /* Tax Calculator Styles */
        .brand-gradient {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
        }
        .card-tax {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px -10px rgba(0,0,0,0.08);
            border: 1px solid rgba(255,255,255,0.5);
        }
        
        
        
        
        .input-group {
            position: relative;
            background: #f8fafc;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            transition: all 0.2s;
        }
        .input-group:focus-within {
            border-color: #3b82f6;
            background: white;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }
        .input-field {
            background: transparent;
            border: none;
            font-weight: 700;
            color: #1e293b;
            width: 100%;
            padding: 12px 12px 12px 35px;
            outline: none;
        }
        .progress-container { 
            background: #e2e8f0; 
            height: 6px; 
            border-radius: 99px; 
            overflow: hidden; 
            margin-top: 8px; 
        }
        .progress-fill { 
            height: 100%; 
            border-radius: 99px; 
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); 
        }
        .info-icon { 
            color: #94a3b8; 
            transition: color 0.2s; 
            cursor: pointer; 
        }
        .info-icon:hover { 
            color: #3b82f6; 
        }
        .tooltip-box {
            visibility: hidden;
            position: absolute;
            bottom: 120%;
            left: 50%;
            transform: translateX(-50%);
            width: 260px;
            background: #1e293b;
            color: white;
            padding: 12px;
            border-radius: 10px;
            font-size: 0.75rem;
            line-height: 1.4;
            z-index: 50;
            opacity: 0;
            transition: 0.2s;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.2);
            pointer-events: none;
        }
        .group:hover .tooltip-box { 
            visibility: visible; 
            opacity: 1; 
        }
        .tooltip-box::after {
            content: ''; 
            position: absolute; 
            top: 100%; 
            left: 50%; 
            margin-left: -6px;
            border-width: 6px; 
            border-style: solid; 
            border-color: #1e293b transparent transparent transparent;
        }
        .result-card { 
            transition: transform 0.3s, border-color 0.3s; 
        }
        .result-card.active { 
            border: 2px solid #10b981; 
            background: #ecfdf5; 
            transform: scale(1.02); 
        }
        .result-card.inactive { 
            opacity: 0.6; 
            filter: grayscale(1); 
            transform: scale(0.98); 
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 flex flex-col min-h-screen overflow-x-hidden m-0 p-0">

    <!-- Navigation - Updated colors to Urban Dark/Green -->
    <nav class="bg-white/95 backdrop-blur-md shadow-sm fixed w-full z-50 top-0 transition-all duration-300 border-b border-gray-100" id="navbar">
        <div class="container mx-auto px-4 md:px-8 h-16 flex items-center justify-between">
            <!-- Logo - Increased size for better visibility -->
            <a href="#" onclick="navigateTo('home-view'); return false;" class="flex items-center group">
                <img src="https://cashmela.com/assets/images/cashmela-logo.png" alt="CashMela" class="h-12 w-auto group-hover:scale-105 transition-transform duration-300">
            </a>

            <!-- Desktop Menu -->
            <div class="hidden md:flex items-center space-x-8">
                <div class="relative nav-item py-6 cursor-pointer group">
                    <span class="font-semibold text-gray-800 group-hover:text-blue-600 transition-colors text-sm uppercase tracking-wide">Products & Offers <i class="fas fa-chevron-down text-[10px] ml-1 transition-transform group-hover:rotate-180"></i></span>
                    <div class="dropdown hidden absolute top-full left-0 w-64 bg-white shadow-xl rounded-b-lg border-t-4 border-blue-600 p-4 animate-fade-in origin-top">
                        <a href="#" onclick="navigateTo('application-view', 'Personal Loan'); return false;" class="block py-2.5 px-3 rounded hover:bg-blue-50 hover:text-blue-600 transition-all text-sm font-medium flex items-center gap-2"><i class="fas fa-user-tag text-blue-600/80"></i> Personal Loan</a>
                        <a href="#" onclick="navigateTo('application-view', 'Overdraft'); return false;" class="block py-2.5 px-3 rounded hover:bg-blue-50 hover:text-blue-600 transition-all text-sm font-medium flex items-center gap-2"><i class="fas fa-wallet text-blue-600/80"></i> Overdraft</a>
                        <a href="#" onclick="navigateTo('application-view', 'Home Loan'); return false;" class="block py-2.5 px-3 rounded hover:bg-blue-50 hover:text-blue-600 transition-all text-sm font-medium flex items-center gap-2"><i class="fas fa-home text-blue-600/80"></i> Home Loan</a>
                        <a href="#" onclick="navigateTo('application-view', 'Business Loan'); return false;" class="block py-2.5 px-3 rounded hover:bg-blue-50 hover:text-blue-600 transition-all text-sm font-medium flex items-center gap-2"><i class="fas fa-briefcase text-blue-600/80"></i> Business Loan</a>
                        <a href="#" onclick="navigateTo('application-view', 'Loan Against Property'); return false;" class="block py-2.5 px-3 rounded hover:bg-blue-50 hover:text-blue-600 transition-all text-sm font-medium flex items-center gap-2"><i class="fas fa-building text-blue-600/80"></i> Loan Against Property</a>
                        <a href="#" onclick="navigateTo('application-view', 'Used Car Loan'); return false;" class="block py-2.5 px-3 rounded hover:bg-blue-50 hover:text-blue-600 transition-all text-sm font-medium flex items-center gap-2"><i class="fas fa-car text-blue-600/80"></i> Used Car Loan</a>
                        <a href="#" onclick="navigateTo('application-view', 'Credit Card'); return false;" class="block py-2.5 px-3 rounded hover:bg-blue-50 hover:text-blue-600 transition-all text-sm font-medium flex items-center gap-2"><i class="fas fa-credit-card text-blue-600/80"></i> Credit Card</a>
                        <a href="#" onclick="navigateTo('insurance-split-view'); return false;" class="block py-2.5 px-3 rounded hover:bg-blue-50 hover:text-blue-600 transition-all text-sm font-medium flex items-center gap-2"><i class="fas fa-shield-alt text-blue-600/80"></i> Insurance</a>
                    </div>
                </div>
                
                <a href="#" onclick="navigateTo('cibil-view'); return false;" class="font-semibold text-gray-800 hover:text-blue-600 transition-colors text-sm uppercase tracking-wide">CIBIL Score</a>
            </div>

            <!-- Buttons -->
            <div class="hidden md:flex items-center gap-4">
                <button onclick="toggleLoginModal()" class="text-gray-800 font-bold text-sm hover:text-blue-600 transition-colors">Login</button>
                
                <!-- Talk to Expert Button with Hover Popup -->
                <div class="relative group">
                    <button class="bg-green-600 text-white px-6 py-2.5 rounded-full font-bold text-sm hover:bg-green-700 transition-all transform hover:-translate-y-0.5 shadow-lg flex items-center gap-2">
                        <i class="fas fa-comments"></i> Talk to Expert
                    </button>
                    
                    <!-- Hover Popup -->
                    <div class="absolute right-0 top-full mt-2 w-80 bg-white rounded-2xl shadow-2xl border border-gray-200 p-6 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform group-hover:translate-y-0 translate-y-2 z-50">
                        <div class="flex items-start gap-4 mb-4">
                            <div class="bg-blue-100 rounded-full p-3 flex-shrink-0">
                                <i class="fas fa-phone text-blue-600 text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-gray-900 mb-1">Talk to Expert</h3>
                                <p class="text-sm text-gray-600">Sales Enquiry</p>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <p class="text-2xl font-bold text-blue-600">Call Us: 8080080114</p>
                        </div>
                        
                        <div class="text-sm text-gray-700 leading-relaxed">
                            <p>Our advisors are available <span class="font-bold">6 days a week, Mon to Sat, 9:30 am - 6:30 pm</span> to assist you with the best offers or help resolve any queries.</p>
                        </div>
                    </div>
                </div>
                
                <button onclick="navigateTo('partner-view'); return false;" class="bg-blue-600 text-slate-800 px-6 py-2.5 rounded-full font-bold text-sm hover:bg-blue-600/90 hover:shadow-lg transition-all transform hover:-translate-y-0.5 shadow-primary-500/50 btn-shimmer">
                    Become a Partner
                </button>
            </div>

            <!-- Mobile Menu Toggle -->
            <button class="md:hidden text-2xl text-gray-700 hover:text-blue-600 transition-colors" onclick="toggleMobileMenu()">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t p-4 fixed top-20 w-full z-40 shadow-lg animate-fade-in max-h-[80vh] overflow-y-auto">
            <a href="#" onclick="navigateTo('application-view', 'Personal Loan'); toggleMobileMenu(); return false;" class="block py-3 font-medium border-b hover:text-blue-600">Personal Loan</a>
            <a href="#" onclick="navigateTo('application-view', 'Overdraft'); toggleMobileMenu(); return false;" class="block py-3 font-medium border-b hover:text-blue-600">Overdraft</a>
            <a href="#" onclick="navigateTo('application-view', 'Home Loan'); toggleMobileMenu(); return false;" class="block py-3 font-medium border-b hover:text-blue-600">Home Loan</a>
            <a href="#" onclick="navigateTo('application-view', 'Business Loan'); toggleMobileMenu(); return false;" class="block py-3 font-medium border-b hover:text-blue-600">Business Loan</a>
            <a href="#" onclick="navigateTo('application-view', 'Credit Card'); toggleMobileMenu(); return false;" class="block py-3 font-medium border-b hover:text-blue-600">Credit Card</a>
            <a href="#" onclick="navigateTo('insurance-split-view'); toggleMobileMenu(); return false;" class="block py-3 font-medium border-b hover:text-blue-600">Insurance</a>
            
            <!-- Calculators Submenu -->
            <div class="border-b">
                <div class="py-3 font-bold text-gray-800 text-sm uppercase tracking-wide">Calculators</div>
                <div class="pl-4 space-y-2 pb-3">
                    <a href="#" onclick="alert("Feature coming soon!"); toggleMobileMenu(); return false;" class="block py-2 text-sm font-medium text-gray-700 hover:text-blue-600"><i class="fas fa-calculator text-blue-600/80 mr-2"></i> Smart Loan Calculator</a>
                    <a href="#" onclick="alert('Coming soon!'); toggleMobileMenu(); return false;" class="block py-2 text-sm font-medium text-gray-700 hover:text-blue-600"><i class="fas fa-receipt text-blue-600/80 mr-2"></i> Income Tax Calculator</a>
                    <a href="#" onclick="alert('Coming soon!'); toggleMobileMenu(); return false;" class="block py-2 text-sm font-medium text-gray-700 hover:text-blue-600"><i class="fas fa-check-circle text-blue-600/80 mr-2"></i> Loan Eligibility Calculator</a>
                    <a href="#" onclick="alert('Coming soon!'); toggleMobileMenu(); return false;" class="block py-2 text-sm font-medium text-gray-700 hover:text-blue-600"><i class="fas fa-chart-line text-blue-600/80 mr-2"></i> Smart SIP AI Planner</a>
                </div>
            </div>
            
            <a href="#" onclick="navigateTo('cibil-view'); toggleMobileMenu(); return false;" class="block py-3 font-medium border-b hover:text-blue-600">CIBIL Score</a>
            <div class="mt-4 flex flex-col gap-3">
                <button onclick="toggleLoginModal(); toggleMobileMenu()" class="w-full text-center py-2 border rounded-full hover:bg-gray-50">Login</button>
                <button onclick="navigateTo('partner-view'); toggleMobileMenu(); return false;" class="w-full text-center py-2 bg-blue-600 text-slate-800 rounded-full hover:bg-blue-600/90">Become a Partner</button>
            </div>
        </div>
    </nav>

    <!-- Spacer for fixed nav -->
    <div class="h-20"></div>

    <!-- VIEW: HOME -->
    <div id="home-view" class="view-section animate-fade-in">
        <!-- Hero Section - Updated colors to Urban Dark/Green -->
        <section class="bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 relative overflow-hidden text-white pt-8 pb-12 lg:pt-16 lg:pb-20">
            <div class="absolute top-0 right-0 w-1/2 h-full opacity-10 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
            <!-- Enhanced Animated Background Circles -->
            <div class="absolute top-10 left-10 w-64 h-64 bg-blue-600 rounded-full mix-blend-screen filter blur-[100px] opacity-20 animate-float"></div>
            <div class="absolute bottom-10 right-10 w-80 h-80 bg-purple-600 rounded-full mix-blend-screen filter blur-[100px] opacity-20 animate-float-delayed"></div>
            
            <div class="container mx-auto px-4 md:px-8 relative z-10">
                <div class="grid lg:grid-cols-2 gap-10 lg:gap-20 items-center">
                    
                    <!-- Left Side: Static Text -->
                    <div class="reveal max-w-xl">
                        <div class="inline-block bg-slate-800/70 border border-blue-600/50 rounded-full px-3 py-1 mb-4 backdrop-blur-sm">
                            <span class="text-blue-600/90 text-[10px] font-bold uppercase tracking-widest"><i class="fas fa-bolt mr-1"></i> Fast & Secure</span>
                        </div>
                        <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold leading-tight mb-4 tracking-tight">
                            Master Your Money <br>
                            With The Right 
                            <span class="text-flip-wrapper text-blue-600">
                                <span class="text-flip-list block">
                                    <span class="block h-full">Loans</span>
                                    <span class="block h-full">Cards</span>
                                    <span class="block h-full">Insurance</span>
                                </span>
                            </span>
                        </h1>
                        <p class="text-gray-400 text-sm md:text-base mb-6 max-w-md leading-relaxed">India's most transparent financial marketplace. Compare & Apply for best products.</p>
                        
                        <!-- Compact Stats Grid -->
                        <div class="grid grid-cols-2 gap-4 mt-4">
                            <div class="stat-card hover:bg-white/5 p-3 rounded-lg transition-colors border border-transparent hover:border-white/5">
                                <div class="text-xl font-bold text-white flex items-baseline"><span class="counter" data-target="3.4">0</span><span>L+</span></div>
                                <div class="text-gray-500 text-[10px] font-bold uppercase tracking-wider">Customers</div>
                            </div>
                            <div class="stat-card hover:bg-white/5 p-3 rounded-lg transition-colors border border-transparent hover:border-white/5">
                                <div class="text-xl font-bold text-white flex items-baseline"><span class="counter" data-target="10000">0</span><span>+</span></div>
                                <div class="text-gray-500 text-[10px] font-bold uppercase tracking-wider">Locations</div>
                            </div>
                            <div class="stat-card hover:bg-white/5 p-3 rounded-lg transition-colors border border-transparent hover:border-white/5">
                                <div class="text-xl font-bold text-white flex items-baseline"><span class="counter" data-target="40">0</span><span>+</span></div>
                                <div class="text-gray-500 text-[10px] font-bold uppercase tracking-wider">Lenders</div>
                            </div>
                            <div class="stat-card hover:bg-white/5 p-3 rounded-lg transition-colors border border-transparent hover:border-white/5">
                                <div class="text-xl font-bold text-white flex items-baseline"><span>₹</span><span class="counter" data-target="3000">0</span><span> Cr+</span></div>
                                <div class="text-gray-500 text-[10px] font-bold uppercase tracking-wider">Disbursed</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Side: Slider -->
                    <div class="relative reveal reveal-delay-200">
                        <div class="relative w-full aspect-[16/10] md:aspect-[2.4/1] lg:aspect-[2.2/1] rounded-[1.5rem] overflow-hidden shadow-2xl bg-white/5 backdrop-blur-sm border border-white/10 group" onmouseenter="pauseSlider()" onmouseleave="resumeSlider()">
                            
                            <!-- Slide 1: Credit Card (Retaining theme) -->
                            <div class="slide active" id="slide-0">
                                <div class="w-full h-full bg-gradient-to-br from-[#1a1c20] via-[#2c241b] to-[#000000] grid grid-cols-1 md:grid-cols-2 p-6 md:p-8 cursor-pointer" onclick="navigateTo('application-view', 'Credit Card')">
                                    <div class="flex flex-col justify-center z-10">
                                        <div class="inline-flex items-center gap-1.5 py-0.5 px-2 rounded-full bg-[#D4AF37]/20 border border-[#D4AF37]/30 text-[8px] font-bold text-[#F7E298] mb-2 tracking-widest uppercase w-fit">
                                            <i class="fas fa-crown"></i> Premium
                                        </div>
                                        <h2 class="text-2xl md:text-3xl font-black text-white leading-tight mb-2 drop-shadow-lg">
                                            Experience <br>
                                            <span class="text-transparent bg-clip-text bg-gradient-to-r from-[#F7E298] via-[#D4AF37] to-[#AA8C2C]">Regalia</span> Life
                                        </h2>
                                        <ul class="space-y-1 mb-4">
                                            <li class="flex items-center gap-2 text-gray-300 text-[10px] font-medium"><i class="fas fa-check-circle text-[#D4AF37]"></i> Lounge Access</li>
                                            <li class="flex items-center gap-2 text-gray-300 text-[10px] font-medium"><i class="fas fa-check-circle text-[#D4AF37]"></i> 0% Forex Markup</li>
                                            <li class="flex items-center gap-2 text-gray-300 text-[10px] font-medium"><i class="fas fa-check-circle text-[#D4AF37]"></i> High Rewards</li>
                                        </ul>
                                        <button class="bg-gradient-to-r from-[#D4AF37] to-[#AA8C2C] text-black px-5 py-2 rounded-full font-bold flex items-center gap-2 hover:bg-white transition-all shadow-lg hover:scale-105 transform duration-300 w-fit text-xs">
                                            Apply Now <i class="fas fa-arrow-right"></i>
                                        </button>
                                    </div>
                                    <div class="hidden md:flex items-center justify-center relative">
                                        <div class="relative w-48 h-32 transform rotate-[-5deg] hover:rotate-0 transition-transform duration-500 hover:scale-105 z-20">
                                            <div class="absolute inset-0 rounded-xl bg-gradient-to-br from-[#eecda3] via-[#dbb06f] to-[#b88a44] shadow-xl border border-[#fceabb]/50 flex flex-col justify-between p-4 overflow-hidden">
                                                <div class="absolute inset-0 opacity-20" style="background-image: radial-gradient(circle at 50% 50%, #8a6e2f 1px, transparent 1px); background-size: 8px 8px;"></div>
                                                <div class="flex justify-between items-start relative z-10">
                                                    <div class="text-[#2c241b] font-serif font-bold text-sm">Regalia <span class="text-[8px] font-sans block tracking-widest">GOLD</span></div>
                                                    <i class="fab fa-cc-mastercard text-xl text-white/80"></i>
                                                </div>
                                                <div class="relative z-10 mt-auto">
                                                     <div class="flex items-center gap-2 mb-1">
                                                        <div class="w-7 h-5 rounded bg-[#d4af37] border border-[#2c241b]/20 relative shadow-inner"></div>
                                                     </div>
                                                     <div class="font-mono text-[#2c241b] text-xs font-bold tracking-widest">**** 9034</div>
                                                </div>
                                                <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-tr from-transparent via-white/40 to-transparent pointer-events-none"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Slide 2: Personal Loan (Retaining theme) -->
                            <div class="slide" id="slide-1">
                                <div class="w-full h-full bg-gradient-to-br from-[#4338ca] via-[#4f46e5] to-[#6366f1] grid grid-cols-1 md:grid-cols-2 p-6 md:p-8 cursor-pointer" onclick="navigateTo('application-view', 'Personal Loan')">
                                    <div class="flex flex-col justify-center z-10">
                                        <div class="bg-indigo-900/50 backdrop-blur-md border border-indigo-400/30 text-indigo-100 px-2 py-0.5 rounded-full text-[8px] font-bold uppercase tracking-widest w-fit mb-2">
                                            <i class="fas fa-magic text-yellow-400 mr-1"></i> Hassle-free
                                        </div>
                                        <h2 class="text-2xl md:text-3xl font-black text-white leading-tight mb-3 drop-shadow-lg">
                                            Fund Your <br>
                                            <span class="text-transparent bg-clip-text bg-gradient-to-r from-yellow-200 via-yellow-400 to-yellow-600">Ambitions</span>
                                        </h2>
                                        <ul class="space-y-1 mb-4">
                                            <li class="flex items-center gap-2 text-indigo-100 text-[10px] font-medium"><i class="fas fa-check-circle text-green-400"></i> Rates from <strong class="text-white">9.99%*</strong></li>
                                            <li class="flex items-center gap-2 text-indigo-100 text-[10px] font-medium"><i class="fas fa-check-circle text-green-400"></i> Limit up to <strong class="text-white">₹50 Lacs</strong></li>
                                            <li class="flex items-center gap-2 text-indigo-100 text-[10px] font-medium"><i class="fas fa-check-circle text-green-400"></i> Terms: <strong class="text-white">12-84 months</strong></li>
                                        </ul>
                                        <button class="bg-white text-indigo-700 px-5 py-2 rounded-full font-bold flex items-center gap-2 hover:bg-indigo-50 transition-all shadow-lg hover:-translate-y-1 w-fit text-xs">
                                            Apply Now <i class="fas fa-arrow-right"></i>
                                        </button>
                                    </div>
                                    <div class="hidden md:flex items-center justify-center relative">
                                        <div class="relative w-40 h-40 flex items-center justify-center">
                                            <div class="text-[100px] font-black text-white/10 select-none transform -rotate-12 blur-sm absolute">%</div>
                                            <div class="text-[60px] font-black text-transparent bg-clip-text bg-gradient-to-b from-yellow-300 to-yellow-600 drop-shadow-xl transform -rotate-12 z-20">%</div>
                                            <div class="absolute top-2 right-6 w-8 h-8 bg-gradient-to-br from-yellow-300 to-yellow-600 rounded-full shadow-lg z-30 animate-float-delayed flex items-center justify-center border-2 border-yellow-200/50 text-yellow-900 font-bold text-xs">₹</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Slide 3: Overdraft (Retaining theme) -->
                            <div class="slide" id="slide-2">
                                <div class="w-full h-full bg-gradient-to-br from-slate-700 via-slate-800 to-slate-900 grid grid-cols-1 md:grid-cols-2 p-6 md:p-8 cursor-pointer" onclick="navigateTo('application-view', 'Overdraft')">
                                    <div class="flex flex-col justify-center z-10">
                                        <h2 class="text-2xl md:text-3xl font-black text-white leading-tight mb-3 drop-shadow-md">
                                            Ready <br>
                                            Whenever <br>
                                            <span class="text-teal-400">You Are</span>
                                        </h2>
                                        <ul class="space-y-1 mb-4">
                                            <li class="flex items-center gap-2 text-slate-200 font-bold text-[10px]"><div class="w-3 h-3 rounded-full bg-teal-500 text-teal-900 flex items-center justify-center text-[8px]"><i class="fas fa-check"></i></div> Withdraw up to ₹40 Lakhs</li>
                                            <li class="flex items-center gap-2 text-slate-200 font-bold text-[10px]"><div class="w-3 h-3 rounded-full bg-teal-500 text-teal-900 flex items-center justify-center text-[8px]"><i class="fas fa-check"></i></div> EMI @ ₹1200*/lac</li>
                                            <li class="flex items-center gap-2 text-slate-200 font-bold text-[10px]"><div class="w-3 h-3 rounded-full bg-teal-500 text-teal-900 flex items-center justify-center text-[8px]"><i class="fas fa-check"></i></div> Interest only on usage</li>
                                        </ul>
                                        <button class="bg-[#0f172a] text-white border border-white/10 px-5 py-2 rounded-full font-bold flex items-center gap-2 hover:bg-black transition-all shadow-xl w-fit text-xs">
                                            Apply Now <i class="fas fa-power-off text-teal-400"></i>
                                        </button>
                                    </div>
                                    <div class="hidden md:flex items-center justify-center relative">
                                        <div class="relative w-48 h-40 flex flex-col items-center justify-end">
                                            <i class="fas fa-house text-[100px] text-white/5 absolute bottom-4 left-1/2 -translate-x-1/2 z-0 scale-y-110"></i>
                                            <div class="absolute top-6 right-4 w-12 h-12 bg-[#4ade80] rounded-xl shadow-lg flex items-center justify-center transform rotate-12 animate-float border-t border-white/40 z-20">
                                                <i class="fas fa-check text-2xl text-white drop-shadow-md"></i>
                                            </div>
                                            <div class="text-center relative z-20 mb-1">
                                                <div class="text-xl font-black text-white drop-shadow-lg tracking-tight">₹ 40L</div>
                                                <div class="text-[8px] font-bold text-teal-200 uppercase tracking-widest">Available Limit</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Slide 4: Home Loan (Retaining theme) -->
                            <div class="slide" id="slide-3">
                                <div class="w-full h-full bg-gradient-to-br from-[#f97316] to-[#ea580c] grid grid-cols-1 md:grid-cols-2 p-6 md:p-8 cursor-pointer" onclick="navigateTo('application-view', 'Home Loan')">
                                    <div class="flex flex-col justify-center z-10">
                                        <div class="bg-orange-900/20 backdrop-blur-sm inline-block px-2 py-0.5 rounded-full text-[8px] font-bold text-orange-100 mb-2 uppercase tracking-widest border border-orange-200/30 w-fit">
                                            Dream Home
                                        </div>
                                        <h2 class="text-2xl md:text-3xl font-bold text-white leading-tight mb-2">
                                            Your Dream<br><span class="text-orange-100">Home</span> Awaits
                                        </h2>
                                        <ul class="space-y-1 mb-4">
                                            <li class="flex items-center gap-2 text-orange-50 font-medium text-[10px]"><i class="fas fa-check-circle text-orange-200"></i> Rates from 8.35%* p.a.</li>
                                            <li class="flex items-center gap-2 text-orange-50 font-medium text-[10px]"><i class="fas fa-check-circle text-orange-200"></i> Zero processing fees</li>
                                            <li class="flex items-center gap-2 text-orange-50 font-medium text-[10px]"><i class="fas fa-check-circle text-orange-200"></i> Instant Approval</li>
                                        </ul>
                                        <button class="bg-white text-orange-600 px-5 py-2 rounded-full font-bold flex items-center gap-2 hover:bg-orange-50 transition-colors shadow-lg w-fit text-xs">
                                            Apply Now <i class="fas fa-home"></i>
                                        </button>
                                    </div>
                                    <div class="hidden md:flex items-center justify-center relative">
                                         <div class="w-40 h-28 bg-white/10 rounded-xl border border-white/20 flex flex-col items-center justify-center relative overflow-hidden backdrop-blur-sm transform hover:scale-105 transition-transform shadow-lg">
                                            <i class="fas fa-house-chimney text-5xl text-white/90 drop-shadow-lg"></i>
                                            <div class="absolute top-2 right-2 bg-orange-500 text-white w-6 h-6 rounded-full flex items-center justify-center shadow-lg">
                                                <i class="fas fa-key text-[8px]"></i>
                                            </div>
                                         </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Slide 5: Health Insurance (Retaining theme) -->
                            <div class="slide" id="slide-4">
                                <div class="w-full h-full bg-gradient-to-br from-teal-700 via-teal-800 to-emerald-900 grid grid-cols-1 md:grid-cols-2 p-6 md:p-8 cursor-pointer" onclick="navigateTo('application-view', 'Health Insurance')">
                                    <div class="flex flex-col justify-center z-10">
                                        <div class="bg-emerald-500/20 backdrop-blur-md border border-emerald-400/30 text-emerald-100 px-2 py-0.5 rounded-full text-[8px] font-bold uppercase tracking-widest w-fit mb-2">
                                            <i class="fas fa-heartbeat text-red-400 mr-1"></i> Protection
                                        </div>
                                        <h2 class="text-2xl md:text-3xl font-black text-white leading-tight mb-2 drop-shadow-xl">
                                            Secure Your <br>
                                            Family's <span class="text-emerald-300">Health</span>
                                        </h2>
                                        <ul class="space-y-1 mb-4">
                                            <li class="flex items-center gap-2 text-emerald-100 text-[10px] font-medium"><i class="fas fa-check-circle text-emerald-400"></i> Cashless claims</li>
                                            <li class="flex items-center gap-2 text-emerald-100 text-[10px] font-medium"><i class="fas fa-check-circle text-emerald-400"></i> Critical illness cover</li>
                                            <li class="flex items-center gap-2 text-emerald-100 text-[10px] font-medium"><i class="fas fa-check-circle text-emerald-400"></i> Save tax up to ₹75k</li>
                                        </ul>
                                        <button class="bg-white text-teal-800 px-5 py-2 rounded-full font-bold flex items-center gap-2 hover:bg-emerald-50 transition-all shadow-lg hover:-translate-y-1 w-fit text-xs">
                                            Get Quote <i class="fas fa-file-medical"></i>
                                        </button>
                                    </div>
                                    <div class="hidden md:flex items-center justify-center relative">
                                        <div class="relative w-40 h-40 flex items-center justify-center">
                                            <i class="fas fa-shield-halved text-[100px] text-emerald-500 opacity-90 drop-shadow-2xl animate-float"></i>
                                            <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-20 animate-pulse-ring">
                                                <i class="fas fa-heart text-3xl text-white drop-shadow-lg"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Controls -->
                            <button class="absolute left-3 top-1/2 -translate-y-1/2 bg-black/10 hover:bg-black/30 text-white w-8 h-8 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity z-20 backdrop-blur-md border border-white/20" onclick="prevSlide()">
                                <i class="fas fa-chevron-left text-xs"></i>
                            </button>
                            <button class="absolute right-3 top-1/2 -translate-y-1/2 bg-black/10 hover:bg-black/30 text-white w-8 h-8 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity z-20 backdrop-blur-md border border-white/20" onclick="nextSlide()">
                                <i class="fas fa-chevron-right text-xs"></i>
                            </button>
                        </div>

                        <!-- Dots -->
                        <div class="flex justify-center space-x-2 mt-4">
                            <div class="slider-dot active" onclick="goToSlide(0)"></div>
                            <div class="slider-dot" onclick="goToSlide(1)"></div>
                            <div class="slider-dot" onclick="goToSlide(2)"></div>
                            <div class="slider-dot" onclick="goToSlide(3)"></div>
                            <div class="slider-dot" onclick="goToSlide(4)"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Main Product Cards (Overlapping) -->
        <section class="relative z-20 -mt-16 pb-16">
            <div class="container mx-auto px-4 md:px-8">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">
                    
                    <!-- Card 1: Personal Loan -->
                    <div class="bg-emerald-700 p-6 rounded-2xl shadow-xl hover-lift reveal reveal-delay-100 group cursor-pointer text-white relative overflow-hidden" onclick="navigateTo('application-view', 'Personal Loan')">
                         <div class="flex items-start justify-between mb-6 relative z-10">
                            <span class="text-[8px] font-bold text-emerald-800 bg-white px-2 py-1 rounded uppercase tracking-wide shadow-sm">Quick Disbursal</span>
                            <div class="bg-white/20 p-2 rounded-lg group-hover:bg-white/30 transition-colors">
                                <i class="fas fa-money-bill-wave text-xl text-white"></i>
                            </div>
                        </div>
                        <h3 class="text-xl font-bold mb-2 relative z-10">Personal Loan</h3>
                        <p class="text-emerald-100 text-xs mb-6 line-clamp-2 leading-relaxed relative z-10">Paperless process at low rates for your immediate needs.</p>
                        <button class="text-white font-bold text-xs flex items-center gap-2 group-hover:gap-3 transition-all border border-white/30 px-4 py-2 rounded-full hover:bg-white hover:text-emerald-900 relative z-10">
                            Apply Now <i class="fas fa-arrow-right text-[10px]"></i>
                        </button>
                    </div>

                    <!-- Card 2: Overdraft -->
                    <div class="bg-cyan-700 p-6 rounded-2xl shadow-xl hover-lift reveal reveal-delay-200 group cursor-pointer text-white relative overflow-hidden" onclick="navigateTo('application-view', 'Overdraft')">
                        <div class="flex items-start justify-between mb-6 relative z-10">
                            <span class="text-[8px] font-bold text-cyan-800 bg-white px-2 py-1 rounded uppercase tracking-wide shadow-sm">Flexible Limit</span>
                            <div class="bg-white/20 p-2 rounded-lg group-hover:bg-white/30 transition-colors">
                                <i class="fas fa-wallet text-xl text-white"></i>
                            </div>
                        </div>
                        <h3 class="text-xl font-bold mb-2 relative z-10">Overdraft</h3>
                        <p class="text-cyan-100 text-xs mb-6 line-clamp-2 leading-relaxed relative z-10">Pay interest only on the amount you use. Withdraw anytime.</p>
                        <button class="text-white font-bold text-xs flex items-center gap-2 group-hover:gap-3 transition-all border border-white/30 px-4 py-2 rounded-full hover:bg-white hover:text-cyan-900 relative z-10">
                            Apply Now <i class="fas fa-arrow-right text-[10px]"></i>
                        </button>
                    </div>

                    <!-- Card 3: Home Loan -->
                    <div class="bg-slate-800 p-6 rounded-2xl shadow-xl hover-lift reveal reveal-delay-300 group cursor-pointer text-white relative overflow-hidden" onclick="navigateTo('application-view', 'Home Loan')">
                        <div class="flex items-start justify-between mb-6 relative z-10">
                            <span class="text-[8px] font-bold text-gray-800 bg-white px-2 py-1 rounded uppercase tracking-wide shadow-sm">Quick Sanction</span>
                            <div class="bg-white/20 p-2 rounded-lg group-hover:bg-white/30 transition-colors">
                                <i class="fas fa-home text-xl text-blue-600"></i>
                            </div>
                        </div>
                        <h3 class="text-xl font-bold mb-2 relative z-10">Home Loan</h3>
                        <p class="text-gray-300 text-xs mb-6 line-clamp-2 leading-relaxed relative z-10">Instant approval at lowest interest rates with minimal docs.</p>
                        <button class="text-blue-600 font-bold text-xs flex items-center gap-2 group-hover:gap-3 transition-all border border-blue-600/30 px-4 py-2 rounded-full hover:bg-blue-600 hover:text-slate-800 relative z-10">
                            Apply Now <i class="fas fa-arrow-right text-[10px]"></i>
                        </button>
                    </div>

                    <!-- Card 4: Credit Card -->
                    <div class="bg-orange-700 p-6 rounded-2xl shadow-xl hover-lift reveal reveal-delay-400 group cursor-pointer text-white relative overflow-hidden" onclick="navigateTo('application-view', 'Credit Card')">
                        <div class="flex items-start justify-between mb-6 relative z-10">
                            <span class="text-[8px] font-bold text-orange-800 bg-white px-2 py-1 rounded uppercase tracking-wide shadow-sm">Rewards</span>
                            <div class="bg-white/20 p-2 rounded-lg group-hover:bg-white/30 transition-colors">
                                <i class="fas fa-credit-card text-xl text-white"></i>
                            </div>
                        </div>
                        <h3 class="text-xl font-bold mb-2 relative z-10">Credit Card</h3>
                        <p class="text-orange-100 text-xs mb-6 line-clamp-2 leading-relaxed relative z-10">Choose cards from all top banks with maximum benefits.</p>
                        <button class="text-white font-bold text-xs flex items-center gap-2 group-hover:gap-3 transition-all border border-white/30 px-4 py-2 rounded-full hover:bg-white hover:text-orange-900 relative z-10">
                            Apply Now <i class="fas fa-arrow-right text-[10px]"></i>
                        </button>
                    </div>

                    <!-- Card 5: Insurance -->
                    <div class="bg-purple-700 p-6 rounded-2xl shadow-xl hover-lift reveal reveal-delay-400 group cursor-pointer text-white relative overflow-hidden" onclick="navigateTo('application-view', 'Health Insurance')">
                        <div class="flex items-start justify-between mb-6 relative z-10">
                            <span class="text-[8px] font-bold text-purple-800 bg-white px-2 py-1 rounded uppercase tracking-wide shadow-sm">Protection</span>
                            <div class="bg-white/20 p-2 rounded-lg group-hover:bg-white/30 transition-colors">
                                <i class="fas fa-shield-heart text-xl text-white"></i>
                            </div>
                        </div>
                        <h3 class="text-xl font-bold mb-2 relative z-10">Insurance</h3>
                        <p class="text-purple-100 text-xs mb-6 line-clamp-2 leading-relaxed relative z-10">Secure your family's future with comprehensive health plans.</p>
                        <button class="text-white font-bold text-xs flex items-center gap-2 group-hover:gap-3 transition-all border border-white/30 px-4 py-2 rounded-full hover:bg-white hover:text-purple-900 relative z-10">
                            Apply Now <i class="fas fa-arrow-right text-[10px]"></i>
                        </button>
                    </div>

                </div>
            </div>
        </section>

        <!-- CIBIL Banner Section (No major changes needed, colors already align with UM green) -->
        <section class="py-12 bg-white reveal">
            <div class="container mx-auto px-4 md:px-8">
                <!-- Main Banner Container: Split Layout (Green Left / White Right) -->
                <div class="relative rounded-[2.5rem] overflow-hidden shadow-2xl group cursor-pointer border border-gray-100 min-h-[340px] flex flex-col md:flex-row" onclick="navigateTo('cibil-view')">
                    
                    <!-- LEFT PANEL: Green Gradient Background + Happy Customer -->
                    <div class="w-full md:w-2/5 bg-gradient-to-br from-[#2f5d45] via-[#437a5b] to-[#68c78e] relative overflow-hidden flex items-end justify-center">
                        <!-- Subtle Pattern Overlay -->
                        <div class="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
                        
                        <!-- Decorative Shape -->
                        <div class="absolute top-0 right-0 w-full h-full bg-gradient-to-l from-black/10 to-transparent transform skew-x-12 translate-x-20"></div>

                        <!-- Happy Customer Label (Top Left) -->
                        <div class="absolute top-6 left-6 flex items-center gap-2 z-20">
                            <div class="w-2 h-2 rounded-full bg-white animate-pulse"></div>
                            <span class="text-white/90 text-sm font-medium tracking-wide">Happy Customer</span>
                        </div>

                        <!-- Customer Image (Visible & Blended) -->
                        <img src="https://images.unsplash.com/photo-1600880292203-757bb62b4baf?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" 
                             onerror="this.src='https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80'"
                             class="relative z-10 h-72 object-cover object-top mask-image-b transform translate-y-4 group-hover:translate-y-2 transition-transform duration-700 drop-shadow-2xl filter brightness-105" 
                             style="mask-image: linear-gradient(to bottom, black 80%, transparent 100%); -webkit-mask-image: linear-gradient(to bottom, black 85%, transparent 100%);" 
                             alt="Happy Customer">
                    </div>

                    <!-- RIGHT PANEL: Content & Phone -->
                    <div class="w-full md:w-3/5 bg-white relative p-8 md:pl-12 flex flex-col md:flex-row items-center justify-between">
                        
                        <!-- Content Center -->
                        <div class="w-full md:w-1/2 text-center md:text-left z-10 mb-8 md:mb-0">
                            <div class="inline-flex items-center gap-1 px-3 py-1 bg-blue-50 text-green-700 rounded-full text-[10px] font-bold uppercase tracking-widest mb-4 border border-green-100">
                                <i class="fas fa-star text-xs"></i> Official Partner
                            </div>
                            
                            <h2 class="text-4xl md:text-5xl font-black text-slate-800 mb-2 leading-tight">
                                Check Your <br>
                                <span class="text-[#4ade80]">CIBIL Score</span>
                            </h2>
                            
                            <div class="flex items-center justify-center md:justify-start gap-4 mb-8">
                                <div class="relative text-gray-400 font-bold text-2xl">
                                    ₹1,200
                                    <div class="absolute top-1/2 left-0 w-full h-0.5 bg-red-500 rounded-full transform -rotate-12"></div>
                                </div>
                                <div class="bg-[#4ade80] text-white px-4 py-1 rounded-md font-bold text-lg shadow-md shadow-green-200">
                                    FREE
                                </div>
                            </div>
                            
                            <button class="bg-slate-800 text-white px-8 py-3.5 rounded-full font-bold shadow-xl hover:scale-105 transition-all flex items-center gap-2 mx-auto md:mx-0 group-hover:shadow-2xl">
                                Check Now <i class="fas fa-arrow-right text-xs group-hover:translate-x-1 transition-transform"></i>
                            </button>
                            
                            <div class="mt-4 flex items-center justify-center md:justify-start gap-2 text-xs text-gray-500 font-medium">
                                <i class="fas fa-shield-alt text-green-500"></i> 100% Safe & Secure
                            </div>
                        </div>

                        <!-- Phone Mockup Right -->
                        <div class="w-full md:w-1/2 flex justify-center items-center relative">
                            <!-- Floating Icons -->
                            <div class="absolute -top-4 -right-2 bg-white p-2 rounded-lg shadow-lg border border-gray-100 z-20 animate-float">
                                <i class="fas fa-shield-alt text-2xl text-green-500"></i>
                            </div>
                            <div class="absolute bottom-10 -right-4 w-10 h-10 bg-yellow-400 rounded-full flex items-center justify-center text-yellow-900 font-bold shadow-lg border-2 border-yellow-200 z-20 animate-bounce">₹</div>

                            <!-- Phone Body -->
                            <div class="relative bg-white border-[6px] border-gray-900 rounded-[2.5rem] shadow-2xl h-64 w-36 overflow-hidden transform rotate-3 group-hover:rotate-0 transition-all duration-500">
                                <!-- Dynamic Island/Notch -->
                                <div class="absolute top-2 left-1/2 -translate-x-1/2 w-12 h-3 bg-slate-800 rounded-full z-20"></div>
                                
                                <!-- Screen -->
                                <div class="h-full w-full bg-gray-50 pt-8 pb-4 px-3 flex flex-col items-center">
                                    <div class="text-[8px] font-bold text-gray-400 uppercase tracking-widest mb-3">Credit Score</div>
                                    
                                    <!-- Gauge -->
                                    <div class="relative w-24 h-12 overflow-hidden mb-2">
                                        <div class="w-24 h-24 rounded-full border-[8px] border-gray-200 box-border"></div>
                                        <!-- Changed gauge color to urban green -->
                                        <div class="absolute top-0 left-0 w-24 h-24 rounded-full border-[8px] border-transparent border-t-primary-500 border-r-primary-500 transform -rotate-45 w-full animate-pulse-slow"></div>
                                    </div>
                                    
                                    <div class="text-3xl font-black text-gray-800 leading-none mb-1">785</div>
                                    <div class="px-2 py-0.5 bg-green-100 text-green-700 rounded text-[8px] font-bold uppercase">Excellent</div>
                                    
                                    <!-- Fake Lines -->
                                    <div class="w-full mt-auto space-y-1.5 opacity-50">
                                        <div class="h-1.5 w-full bg-gray-200 rounded-full"></div>
                                        <div class="h-1.5 w-3/4 bg-gray-200 rounded-full mx-auto"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Trending Products - Updated hover/accent colors to Urban Green -->
        <section class="py-16 bg-gray-50">
            <div class="container mx-auto px-4 md:px-8">
                <div class="text-center max-w-2xl mx-auto mb-12 reveal">
                    <h2 class="text-3xl md:text-4xl font-bold text-slate-800 mb-4">Find the Right Financial <span class="text-blue-600">Product</span></h2>
                    <p class="text-gray-500">Get started in minutes with our simple, fast, and convenient application process.</p>
                </div>
                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="bg-white p-6 rounded-xl border border-gray-100 hover:border-blue-600 hover:shadow-2xl hover:shadow-primary-500/10 transition-all duration-300 group cursor-pointer reveal reveal-delay-100 hover:-translate-y-2" onclick="navigateTo('application-view', 'Business Loan')">
                        <img src="https://cdn.urbanmoney.com/homepageimages/buisnessloanicon.svg" class="w-10 h-10 mb-4 transition-transform group-hover:scale-110 duration-500" alt="Business Loan">
                        <h3 class="font-bold text-lg mb-1 group-hover:text-blue-600 transition-colors">Business Loan</h3>
                        <p class="text-sm text-gray-500 mb-4">Instant Funds for Instant Growth</p>
                        <span class="text-blue-600 font-bold text-sm border border-green-100 px-4 py-2 rounded-full group-hover:bg-blue-600 group-hover:text-slate-800 transition-all inline-block">Apply Now</span>
                    </div>
                    <div class="bg-white p-6 rounded-xl border border-gray-100 hover:border-blue-600 hover:shadow-2xl hover:shadow-primary-500/10 transition-all duration-300 group cursor-pointer reveal reveal-delay-200 hover:-translate-y-2" onclick="navigateTo('application-view', 'Loan Against Property')">
                        <img src="https://cdn.urbanmoney.com/homepageimages/lapicon.svg" class="w-10 h-10 mb-4 transition-transform group-hover:scale-110 duration-500" alt="LAP">
                        <h3 class="font-bold text-lg mb-1 group-hover:text-blue-600 transition-colors">Loan Against Property</h3>
                        <p class="text-sm text-gray-500 mb-4">Lowest Interest Rate</p>
                        <span class="text-blue-600 font-bold text-sm border border-green-100 px-4 py-2 rounded-full group-hover:bg-blue-600 group-hover:text-slate-800 transition-all inline-block">Apply Now</span>
                    </div>
                    <div class="bg-white p-6 rounded-xl border border-gray-100 hover:border-blue-600 hover:shadow-2xl hover:shadow-primary-500/10 transition-all duration-300 group relative overflow-hidden cursor-pointer reveal reveal-delay-300 hover:-translate-y-2" onclick="navigateTo('cibil-view')">
                        <div class="absolute top-0 right-0 bg-yellow-400 text-[10px] font-bold px-2 py-1 rounded-bl-lg z-10 uppercase tracking-wider">Unlock Offers</div>
                        <img src="https://cdn.urbanmoney.com/homepageimages/creditscoreicon.svg" class="w-10 h-10 mb-4 transition-transform group-hover:scale-110 duration-500" alt="Credit Score">
                        <h3 class="font-bold text-lg mb-1 group-hover:text-blue-600 transition-colors">Credit Score</h3>
                        <p class="text-sm text-gray-500 mb-4">Check Score for Free</p>
                        <span class="text-blue-600 font-bold text-sm border border-green-100 px-4 py-2 rounded-full group-hover:bg-blue-600 group-hover:text-slate-800 transition-all inline-block">Check Now</span>
                    </div>
                    <div class="bg-white p-6 rounded-xl border border-gray-100 hover:border-blue-600 hover:shadow-2xl hover:shadow-primary-500/10 transition-all duration-300 group cursor-pointer reveal reveal-delay-400 hover:-translate-y-2" onclick="navigateTo('application-view', 'Used Car Loan')">
                        <img src="https://cdn.urbanmoney.com/homepageimages/allcalcicon.svg" class="w-10 h-10 mb-4 transition-transform group-hover:scale-110 duration-500" alt="Used Car">
                        <h3 class="font-bold text-lg mb-1 group-hover:text-blue-600 transition-colors">Used Car Loan</h3>
                        <p class="text-sm text-gray-500 mb-4">Get the Best used Car Loan</p>
                        <span class="text-blue-600 font-bold text-sm border border-green-100 px-4 py-2 rounded-full group-hover:bg-blue-600 group-hover:text-slate-800 transition-all inline-block">Apply Now</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Steps Section (CashMela Style - Already using correct colors) -->
        <section class="py-16 bg-white overflow-hidden" id="steps-section">
            <div class="container mx-auto px-4 md:px-8">
                <div class="text-center mb-16 reveal">
                    <h2 class="text-4xl font-bold text-slate-800 mb-2">Easy. Convenient. <span class="text-blue-600">Quick.</span></h2>
                    <p class="text-gray-500">The simple & Quick steps to your loan.</p>
                </div>

                <!-- Desktop Animated Snake Timeline (Hidden on Mobile) -->
                <div class="hidden md:block relative h-[600px] max-w-5xl mx-auto um-timeline">
                    <!-- SVG Snake Line -->
                    <svg class="absolute top-0 left-0 w-full h-full pointer-events-none z-0" viewBox="0 0 1000 600" preserveAspectRatio="none">
                        <defs>
                            <linearGradient id="snakeGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#000000;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#00D09C;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <!-- Path coordinates: 
                             Start (200,50) -> Right to (800,50) 
                             -> Curve Down to (800, 250) 
                             -> Left to (200, 250) 
                             -> Curve Down to (200, 450) 
                             -> Right to (800, 450) -->
                        <path class="um-timeline-path" d="M250,80 L750,80 Q850,80 850,180 L850,180 Q850,280 750,280 L250,280 Q150,280 150,380 L150,380 Q150,480 250,480 L750,480" 
                              fill="none" stroke="url(#snakeGradient)" stroke-width="4" stroke-linecap="round" />
                    </svg>

                    <!-- Step 1 (Top Left) -->
                    <div class="absolute top-[30px] left-[150px] flex flex-col items-center w-64 text-center z-10">
                        <div class="text-6xl font-black text-gray-100 absolute -top-10 -left-10 -z-10 um-text-1">01</div>
                        <div class="w-16 h-16 rounded-full bg-[#1A1A1A] text-[#00D09C] flex items-center justify-center text-2xl mb-4 shadow-xl border-4 border-white um-step-icon um-icon-1">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <div class="um-step-text um-text-1">
                            <h3 class="text-xl font-bold mb-1">Eligibility</h3>
                            <p class="text-gray-500 text-sm">Tell us your requirement.<br>2 minutes fill details.</p>
                        </div>
                    </div>

                    <!-- Step 2 (Top Right) -->
                    <div class="absolute top-[30px] right-[150px] flex flex-col items-center w-64 text-center z-10">
                        <div class="text-6xl font-black text-gray-100 absolute -top-10 -right-10 -z-10 um-text-2">02</div>
                        <div class="w-16 h-16 rounded-full bg-[#1A1A1A] text-[#00D09C] flex items-center justify-center text-2xl mb-4 shadow-xl border-4 border-white um-step-icon um-icon-2">
                            <i class="fas fa-magnifying-glass-dollar"></i>
                        </div>
                        <div class="um-step-text um-text-2">
                            <h3 class="text-xl font-bold mb-1">Compare</h3>
                            <p class="text-gray-500 text-sm">AI matches best banks 90+<br>criteria 90% success.</p>
                        </div>
                    </div>

                    <!-- Step 3 (Bottom Left) -->
                    <div class="absolute top-[230px] left-[150px] flex flex-col items-center w-64 text-center z-10">
                        <div class="text-6xl font-black text-gray-100 absolute -top-10 -left-10 -z-10 um-text-3">03</div>
                        <div class="w-16 h-16 rounded-full bg-[#1A1A1A] text-[#00D09C] flex items-center justify-center text-2xl mb-4 shadow-xl border-4 border-white um-step-icon um-icon-3">
                            <i class="fas fa-file-signature"></i>
                        </div>
                        <div class="um-step-text um-text-3">
                            <h3 class="text-xl font-bold mb-1">Apply</h3>
                            <p class="text-gray-500 text-sm">Digital bank application<br>complete digitally.</p>
                        </div>
                    </div>

                    <!-- Step 4 (Bottom Right) -->
                    <div class="absolute top-[430px] right-[150px] flex flex-col items-center w-64 text-center z-10">
                        <div class="text-6xl font-black text-gray-100 absolute -top-10 -right-10 -z-10 um-text-4">04</div>
                        <div class="w-16 h-16 rounded-full bg-[#1A1A1A] text-[#00D09C] flex items-center justify-center text-2xl mb-4 shadow-xl border-4 border-white um-step-icon um-icon-4">
                            <i class="fas fa-landmark"></i>
                        </div>
                        <div class="um-step-text um-text-4">
                            <h3 class="text-xl font-bold mb-1">Disbursement</h3>
                            <p class="text-gray-500 text-sm">Get quick sanction minutes<br>not weeks.</p>
                        </div>
                    </div>
                </div>

                <!-- Mobile Vertical Timeline (Visible only on Mobile) -->
                <div class="md:hidden relative pl-8 border-l-2 border-gray-100 ml-4 space-y-12">
                    <div class="relative reveal">
                        <div class="absolute -left-[42px] top-0 w-12 h-12 rounded-full bg-[#1A1A1A] text-[#00D09C] flex items-center justify-center border-4 border-white shadow-lg z-10">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <span class="text-5xl font-black text-gray-100 absolute -top-4 -left-2 -z-10">01</span>
                        <h3 class="text-xl font-bold mb-1">Eligibility</h3>
                        <p class="text-gray-500 text-sm">Tell us your requirement. 2 minutes fill details.</p>
                    </div>
                    <div class="relative reveal reveal-delay-100">
                        <div class="absolute -left-[42px] top-0 w-12 h-12 rounded-full bg-[#1A1A1A] text-[#00D09C] flex items-center justify-center border-4 border-white shadow-lg z-10">
                            <i class="fas fa-magnifying-glass-dollar"></i>
                        </div>
                        <span class="text-5xl font-black text-gray-100 absolute -top-4 -left-2 -z-10">02</span>
                        <h3 class="text-xl font-bold mb-1">Compare</h3>
                        <p class="text-gray-500 text-sm">AI matches best banks 90+ criteria 90% success.</p>
                    </div>
                    <div class="relative reveal reveal-delay-200">
                        <div class="absolute -left-[42px] top-0 w-12 h-12 rounded-full bg-[#1A1A1A] text-[#00D09C] flex items-center justify-center border-4 border-white shadow-lg z-10">
                            <i class="fas fa-file-signature"></i>
                        </div>
                        <span class="text-5xl font-black text-gray-100 absolute -top-4 -left-2 -z-10">03</span>
                        <h3 class="text-xl font-bold mb-1">Apply</h3>
                        <p class="text-gray-500 text-sm">Digital bank application complete digitally.</p>
                    </div>
                    <div class="relative reveal reveal-delay-300">
                        <div class="absolute -left-[42px] top-0 w-12 h-12 rounded-full bg-[#1A1A1A] text-[#00D09C] flex items-center justify-center border-4 border-white shadow-lg z-10">
                            <i class="fas fa-landmark"></i>
                        </div>
                        <span class="text-5xl font-black text-gray-100 absolute -top-4 -left-2 -z-10">04</span>
                        <h3 class="text-xl font-bold mb-1">Disbursement</h3>
                        <p class="text-gray-500 text-sm">Get quick sanction minutes not weeks.</p>
                    </div>
                </div>

                <div class="text-center mt-12 reveal reveal-delay-300">
                    <button onclick="navigateTo('application-view', 'Personal Loan')" class="bg-[#1A1A1A] text-white px-8 py-3 rounded-full font-bold shadow-lg hover:bg-black hover:shadow-xl transition-all hover:scale-105 btn-shimmer">Get Started <i class="fas fa-chevron-right text-xs ml-1"></i></button>
                </div>
            </div>
        </section>

        <!-- Calculators Section (Dark) - Updated accent colors to Urban Green -->
        <section class="py-20 bg-slate-900 text-white">
            <div class="container mx-auto px-4 md:px-8">
                <h2 class="text-3xl font-bold text-center mb-4 reveal">Financial <span class="text-blue-600">Calculators</span></h2>
                <p class="text-center text-gray-400 mb-12 max-w-2xl mx-auto reveal reveal-delay-100">Plan your finances, estimate payments, and make informed money decisions with CashMela's AI-powered tools.</p>
                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <!-- Calculator 1: Smart Personal Loan -->
                    <div class="bg-white/5 border border-white/10 p-6 rounded-2xl hover:bg-white/10 transition group cursor-pointer reveal reveal-delay-200 hover:-translate-y-1" onclick="window.location.href=\'cashmela-smart-calculator.html\'">
                        <div class="flex justify-between items-start mb-4">
                            <div class="w-12 h-12 bg-purple-600/20 rounded-xl flex items-center justify-center">
                                <i class="fas fa-calculator text-purple-600 text-xl"></i>
                            </div>
                            <span class="text-xs text-blue-600 font-bold group-hover:translate-x-1 transition">Try Now <i class="fas fa-arrow-right"></i></span>
                        </div>
                        <h3 class="text-xl font-bold mb-2">Smart Loan Calculator</h3>
                        <p class="text-sm text-gray-400 leading-relaxed">EMI, Balance Transfer & Pre-Payment strategies with AI.</p>
                    </div>
                    <!-- Calculator 2: Income Tax -->
                    <div class="bg-white/5 border border-white/10 p-6 rounded-2xl hover:bg-white/10 transition group cursor-pointer reveal reveal-delay-300 hover:-translate-y-1" onclick="window.location.href=\'cahsmela-smart-tax-planer.html\'">
                        <div class="flex justify-between items-start mb-4">
                            <div class="w-12 h-12 bg-blue-600/20 rounded-xl flex items-center justify-center">
                                <i class="fas fa-receipt text-blue-600 text-xl"></i>
                            </div>
                            <span class="text-xs text-blue-600 font-bold group-hover:translate-x-1 transition">Try Now <i class="fas fa-arrow-right"></i></span>
                        </div>
                        <h3 class="text-xl font-bold mb-2">Income Tax Calculator</h3>
                        <p class="text-sm text-gray-400 leading-relaxed">Compare Old vs New Regime with AI insights. Updated Budget 2024.</p>
                    </div>
                    <!-- Calculator 3: Loan Eligibility -->
                    <div class="bg-white/5 border border-white/10 p-6 rounded-2xl hover:bg-white/10 transition group cursor-pointer reveal reveal-delay-400 hover:-translate-y-1" onclick="window.location.href=\'eligibility.html\'">
                        <div class="flex justify-between items-start mb-4">
                            <div class="w-12 h-12 bg-emerald-600/20 rounded-xl flex items-center justify-center">
                                <i class="fas fa-check-circle text-emerald-600 text-xl"></i>
                            </div>
                            <span class="text-xs text-blue-600 font-bold group-hover:translate-x-1 transition">Try Now <i class="fas fa-arrow-right"></i></span>
                        </div>
                        <h3 class="text-xl font-bold mb-2">Loan Eligibility Calculator</h3>
                        <p class="text-sm text-gray-400 leading-relaxed">Check maximum loan eligibility with AI-powered FOIR analysis.</p>
                    </div>
                    <!-- Calculator 4: Smart SIP AI Planner -->
                    <div class="bg-white/5 border border-white/10 p-6 rounded-2xl hover:bg-white/10 transition group cursor-pointer reveal reveal-delay-500 hover:-translate-y-1" onclick="window.location.href=\'cashmela-sip-planer.html\'">
                        <div class="flex justify-between items-start mb-4">
                            <div class="w-12 h-12 bg-indigo-600/20 rounded-xl flex items-center justify-center">
                                <i class="fas fa-chart-line text-indigo-600 text-xl"></i>
                            </div>
                            <span class="text-xs text-blue-600 font-bold group-hover:translate-x-1 transition">Try Now <i class="fas fa-arrow-right"></i></span>
                        </div>
                        <h3 class="text-xl font-bold mb-2">Smart SIP AI Planner</h3>
                        <p class="text-sm text-gray-400 leading-relaxed">Build institutional-grade portfolio with risk profiling.</p>
                    </div>
                </div>
                <div class="text-center mt-10 reveal">
                    <p class="text-gray-500 text-sm mb-6">Plus: <span class="text-blue-600 font-semibold cursor-pointer hover:underline" onclick="navigateTo('cibil-view')">CIBIL Score Checker</span> & More Tools</p>
                </div>
            </div>
        </section>

        <!-- Partners Section - Updated accent colors to Urban Green -->
        <section class="py-16 bg-white overflow-hidden">
            <div class="container mx-auto px-4 md:px-8">
                <div class="grid md:grid-cols-2 gap-12 items-center">
                    <div class="reveal">
                        <div class="flex items-center gap-2 mb-6">
                            <img src="https://cashmela.com/assets/images/cashmela-logo.png" alt="CashMela" class="h-72 w-auto">
                        </div>
                        <h2 class="text-3xl font-bold text-slate-800 mb-6">Trusted By <span class="text-blue-600">100K+</span> Partners</h2>
                        <p class="text-gray-600 mb-8 leading-relaxed">Designed exclusively to help Cashmela authorized partners. The Cashmela Partner app lets you view offers, earnings, and case updates in real-time.</p>
                        <div class="flex gap-4 mb-6">
                            <a href="#" class="block hover:opacity-80 transition-opacity hover:-translate-y-1 duration-300"><img src="https://cdn.urbanmoney.com/homepageimages/googleplay.svg" class="h-10"></a>
                            <a href="#" class="block hover:opacity-80 transition-opacity hover:-translate-y-1 duration-300"><img src="https://cdn.urbanmoney.com/homepageimages/appstore.svg" class="h-10"></a>
                        </div>
                         <div class="flex items-center gap-4 text-sm font-medium text-gray-500">
                            <span>Or</span>
                            <img src="/assets/images/homepageimages/qrcode.jpg" class="w-20 h-20 mix-blend-multiply" onerror="this.style.display='none'">
                        </div>
                    </div>
                    <div class="relative reveal reveal-delay-200">
                        <img src="https://cdn.urbanmoney.com/homepageimages/map.svg" class="w-full opacity-80" alt="India Map">
                        <!-- Pulsing Dots across map - Updated to Urban Green -->
                        <div class="absolute top-1/4 left-1/4 w-3 h-3 bg-blue-600 rounded-full animate-pulse-ring"></div>
                        <div class="absolute top-1/3 left-1/3 w-3 h-3 bg-blue-600 rounded-full animate-pulse-ring" style="animation-delay: 0.5s;"></div>
                        <div class="absolute bottom-1/3 right-1/4 w-3 h-3 bg-blue-600 rounded-full animate-pulse-ring" style="animation-delay: 1s;"></div>
                        <div class="absolute top-1/2 left-1/2 w-3 h-3 bg-blue-600 rounded-full animate-pulse-ring" style="animation-delay: 1.5s;"></div>
                        <div class="absolute bottom-1/4 left-1/3 w-3 h-3 bg-blue-600 rounded-full animate-pulse-ring" style="animation-delay: 0.2s;"></div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- VIEW: APPLICATION FORM (UrbanMoney Style - Personal Loan Journey) -->
    <div id="application-view" class="view-section hidden animate-fade-in m-0 p-0" style="margin: 0 !important; padding: 0 !important;">
        <div class="flex flex-col md:flex-row view-application-wrap min-h-screen m-0 p-0" style="margin: 0 !important; padding: 0 !important;">
            
            <!-- STEP 1: Employment Type Selection -->
            <div id="pl-step-1" class="w-full m-0 p-0" style="margin: 0 !important; padding: 0 !important;">
                <div class="flex flex-col md:flex-row min-h-screen m-0 p-0" style="margin: 0 !important; padding: 0 !important;">
                    <!-- Left Panel: Product Details (Dark Theme) -->
                    <div class="md:w-2/5 bg-slate-800 text-white p-6 lg:p-8 flex flex-col justify-start pt-8 relative overflow-hidden">
                        <button onclick="navigateTo('home-view')" class="md:absolute top-8 left-8 text-gray-400 hover:text-blue-600 mb-6 md:mb-0 flex items-center gap-2 transition-colors text-sm">
                            <i class="fas fa-arrow-left"></i> Back to Home
                        </button>
                        <div class="max-w-md mx-auto">
                            <!-- Logo -->
                            <div class="mb-8">
                                <a href="#" onclick="navigateTo('home-view'); return false;" class="flex items-center gap-3 cursor-pointer hover:opacity-80 transition">
                                    <img src="https://cashmela.com/assets/images/cashmelawhite-logo.png" alt="CashMela" class="h-16 w-auto mx-auto" style="height: 64px !important;">
                                </a>
                            </div>
                            
                            <h2 class="text-3xl font-bold mb-4 text-blue-600" id="form-title-side">Personal Loan</h2>
                            <p class="text-gray-300 mb-8">One smart platform. Infinite possibilities.<br>Get your personal loan in just a click.</p>
                            
                            <ul class="space-y-4 text-gray-100 text-sm font-medium">
                                <li class="flex items-center gap-3"><i class="fas fa-check-circle text-blue-600 text-lg"></i> 100% Paperless</li>
                                <li class="flex items-center gap-3"><i class="fas fa-check-circle text-blue-600 text-lg"></i> Instant Approval</li>
                                <li class="flex items-center gap-3"><i class="fas fa-check-circle text-blue-600 text-lg"></i> Attractive Interest Rates</li>
                                <li class="flex items-center gap-3"><i class="fas fa-check-circle text-blue-600 text-lg"></i> Flexible Tenure</li>
                            </ul>
                            
                            <!-- Illustration -->
                            <div class="mt-12 text-center relative z-10">
                                <i class="fas fa-sack-dollar text-[120px] text-blue-600/20 drop-shadow-lg"></i>
                                <div class="flex justify-center -space-x-8 mt-[-30px]">
                                     <i class="fas fa-home text-4xl text-gray-500/30"></i>
                                     <i class="fas fa-car text-4xl text-gray-500/30 mt-4"></i>
                                     <i class="fas fa-graduation-cap text-4xl text-gray-500/30"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Panel: Employment Type Selection -->
                    <div class="md:w-3/5 bg-white p-8 lg:p-16 flex flex-col justify-center items-center">
                        <div class="w-full max-w-lg">
                            <!-- Progress Indicator -->
                            <div class="flex items-center justify-center mb-8 gap-2">
                                <div class="w-3 h-3 rounded-full bg-blue-600"></div>
                                <div class="w-3 h-3 rounded-full bg-gray-300"></div>
                                <div class="w-3 h-3 rounded-full bg-gray-300"></div>
                            </div>

                            <h3 class="text-2xl font-bold text-slate-800 mb-2">What best describes your employment type?</h3>
                            
                            <div class="space-y-4 mt-8">
                                <!-- Salaried Option -->
                                <label class="block cursor-pointer employment-option" data-value="Salaried">
                                    <input type="radio" name="employment" value="salaried" class="hidden" checked onchange="selectEmployment(this, 'Salaried')">
                                    <div class="border-2 border-blue-600 bg-white rounded-xl p-5 transition-all hover:shadow-md employment-card">
                                        <div class="flex items-center gap-3">
                                            <div class="w-6 h-6 rounded-full border-2 border-blue-600 flex items-center justify-center employment-circle">
                                                <div class="w-3 h-3 rounded-full bg-blue-600 employment-dot"></div>
                                            </div>
                                            <div>
                                                <div class="font-bold text-lg text-slate-800">Salaried</div>
                                                <div class="text-sm text-gray-600">Receive fixed amount of income every month</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>

                                <!-- Self Employed Business -->
                                <label class="block cursor-pointer employment-option" data-value="Self Employed Business">
                                    <input type="radio" name="employment" value="business" class="hidden" onchange="selectEmployment(this, 'Self Employed Business')">
                                    <div class="border-2 border-gray-300 bg-white rounded-xl p-5 transition-all hover:shadow-md employment-card">
                                        <div class="flex items-center gap-3">
                                            <div class="w-6 h-6 rounded-full border-2 border-gray-400 flex items-center justify-center employment-circle">
                                                <div class="w-3 h-3 rounded-full bg-transparent employment-dot"></div>
                                            </div>
                                            <div>
                                                <div class="font-bold text-lg text-slate-800">Self Employed Business</div>
                                                <div class="text-sm text-gray-600">Run a business</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>

                                <!-- Self Employed Professional -->
                                <label class="block cursor-pointer employment-option" data-value="Self Employed Professional">
                                    <input type="radio" name="employment" value="professional" class="hidden" onchange="selectEmployment(this, 'Self Employed Professional')">
                                    <div class="border-2 border-gray-300 bg-white rounded-xl p-5 transition-all hover:shadow-md employment-card">
                                        <div class="flex items-center gap-3">
                                            <div class="w-6 h-6 rounded-full border-2 border-gray-400 flex items-center justify-center employment-circle">
                                                <div class="w-3 h-3 rounded-full bg-transparent employment-dot"></div>
                                            </div>
                                            <div>
                                                <div class="font-bold text-lg text-slate-800">Self Employed Professional</div>
                                                <div class="text-sm text-gray-600">Engage in a professional (Eg: Doctor, C.A, lawyer, etc)</div>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                            </div>

                            <input type="hidden" id="selected-employment" value="Salaried">
                            
                            <button onclick="showPLStep(2)" class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl hover:bg-primary-600 transition shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 mt-8">
                                Proceed Next <i class="fas fa-chevron-right ml-2"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- STEP 2: Confirm Your Information -->
            <div id="pl-step-2" class="w-full hidden m-0 p-0" style="margin: 0 !important; padding: 0 !important;">
                <div class="flex flex-col md:flex-row min-h-screen m-0 p-0" style="margin: 0 !important; padding: 0 !important;">
                    <!-- Left Panel -->
                    <div class="md:w-2/5 bg-slate-800 text-white p-6 lg:p-8 flex flex-col justify-start pt-8 relative overflow-hidden">
                        <button onclick="showPLStep(1)" class="md:absolute top-8 left-8 text-gray-400 hover:text-blue-600 mb-6 md:mb-0 flex items-center gap-2 transition-colors text-sm">
                            <i class="fas fa-arrow-left"></i> Back to Previous Step
                        </button>
                        <div class="max-w-md mx-auto">
                            <!-- Logo -->
                            <div class="mb-8">
                                <a href="#" onclick="navigateTo('home-view'); return false;" class="flex items-center gap-3 cursor-pointer hover:opacity-80 transition">
                                    <img src="https://cashmela.com/assets/images/cashmelawhite-logo.png" alt="CashMela" class="h-16 w-auto mx-auto" style="height: 64px !important;">
                                </a>
                            </div>
                            
                            <h2 class="text-3xl font-bold mb-4 text-blue-600" id="form-title-side-step2">Personal Loan</h2>
                            <p class="text-gray-300 mb-8">One smart platform. Infinite possibilities.<br>Get your loan in just a click.</p>
                            
                            <ul class="space-y-4 text-gray-100 text-sm font-medium">
                                <li class="flex items-center gap-3"><i class="fas fa-check-circle text-blue-600 text-lg"></i> 100% Paperless</li>
                                <li class="flex items-center gap-3"><i class="fas fa-check-circle text-blue-600 text-lg"></i> Instant Approval</li>
                                <li class="flex items-center gap-3"><i class="fas fa-check-circle text-blue-600 text-lg"></i> Attractive Interest Rates</li>
                                <li class="flex items-center gap-3"><i class="fas fa-check-circle text-blue-600 text-lg"></i> Flexible Tenure</li>
                            </ul>
                            
                            <div class="mt-12 text-center relative z-10">
                                <i class="fas fa-sack-dollar text-[120px] text-blue-600/20 drop-shadow-lg"></i>
                                <div class="flex justify-center -space-x-8 mt-[-30px]">
                                     <i class="fas fa-home text-4xl text-gray-500/30"></i>
                                     <i class="fas fa-car text-4xl text-gray-500/30 mt-4"></i>
                                     <i class="fas fa-graduation-cap text-4xl text-gray-500/30"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Panel: Information Form -->
                    <div class="md:w-3/5 bg-white p-6 lg:p-12 flex flex-col justify-center overflow-y-auto max-h-screen">
                        <div class="w-full max-w-3xl mx-auto">
                            <!-- Progress Indicator -->
                            <div class="flex items-center justify-center mb-6 gap-2">
                                <div class="w-3 h-3 rounded-full bg-gray-300"></div>
                                <div class="w-3 h-3 rounded-full bg-blue-600"></div>
                                <div class="w-3 h-3 rounded-full bg-gray-300"></div>
                            </div>

                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-2xl font-bold text-slate-800">Confirm Your Information</h3>
                                <button type="button" onclick="autoFillForm()" class="bg-green-500 hover:bg-green-600 text-white font-semibold px-3 py-1.5 md:px-4 md:py-2 rounded-lg text-xs md:text-sm flex items-center gap-2 transition shadow-md hover:shadow-lg">
                                    <i class="fas fa-magic"></i> <span class="hidden sm:inline">Auto Fill</span> Demo
                                </button>
                            </div>
                            <p class="text-sm text-gray-600 mb-6">Accurate details help us match you with the best offers from trusted lenders</p>

                            <form id="pl-info-form" onsubmit="event.preventDefault(); submitPLInfo();" autocomplete="on">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                                    <!-- Full Name - MOVED TO FIRST -->
                                    <div>
                                        <label class="block text-xs font-semibold text-slate-800 mb-1">Your Full Name <span class="text-red-500">*</span></label>
                                        <input type="text" id="pl-fullname" name="fullname" autocomplete="name" required class="w-full border-b-2 border-gray-300 px-0 py-2 text-sm focus:outline-none focus:border-blue-600 transition-colors" placeholder="adil patel">
                                    </div>

                                    <!-- Mobile Number - MOVED TO SECOND -->
                                    <div>
                                        <label class="block text-xs font-semibold text-slate-800 mb-1">Mobile Number <span class="text-red-500">*</span></label>
                                        <div class="flex border-b-2 border-gray-300 focus-within:border-blue-600 transition-colors">
                                            <span class="text-gray-600 py-2 font-bold flex items-center text-xs pr-2">+91</span>
                                            <input type="tel" id="pl-mobile" name="mobile" autocomplete="tel" required maxlength="10" pattern="[6-9][0-9]{9}" class="w-full px-0 py-2 text-sm focus:outline-none" placeholder="7021148322">
                                        </div>
                                    </div>

                                    <!-- Email -->
                                    <div>
                                        <label class="block text-xs font-semibold text-slate-800 mb-1">Your Email <span class="text-red-500">*</span></label>
                                        <input type="email" id="pl-email" name="email" autocomplete="email" required class="w-full border-b-2 border-gray-300 px-0 py-2 text-sm focus:outline-none focus:border-blue-600 transition-colors" placeholder="adilpatel3110@gmail.com">
                                    </div>

                                    <!-- PAN -->
                                    <div>
                                        <label class="block text-xs font-semibold text-slate-800 mb-1">PAN <span class="text-red-500">*</span></label>
                                        <input type="text" id="pl-pan" name="pan" autocomplete="off" required maxlength="10" pattern="[A-Z]{5}[0-9]{4}[A-Z]{1}" class="w-full border-b-2 border-gray-300 px-0 py-2 text-sm focus:outline-none focus:border-blue-600 transition-colors uppercase" placeholder="ABCDE1234F" oninput="this.value = this.value.toUpperCase()">
                                    </div>

                                    <!-- DOB -->
                                    <div>
                                        <label class="block text-xs font-semibold text-slate-800 mb-1">DOB <span class="text-red-500">*</span></label>
                                        <input type="text" id="pl-dob" name="dob" autocomplete="bday" required placeholder="DD/MM/YYYY" maxlength="10" class="w-full border-b-2 border-gray-300 px-0 py-2 text-sm focus:outline-none focus:border-blue-600 transition-colors" oninput="formatDOB(this)">
                                    </div>

                                    <!-- Pincode -->
                                    <div>
                                        <label class="block text-xs font-semibold text-slate-800 mb-1">Pincode <span class="text-red-500">*</span></label>
                                        <input type="text" id="pl-pincode" name="pincode" autocomplete="postal-code" required maxlength="6" pattern="[1-9][0-9]{5}" class="w-full border-b-2 border-gray-300 px-0 py-2 text-sm focus:outline-none focus:border-blue-600 transition-colors" placeholder="400037">
                                    </div>

                                    <!-- Net Take Home Salary -->
                                    <div>
                                        <label class="block text-xs font-semibold text-slate-800 mb-1">Net Take Home Salary (Monthly) <span class="text-red-500">*</span></label>
                                        <input type="number" id="pl-income" name="income" autocomplete="off" required min="10000" class="w-full border-b-2 border-gray-300 px-0 py-2 text-sm focus:outline-none focus:border-blue-600 transition-colors" placeholder="58333">
                                        <p class="text-xs text-gray-500 italic mt-1" id="income-words"></p>
                                    </div>

                                    <!-- Desired Loan Amount -->
                                    <div>
                                        <label class="block text-xs font-semibold text-slate-800 mb-1">Desired Loan Amount <span class="text-red-500">*</span></label>
                                        <input type="number" id="pl-loan-amount" name="loan-amount" autocomplete="off" required min="10000" class="w-full border-b-2 border-gray-300 px-0 py-2 text-sm focus:outline-none focus:border-blue-600 transition-colors" placeholder="900000">
                                        <p class="text-xs text-gray-500 italic mt-1" id="loan-words"></p>
                                    </div>
                                </div>

                                    <!-- Terms and Conditions -->
                                    <div class="bg-gray-50 p-3 rounded-lg border border-gray-200 mt-4 md:col-span-2">
                                        <label class="flex items-start gap-2 cursor-pointer">
                                            <input type="checkbox" id="pl-terms" required class="mt-1 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-primary-500">
                                            <span class="text-xs text-gray-700">
                                                By clicking Submit, you agree to 
                                                <a href="#" onclick="openTermsModal(); return false;" class="text-blue-600 hover:underline font-semibold">Terms of Use</a>, 
                                                <a href="#" onclick="openPrivacyModal(); return false;" class="text-blue-600 hover:underline font-semibold">Privacy Policy</a>
                                                <a href="#" onclick="openCreditReportModal(); return false;" class="text-blue-600 hover:underline font-semibold">Credit Report Terms</a>
                                            </span>
                                        </label>
                                    </div>

                                <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 rounded-xl hover:bg-primary-600 transition shadow-lg mt-4">
                                    Submit <i class="fas fa-chevron-right ml-2"></i>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- STEP 2.5: Discover Best Offers (Loading/Processing) -->
            <div id="pl-step-2-5" class="w-full hidden">
                <div class="min-h-screen bg-gray-50 flex items-center justify-center p-8">
                    <div class="w-full max-w-4xl">
                        <!-- Header with loan amount -->
                        <div class="text-center mb-12">
                            <div class="inline-flex items-center gap-3 bg-white px-8 py-4 rounded-full shadow-lg mb-6">
                                <i class="fas fa-wallet text-blue-600 text-2xl"></i>
                                <div class="text-left">
                                    <div class="text-xs text-gray-600">Loan Amount</div>
                                    <div class="font-bold text-2xl text-slate-800" id="display-loan-amount-processing">8,00,000</div>
                                </div>
                            </div>
                            <h2 class="text-3xl font-bold text-slate-800 mb-4">Discovering Best <span id="form-title-processing">Personal Loan</span> Offers for You</h2>
                            <p class="text-gray-600">Please wait while we match your profile with 40+ partner banks and NBFCs</p>
                        </div>

                        <!-- Processing Steps -->
                        <div class="bg-white rounded-2xl shadow-xl p-8 mb-8">
                            <div class="space-y-6">
                                <!-- Step 1 -->
                                <div class="flex items-start gap-4 processing-step" id="process-step-1">
                                    <div class="flex-shrink-0 w-12 h-12 rounded-full bg-blue-600 flex items-center justify-center text-white">
                                        <i class="fas fa-check text-xl"></i>
                                    </div>
                                    <div class="flex-1 pt-2">
                                        <h3 class="font-bold text-slate-800 mb-1">Analyzing Your Profile</h3>
                                        <p class="text-sm text-gray-600">Verified employment type, income, and loan requirement</p>
                                    </div>
                                </div>

                                <!-- Step 2 -->
                                <div class="flex items-start gap-4 processing-step opacity-50" id="process-step-2">
                                    <div class="flex-shrink-0 w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center">
                                        <i class="fas fa-spinner fa-spin text-xl text-gray-500"></i>
                                    </div>
                                    <div class="flex-1 pt-2">
                                        <h3 class="font-bold text-gray-700 mb-1">Matching with Partner Banks</h3>
                                        <p class="text-sm text-gray-500">Comparing offers from Poonawalla Fincorp, Federal Bank, Fibe, and more...</p>
                                    </div>
                                </div>

                                <!-- Step 3 -->
                                <div class="flex items-start gap-4 processing-step opacity-50" id="process-step-3">
                                    <div class="flex-shrink-0 w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center">
                                        <i class="fas fa-search-dollar text-xl text-gray-400"></i>
                                    </div>
                                    <div class="flex-1 pt-2">
                                        <h3 class="font-bold text-gray-700 mb-1">Calculating Best Interest Rates</h3>
                                        <p class="text-sm text-gray-500">Finding lowest EMIs and processing fees for you</p>
                                    </div>
                                </div>

                                <!-- Step 4 -->
                                <div class="flex items-start gap-4 processing-step opacity-50" id="process-step-4">
                                    <div class="flex-shrink-0 w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center">
                                        <i class="fas fa-gift text-xl text-gray-400"></i>
                                    </div>
                                    <div class="flex-1 pt-2">
                                        <h3 class="font-bold text-gray-700 mb-1">Preparing Your Personalized Offers</h3>
                                        <p class="text-sm text-gray-500">Curating the best deals tailored to your needs</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Stats -->
                        <div class="grid grid-cols-3 gap-6">
                            <div class="bg-white rounded-xl p-6 text-center shadow-md">
                                <div class="text-3xl font-bold text-blue-600 mb-2">40+</div>
                                <div class="text-sm text-gray-600">Partner Banks</div>
                            </div>
                            <div class="bg-white rounded-xl p-6 text-center shadow-md">
                                <div class="text-3xl font-bold text-blue-600 mb-2">3.4L+</div>
                                <div class="text-sm text-gray-600">Happy Customers</div>
                            </div>
                            <div class="bg-white rounded-xl p-6 text-center shadow-md">
                                <div class="text-3xl font-bold text-blue-600 mb-2">24 Hrs</div>
                                <div class="text-sm text-gray-600">Quick Disbursal</div>
                            </div>
                        </div>

                        <div class="text-center mt-8">
                            <p class="text-xs text-gray-500">
                                <i class="fas fa-lock mr-1"></i> Your information is secure and encrypted
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- STEP 3: Bank Loan Offers -->
            <div id="pl-step-3" class="w-full hidden bg-gray-50 m-0 p-0" style="margin: 0 !important; padding: 0 !important;">
                <div class="min-h-screen m-0 p-0" style="margin: 0 !important; padding: 0 !important;">
                    <!-- Header -->
                    <div class="bg-slate-800 text-white p-3 sticky top-0 z-30 shadow-lg">
                        <div class="container mx-auto flex items-center justify-between">
                            <div class="flex items-center justify-center gap-4">
                                <!-- Logo -->
                                <a href="#" onclick="navigateTo('home-view'); return false;" class="flex items-center gap-3 cursor-pointer hover:opacity-80 transition">
                                    <img src="https://cashmela.com/assets/images/cashmelawhite-logo.png" alt="CashMela" class="h-16 w-auto mx-auto" style="height: 64px !important;">
                                </a>
                                
                                <button onclick="showPLStep(2)" class="text-gray-400 hover:text-blue-600 flex items-center gap-2 transition-colors text-sm">
                                    <i class="fas fa-arrow-left"></i> Back to Previous Step
                                </button>
                            </div>
                            
                            <div class="flex items-center gap-4 bg-white text-slate-800 px-6 py-3 rounded-full shadow-lg">
                                <i class="fas fa-lock text-blue-600"></i>
                                <div>
                                    <div class="text-xs text-gray-600">Loan Amount</div>
                                    <input type="text" id="display-loan-amount" value="8,00,000" class="font-bold text-lg border-0 p-0 w-32 focus:outline-none focus:ring-0" readonly>
                                </div>
                                <button onclick="toggleEditLoanAmount()" id="edit-loan-btn" class="text-blue-600 hover:text-primary-600 ml-2 flex items-center gap-1">
                                    <i class="fas fa-edit"></i> <span>Edit</span>
                                </button>
                                <button onclick="saveLoanAmount()" id="save-loan-btn" class="bg-blue-500 text-white px-4 py-1 rounded-lg hover:bg-green-600 hidden">
                                    <i class="fas fa-check"></i> Save
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Main Content -->
                    <div class="container mx-auto p-6">
                        <div class="flex flex-col lg:flex-row gap-6">
                            <!-- Filter Sidebar -->
                            <div class="lg:w-1/4">
                                <div class="bg-gray-100 text-slate-800 rounded-2xl p-6 sticky top-24 border border-gray-300">
                                    <!-- Filters & Sort by -->
                                    <div class="flex items-center justify-between mb-6">
                                        <h3 class="text-lg font-bold text-slate-800">Filters & Sort by</h3>
                                        <button onclick="clearAllFilters()" class="text-blue-600 text-sm hover:text-primary-400 transition font-semibold">Clear All</button>
                                    </div>

                                    <!-- Sort By -->
                                    <div class="mb-6">
                                        <h4 class="font-semibold text-sm mb-3 text-slate-800">Sort by</h4>
                                        <div class="space-y-2 text-sm">
                                            <label class="flex items-center gap-2 cursor-pointer text-gray-700">
                                                <input type="radio" name="sort-option" value="approval" checked onchange="sortBy('approval')" class="w-4 h-4 text-blue-600">
                                                <span>Approval Chances <span class="text-xs text-gray-500 italic">High to Low</span></span>
                                            </label>
                                            <label class="flex items-center gap-2 cursor-pointer text-gray-700">
                                                <input type="radio" name="sort-option" value="disbursal-low" onchange="sortBy('disbursal-low')" class="w-4 h-4 text-blue-600">
                                                <span>Disbursal Time <span class="text-xs text-gray-500 italic">Low to High</span></span>
                                            </label>
                                            <label class="flex items-center gap-2 cursor-pointer text-gray-700">
                                                <input type="radio" name="sort-option" value="emi-low" onchange="sortBy('emi-low')" class="w-4 h-4 text-blue-600">
                                                <span>EMI <span class="text-xs text-gray-500 italic">Low to High</span></span>
                                            </label>
                                            <label class="flex items-center gap-2 cursor-pointer text-gray-700">
                                                <input type="radio" name="sort-option" value="emi-high" onchange="sortBy('emi-high')" class="w-4 h-4 text-blue-600">
                                                <span>EMI <span class="text-xs text-gray-500 italic">High to Low</span></span>
                                            </label>
                                        </div>
                                    </div>

                                    <hr class="border-gray-300 mb-6">

                                    <!-- Processing Time -->
                                    <div class="mb-6">
                                        <h4 class="font-semibold text-sm mb-3 text-slate-800">Processing Time</h4>
                                        <div class="space-y-2 text-sm">
                                            <label class="flex items-center gap-2 cursor-pointer text-gray-700">
                                                <input type="checkbox" class="feature-checkbox w-4 h-4 rounded text-blue-600 border-gray-400" onchange="toggleFeature('instant', this.checked)">
                                                <span>Instant</span>
                                            </label>
                                            <label class="flex items-center gap-2 cursor-pointer text-gray-700">
                                                <input type="checkbox" class="feature-checkbox w-4 h-4 rounded text-blue-600 border-gray-400" onchange="toggleFeature('1-2days', this.checked)">
                                                <span>1 - 2 Days</span>
                                            </label>
                                            <label class="flex items-center gap-2 cursor-pointer text-gray-700">
                                                <input type="checkbox" class="feature-checkbox w-4 h-4 rounded text-blue-600 border-gray-400" onchange="toggleFeature('3-7days', this.checked)">
                                                <span>3 - 7 Days</span>
                                            </label>
                                            <label class="flex items-center gap-2 cursor-pointer text-gray-700">
                                                <input type="checkbox" class="feature-checkbox w-4 h-4 rounded text-blue-600 border-gray-400" onchange="toggleFeature('7plus', this.checked)">
                                                <span>7+ days</span>
                                            </label>
                                        </div>
                                    </div>

                                    <hr class="border-gray-300 mb-6">

                                    <!-- Process Type -->
                                    <div>
                                        <h4 class="font-semibold text-sm mb-3 text-slate-800">Process Type</h4>
                                        <div class="space-y-2 text-sm">
                                            <label class="flex items-center gap-2 cursor-pointer text-gray-700">
                                                <input type="checkbox" class="feature-checkbox w-4 h-4 rounded text-blue-600 border-gray-400" onchange="toggleFeature('assisted', this.checked)">
                                                <span>Assisted Process</span>
                                            </label>
                                            <label class="flex items-center gap-2 cursor-pointer text-gray-700">
                                                <input type="checkbox" class="feature-checkbox w-4 h-4 rounded text-blue-600 border-gray-400" onchange="toggleFeature('instant-online', this.checked)">
                                                <span>Instant Online</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Offers List -->
                            <div class="lg:w-3/4">
                                <h2 class="text-2xl font-bold text-slate-800 mb-6">Bank Loan Offers</h2>

                                <div id="offers-container" class="space-y-3">
<!-- Bank 1: Poonawalla Fincorp -->
    <div class="bg-white rounded-xl p-4 shadow-sm hover:shadow-md transition border border-gray-200 bank-offer mb-4" data-amount="50000" data-emi="13866" data-approval="90" data-disbursal-days="0" data-processing="instant" data-process-type="instant-online" data-features="digital,lowfee">
        <div class="flex items-start justify-between gap-4">
            <div class="flex items-start gap-4 flex-1">
                <div class="w-16 h-16 bg-purple-100 rounded-lg flex items-center justify-center flex-shrink-0">
                    <span class="font-bold text-purple-600 text-2xl">P</span>
                </div>
                <div class="flex-1">
                    <h3 class="text-xl font-bold text-slate-800 mb-4">Poonawalla Fincorp</h3>
                    <div class="grid grid-cols-4 gap-4">
                        <div>
                            <div class="text-xs text-gray-600 mb-1">Processing Time <i class="fas fa-info-circle text-gray-400"></i></div>
                            <div class="font-semibold text-slate-800">Instant</div>
                        </div>
                        <div>
                            <div class="text-xs text-gray-600 mb-1">Chances Of Approval <i class="fas fa-info-circle text-gray-400"></i></div>
                            <div class="flex items-center gap-1">
                                <div class="flex">
                                    <div class="w-2 h-5 bg-red-400 rounded-l"></div>
                                    <div class="w-2 h-5 bg-yellow-400"></div>
                                    <div class="w-2 h-5 bg-green-400 rounded-r"></div>
                                </div>
                                <span class="text-blue-600 font-semibold text-sm">EXCELLENT</span>
                            </div>
                        </div>
                        <div>
                            <div class="text-xs text-gray-600 mb-1">Interest Rate (p.a.)</div>
                            <div class="font-semibold text-slate-800">15% <span class="text-xs font-normal text-gray-500">onwards</span></div>
                            <div class="text-xs text-gray-500">APR: 16.44% <i class="fas fa-info-circle text-gray-400"></i></div>
                        </div>
                        <div>
                            <div class="text-xs text-gray-600 mb-1">EMI</div>
                            <div class="font-semibold text-slate-800">₹ 13,866 <span class="text-xs font-normal text-gray-500">onwards</span></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="flex flex-col items-end gap-2 flex-shrink-0">
                <button onclick="applyNow()" class="bg-blue-600 text-white px-8 py-2.5 rounded-lg hover:bg-primary-600 font-semibold whitespace-nowrap">Apply Now</button>
                <button class="text-blue-600 text-sm hover:text-primary-600 font-medium">+ Show Details</button>
            </div>
        </div>
    </div>

    <!-- Bank 2: Federal Bank -->
    <div class="bg-white rounded-xl p-4 shadow-sm hover:shadow-md transition border border-gray-200 bank-offer mb-4" data-amount="50000" data-emi="13286" data-approval="90" data-disbursal-days="0" data-processing="instant" data-process-type="instant-online" data-features="digital">
        <div class="flex items-start justify-between gap-4">
            <div class="flex items-start gap-4 flex-1">
                <div class="w-16 h-16 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                    <span class="font-bold text-blue-600 text-2xl">F</span>
                </div>
                <div class="flex-1">
                    <h3 class="text-xl font-bold text-slate-800 mb-4">Federal Bank</h3>
                    <div class="grid grid-cols-4 gap-4">
                        <div>
                            <div class="text-xs text-gray-600 mb-1">Processing Time <i class="fas fa-info-circle text-gray-400"></i></div>
                            <div class="font-semibold text-slate-800">Instant</div>
                        </div>
                        <div>
                            <div class="text-xs text-gray-600 mb-1">Chances Of Approval <i class="fas fa-info-circle text-gray-400"></i></div>
                            <div class="flex items-center gap-1">
                                <div class="flex">
                                    <div class="w-2 h-5 bg-red-400 rounded-l"></div>
                                    <div class="w-2 h-5 bg-yellow-400"></div>
                                    <div class="w-2 h-5 bg-green-400 rounded-r"></div>
                                </div>
                                <span class="text-blue-600 font-semibold text-sm">EXCELLENT</span>
                            </div>
                        </div>
                        <div>
                            <div class="text-xs text-gray-600 mb-1">Interest Rate (p.a.)</div>
                            <div class="font-semibold text-slate-800">12% <span class="text-xs font-normal text-gray-500">onwards</span></div>
                            <div class="text-xs text-gray-500">APR: 13.67% <i class="fas fa-info-circle text-gray-400"></i></div>
                        </div>
                        <div>
                            <div class="text-xs text-gray-600 mb-1">EMI</div>
                            <div class="font-semibold text-slate-800">₹ 13,286 <span class="text-xs font-normal text-gray-500">onwards</span></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="flex flex-col items-end gap-2 flex-shrink-0">
                <button onclick="applyNow()" class="bg-blue-600 text-white px-8 py-2.5 rounded-lg hover:bg-primary-600 font-semibold whitespace-nowrap">Apply Now</button>
                <button class="text-blue-600 text-sm hover:text-primary-600 font-medium">+ Show Details</button>
            </div>
        </div>
    </div>

    <!-- Bank 3: Fibe -->
    <div class="bg-white rounded-xl p-4 shadow-sm hover:shadow-md transition border border-gray-200 bank-offer mb-4" data-amount="10000" data-emi="15070" data-approval="90" data-disbursal-days="0" data-processing="instant" data-process-type="instant-online" data-features="digital,noforeclosure">
        <div class="flex items-start justify-between gap-4">
            <div class="flex items-start gap-4 flex-1">
                <div class="w-16 h-16 bg-indigo-100 rounded-lg flex items-center justify-center flex-shrink-0">
                    <span class="font-bold text-indigo-600 text-xl">fibe</span>
                </div>
                <div class="flex-1">
                    <h3 class="text-xl font-bold text-slate-800 mb-4">Fibe</h3>
                    <div class="grid grid-cols-4 gap-4">
                        <div>
                            <div class="text-xs text-gray-600 mb-1">Processing Time <i class="fas fa-info-circle text-gray-400"></i></div>
                            <div class="font-semibold text-slate-800">Instant</div>
                        </div>
                        <div>
                            <div class="text-xs text-gray-600 mb-1">Chances Of Approval <i class="fas fa-info-circle text-gray-400"></i></div>
                            <div class="flex items-center gap-1">
                                <div class="flex">
                                    <div class="w-2 h-5 bg-red-400 rounded-l"></div>
                                    <div class="w-2 h-5 bg-yellow-400"></div>
                                    <div class="w-2 h-5 bg-green-400 rounded-r"></div>
                                </div>
                                <span class="text-blue-600 font-semibold text-sm">EXCELLENT</span>
                            </div>
                        </div>
                        <div>
                            <div class="text-xs text-gray-600 mb-1">Interest Rate (p.a.)</div>
                            <div class="font-semibold text-slate-800">21% <span class="text-xs font-normal text-gray-500">onwards</span></div>
                            <div class="text-xs text-gray-500">APR: 22.76% <i class="fas fa-info-circle text-gray-400"></i></div>
                        </div>
                        <div>
                            <div class="text-xs text-gray-600 mb-1">EMI</div>
                            <div class="font-semibold text-slate-800">₹ 15,070 <span class="text-xs font-normal text-gray-500">onwards</span></div>
                        </div>
                    </div>
                    <div class="mt-3">
                        <span class="inline-block bg-gray-100 text-gray-700 text-xs px-3 py-1 rounded-full border border-gray-300">No Foreclosure Charges</span>
                    </div>
                </div>
            </div>
            <div class="flex flex-col items-end gap-2 flex-shrink-0">
                <button onclick="applyNow()" class="bg-blue-600 text-white px-8 py-2.5 rounded-lg hover:bg-primary-600 font-semibold whitespace-nowrap">Apply Now</button>
                <button class="text-blue-600 text-sm hover:text-primary-600 font-medium">+ Show Details</button>
            </div>
        </div>
    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- VIEW: INCOME TAX AI CALCULATOR (Final Budget 2024) -->
    

    <!-- VIEW: LOAN ELIGIBILITY CALCULATOR (AI-Powered with Deterministic Score) -->
    

    <style>
        /* AI Eligibility Score Color Classes */
        .score-strong { color: #10b981; } /* Emerald/Green */
        .score-moderate { color: #f59e0b; } /* Amber/Orange */
        .score-weak { color: #ef4444; } /* Red */
    </style>

    <script>
        // Eligibility Calculator JavaScript (Deterministic AI - No External API)
        let eligLatestLoanParams = null;

        // DOM Elements
        const eligCalculateBtn = document.getElementById('eligCalculateBtn');
        const eligSalaryInput = document.getElementById('eligSalaryInput');
        const eligExistingEmiInput = document.getElementById('eligExistingEmiInput');
        const eligResultsContainer = document.getElementById('eligResultsContainer');
        const eligMaxLoanAmountEl = document.getElementById('eligMaxLoanAmount');
        const eligEmiAmountEl = document.getElementById('eligEmiAmount');
        const eligExistingObligationsDisplay = document.getElementById('eligExistingObligationsDisplay');
        const eligTenureDisplay = document.getElementById('eligTenureDisplay');
        const eligRoiDisplay = document.getElementById('eligRoiDisplay');
        const eligMessageBox = document.getElementById('eligMessageBox');
        const eligSalaryError = document.getElementById('eligSalaryError');
        const eligAiAnalysisContainer = document.getElementById('eligAiAnalysisContainer');
        const eligAiLoading = document.getElementById('eligAiLoading');
        const eligAiResult = document.getElementById('eligAiResult');
        const eligSalaryInWords = document.getElementById('eligSalaryInWords');
        const eligSalaryWords = document.getElementById('eligSalaryWords');
        const eligEmiInWords = document.getElementById('eligEmiInWords');
        const eligEmiWords = document.getElementById('eligEmiWords');
        const eligCtaContainer = document.getElementById('eligCtaContainer');
        const eligBtSuggestionBox = document.getElementById('eligBtSuggestionBox');
        const eligAiEligibilityScore = document.getElementById('eligAiEligibilityScore');

        // Utility Functions
        function eligFormatCurrency(amount) {
            const num = Math.round(Math.max(0, amount));
            return new Intl.NumberFormat('en-IN', {
                style: 'currency',
                currency: 'INR',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0,
            }).format(num);
        }

        function eligNumberToWords(num) {
            if (num === 0) return 'Zero';
            
            const units = ['', 'one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine'];
            const teens = ['ten', 'eleven', 'twelve', 'thirteen', 'fourteen', 'fifteen', 'sixteen', 'seventeen', 'eighteen', 'nineteen'];
            const tens = ['', '', 'twenty', 'thirty', 'forty', 'fifty', 'sixty', 'seventy', 'eighty', 'ninety'];
            
            function convertGroup(n) {
                if (n === 0) return '';
                if (n < 10) return units[n];
                if (n < 20) return teens[n - 10];
                if (n < 100) return tens[Math.floor(n / 10)] + (n % 10 !== 0 ? ' ' + units[n % 10] : '');
                return units[Math.floor(n / 100)] + ' hundred' + (n % 100 !== 0 ? ' and ' + convertGroup(n % 100) : '');
            }

            let words = '';
            let tempNum = Math.floor(num);
            
            if (tempNum >= 10000000) {
                words += convertGroup(Math.floor(tempNum / 10000000)) + ' crore ';
                tempNum %= 10000000;
            }
            if (tempNum >= 100000) {
                words += convertGroup(Math.floor(tempNum / 100000)) + ' lakh ';
                tempNum %= 100000;
            }
            if (tempNum >= 1000) {
                words += convertGroup(Math.floor(tempNum / 1000)) + ' thousand ';
                tempNum %= 1000;
            }
            if (tempNum > 0) {
                words += convertGroup(tempNum);
            }
            
            return (words.trim().replace(/\s+/g, ' ') + ' Rupees').trim();
        }

        function eligGetLoanParameters(salary) {
            if (salary <= 0) return null;

            let foir, roi, tenure;

            if (salary < 30000) {
                foir = 0.50;
                roi = 12.00;
                tenure = 5;
            } else if (salary >= 30000 && salary < 40000) {
                foir = 0.55;
                roi = 11.50;
                tenure = 5;
            } else if (salary >= 40000 && salary < 50000) {
                foir = 0.60;
                roi = 11.00;
                tenure = 5;
            } else if (salary >= 50000 && salary < 75000) {
                foir = 0.65;
                roi = 10.50;
                tenure = 5;
            } else if (salary >= 75000 && salary < 100000) {
                foir = 0.70;
                roi = 10.25;
                tenure = 6;
            } else {
                foir = 0.75;
                roi = 9.99;
                tenure = 6;
            }

            return {
                salary: salary,
                foir: foir,
                roiAnnual: roi,
                tenureYears: tenure,
                rateMonthly: (roi / 100) / 12,
                totalMonths: tenure * 12
            };
        }

        function eligCalculateMaxPrincipal(emiMax, rateMonthly, totalMonths) {
            const r = rateMonthly;
            const n = totalMonths;

            if (r === 0) {
                return emiMax * n;
            }

            const powerFactor = Math.pow(1 + r, n);
            return emiMax * (powerFactor - 1) / (r * powerFactor);
        }

        async 

            const params = eligGetLoanParameters(salary);
            if (!params) {
                eligMessageBox.textContent = "Could not determine loan parameters based on the entered salary.";
                eligMessageBox.classList.remove('hidden');
                return;
            }
            eligLatestLoanParams = params;

            const totalMaxEmi = salary * params.foir;
            const emiNet = totalMaxEmi - existingObligations;

            eligSalaryWords.textContent = eligNumberToWords(salary);
            eligSalaryInWords.classList.remove('hidden');
            eligEmiWords.textContent = eligNumberToWords(existingObligations);
            eligEmiInWords.classList.remove('hidden');

            eligExistingObligationsDisplay.textContent = `Obligations: ${eligFormatCurrency(existingObligations)}`;
            eligTenureDisplay.textContent = `Tenure: ${params.tenureYears} Yrs`;
            eligRoiDisplay.textContent = `ROI: ${params.roiAnnual.toFixed(2)}%`;
            
            if (existingObligations > 0) {
                eligBtSuggestionBox.classList.remove('hidden');
            }

            if (emiNet <= 0) {
                eligMaxLoanAmountEl.textContent = '₹ 0';
                eligEmiAmountEl.textContent = eligFormatCurrency(emiNet);

                eligMessageBox.textContent = `Your existing monthly obligations (${eligFormatCurrency(existingObligations)}) utilize your full FOIR capacity (${eligFormatCurrency(totalMaxEmi)}). You currently have no eligible EMI for a new loan.`;
                eligMessageBox.classList.remove('hidden');
                eligMessageBox.classList.remove('bg-yellow-100', 'text-yellow-700');
                eligMessageBox.classList.add('bg-red-100', 'text-red-700');
                
                eligResultsContainer.classList.remove('hidden');

                eligLatestLoanParams.maxLoanAmount = 0;
                eligLatestLoanParams.emiNet = emiNet;
                eligLatestLoanParams.existingObligations = existingObligations;
                eligLatestLoanParams.totalMaxEmi = totalMaxEmi;
                
                eligRunDeterministicAILogic();
                return;
            }

            const maxLoanAmount = eligCalculateMaxPrincipal(emiNet, params.rateMonthly, params.totalMonths);

            eligLatestLoanParams.maxLoanAmount = maxLoanAmount;
            eligLatestLoanParams.emiNet = emiNet;
            eligLatestLoanParams.existingObligations = existingObligations;
            eligLatestLoanParams.totalMaxEmi = totalMaxEmi;

            eligMaxLoanAmountEl.textContent = eligFormatCurrency(maxLoanAmount);
            eligEmiAmountEl.textContent = eligFormatCurrency(emiNet);
            
            eligResultsContainer.classList.remove('hidden');
            eligMessageBox.classList.add('hidden');
            eligCtaContainer.classList.remove('hidden');

            eligRunDeterministicAILogic();
        }

        function eligRunDeterministicAILogic() {
            eligAiAnalysisContainer.classList.remove('hidden');
            eligAiLoading.classList.remove('hidden');
            eligAiResult.classList.add('hidden');

            setTimeout(() => {
                const { foir, roiAnnual, tenureYears, maxLoanAmount, emiNet, existingObligations, totalMaxEmi } = eligLatestLoanParams;
                const foirPercent = (foir * 100).toFixed(0);
                
                // AI Scoring Logic
                let score, profileStrength, scoreClass;
                const capacityRatio = emiNet / totalMaxEmi;

                if (emiNet <= 0) {
                    score = Math.floor(20 - (existingObligations / totalMaxEmi) * 10);
                    score = Math.max(10, score);
                    profileStrength = "Weak Profile";
                    scoreClass = "score-weak";
                } else if (capacityRatio >= 0.75) {
                    score = Math.floor(88 + (capacityRatio - 0.75) * 20);
                    score = Math.min(95, score);
                    profileStrength = "Strong Profile";
                    scoreClass = "score-strong";
                } else if (capacityRatio >= 0.30) {
                    score = Math.floor(60 + capacityRatio * 40);
                    profileStrength = "Moderate Profile";
                    scoreClass = "score-moderate";
                } else {
                    score = Math.floor(60 + capacityRatio * 10);
                    score = Math.min(68, score);
                    profileStrength = "Moderate Profile";
                    scoreClass = "score-moderate";
                }

                let summaryText = "";
                let adviceText = "";

                eligAiEligibilityScore.textContent = `${score}/100 – ${profileStrength}`;
                eligAiEligibilityScore.className = `text-3xl font-extrabold ${scoreClass}`;

                if (emiNet <= 0 && existingObligations > 0) {
                    summaryText = `Your eligible loan capacity is zero because existing obligations consume your full **${foirPercent}% FOIR limit** of ${eligFormatCurrency(totalMaxEmi)}.`;
                    adviceText = `**Actionable Advice:** We highly suggest exploring a **Loan Balance Transfer**. By consolidating debt, you can lower your monthly EMI outflow, instantly freeing up your **FOIR capacity** for a new loan amount.`;
                } else if (maxLoanAmount > 100000 || profileStrength === "Strong Profile") {
                    summaryText = `This is a strong eligibility outcome! Based on the **${foirPercent}% FOIR** rule, you are eligible for up to **${eligFormatCurrency(maxLoanAmount)}** at ${roiAnnual.toFixed(2)}% ROI.`;
                    adviceText = `
                        <p class="font-bold mb-2">Actionable Advice:</p>
                        <p>Since your eligibility is strong, **compare lenders**. Different institutions have varying risk appetites and internal FOIR limits. Shopping around can secure you a higher loan limit or a lower final interest rate for the same income.</p>
                    `;
                } else if (maxLoanAmount > 0) {
                    summaryText = `Your maximum eligibility, based on the **${foirPercent}% FOIR**, is ${eligFormatCurrency(maxLoanAmount)}. This indicates a moderate loan capacity after factoring in your existing obligations.`;
                    adviceText = `**Actionable Advice:** If you need a slightly larger loan, consider increasing the loan tenure (period) to reduce the required EMI, or actively pay down minor existing obligations to increase your available capacity.`;
                } else {
                    summaryText = `Your eligibility is minimal. The **${foirPercent}% FOIR** limit on your income significantly restricts your loan size.`;
                    adviceText = `**Actionable Advice:** Focus on strategies to increase your verifiable net monthly income to significantly boost your FOIR capacity.`;
                }
                
                eligAiResult.innerHTML = `
                    <p class="font-bold mb-2 text-indigo-800">${summaryText}</p>
                    ${adviceText}
                `;

                eligAiLoading.classList.add('hidden');
                eligAiResult.classList.remove('hidden');

            }, 500);
        }

        // Event Listeners
        eligCalculateBtn
        
        eligSalaryInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                alert("Feature coming soon!");
            }
        });

        eligExistingEmiInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                alert("Feature coming soon!");
            }
        });
    </script>

    <!-- VIEW: SMART LOAN CALCULATOR -->
    

    <!-- Smart Loan Calculator Styles -->
    <style>
        /* Calculator Tab Styling */
        
        
        

        

        /* Range Slider Styling */
        
        
        
        
        

        /* Prevent overlapping */
        
    </style>

    <!-- Smart Loan Calculator JavaScript -->
    <script>
        // Smart Loan Calculator State Management
        // CALCULATOR LOGIC
        let calcMode = 'emi';
        let calcType = 'personal';
        let chartInstance = null;
        let prepayChartInstance = null;
        let currentAmortData = [];
        let prepayData = {}; 
        let amortView = 'yearly';

        // Exact Defaults from Request
        const defaults = {
            personal: { amount: 1000000, rate: 9.99, tenure: 6, maxTenure: 9 }, 
            home: { amount: 3000000, rate: 7.5, tenure: 20, maxTenure: 30 },
            business: { amount: 2500000, rate: 13.0, tenure: 3, maxTenure: 7 }
        };

        const state = {
            amount: 500000, rate: 10.5, tenure: 5, income: 60000, // EMI mode
            currentBalance: 1500000, currentRate: 11.5, newRate: 9.99, remTenure: 6, // BT mode
            origAmount: 2000000, origTenure: 15, prepayAmt: 200000, paidEmis: 24 // Prepay mode
        };

        // Helper: Load Image for PDF
        async function loadImage(url) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.crossOrigin = "Anonymous";
                img.src = url;
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0);
                    resolve(canvas.toDataURL('image/png'));
                };
                img.onerror = (e) => {
                    console.warn("Image load failed", e);
                    reject(e);
                };
            });
        }

        function numToWords(n) {
            if (!n || n === 0) return "";
            n = Math.round(n);
            const units = ["", "One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine"];
            const teens = ["Ten", "Eleven", "Twelve", "Thirteen", "Fourteen", "Fifteen", "Sixteen", "Seventeen", "Eighteen", "Nineteen"];
            const tens = ["", "", "Twenty", "Thirty", "Forty", "Fifty", "Sixty", "Seventy", "Eighty", "Ninety"];
            function convert(num) {
                if (num < 10) return units[num];
                if (num < 20) return teens[num - 10];
                if (num < 100) return tens[Math.floor(num / 10)] + (num % 10 !== 0 ? " " + units[num % 10] : "");
                if (num < 1000) return units[Math.floor(num / 100)] + " Hundred" + (num % 100 !== 0 ? " " + convert(num % 100) : "");
                return "";
            }
            let str = "";
            if (n >= 10000000) { str += convert(Math.floor(n / 10000000)) + " Crore "; n %= 10000000; }
            if (n >= 100000) { str += convert(Math.floor(n / 100000)) + " Lakh "; n %= 100000; }
            if (n >= 1000) { str += convert(Math.floor(n / 1000)) + " Thousand "; n %= 1000; }
            if (n > 0) { str += convert(n); }
            return str.trim() + " Rupees";
        }

        function initSmartLoanCalculator() {
            try {
                console.log('=== INIT SMART LOAN CALCULATOR START ===');
                
                // Check if required elements exist
                const container = document.getElementById('calc-input-container');
                const outputLabel = document.getElementById('calc-primary-output-label');
                const outputValue = document.getElementById('calc-primary-output-value');
                const chartCanvas = document.getElementById('calcLoanChart');
                
                console.log('Elements check:', {
                    container: !!container,
                    outputLabel: !!outputLabel,
                    outputValue: !!outputValue,
                    chartCanvas: !!chartCanvas
                });
                
                if (!container) {
                    console.error('CRITICAL: calc-input-container not found!');
                    alert('Error: Calculator container not found. Please refresh the page.');
                    return;
                }
                
                // Set initial mode and type
                calcMode = 'emi';
                calcType = 'personal';
                
                console.log('Mode set:', calcMode, 'Type:', calcType);
                
                // Initialize state with personal loan defaults
                const defs = defaults[calcType];
                console.log('Defaults:', defs);
                
                state.amount = defs.amount;
                state.rate = defs.rate;
                state.tenure = defs.tenure;
                state.income = 60000;
                
                console.log('State after init:', JSON.stringify(state));
                
                // Render inputs
                console.log('Calling renderInputs...');
                renderInputs();
                console.log('renderInputs completed');
                
                // Calculate
                console.log('Calling calculate...');
                calculate();
                console.log('calculate completed');
                
                console.log('=== INIT SMART LOAN CALCULATOR END ===');
            } catch (error) {
                console.error('FATAL ERROR in initSmartLoanCalculator:', error);
                console.error('Stack trace:', error.stack);
                alert('Calculator initialization failed: ' + error.message);
            }
        }

        function switchCalcMode(mode) {
            calcMode = mode;
            ['emi', 'bt', 'prepay'].forEach(m => {
                const btn = document.getElementById(`calc-tab-${m}`);
                if (m === mode) {
                    btn.className = 'flex-1 py-3 text-sm font-bold text-blue-600 bg-white border-b-2 border-blue-600 transition';
                } else {
                    btn.className = 'flex-1 py-3 text-sm font-bold text-gray-600 hover:text-blue-600 hover:bg-white transition border-r border-gray-100';
                }
            });

            const calcBtnText = document.getElementById('calculate-btn-text');
            
            if (mode === 'prepay') {
                document.getElementById('view-standard').classList.add('hidden');
                document.getElementById('view-prepay').classList.remove('hidden');
                document.getElementById('view-prepay').classList.add('flex');
                
                state.origAmount = 1000000; 
                state.origTenure = 6;       
                state.paidEmis = 12;        
                state.prepayAmt = 200000;   
                state.rate = 9.99; 
                
                calcBtnText.innerText = "Calculate Savings"; 
            } else if (mode === 'bt') {
                document.getElementById('view-prepay').classList.add('hidden');
                document.getElementById('view-prepay').classList.remove('flex');
                document.getElementById('view-standard').classList.remove('hidden');
                
                state.currentBalance = 1500000; 
                state.remTenure = 6;            
                state.currentRate = 11.50;      
                state.newRate = 9.99;           
                
                calcBtnText.innerText = "Calculate";
            } else {
                document.getElementById('view-prepay').classList.add('hidden');
                document.getElementById('view-prepay').classList.remove('flex');
                document.getElementById('view-standard').classList.remove('hidden');
                
                const defs = defaults[calcType];
                state.amount = defs.amount;
                state.rate = defs.rate;
                state.tenure = defs.tenure;

                calcBtnText.innerText = "Calculate";
            }

            renderInputs();
            calculate();
        }

        function handleCalcLoanTypeChange(type) {
            calcType = type;
            if (calcMode === 'emi') {
                state.amount = defaults[type].amount;
                state.rate = defaults[type].rate;
                state.tenure = defaults[type].tenure;
            }
            renderInputs();
            calculate();
        }

        function renderInputs() {
            const container = document.getElementById('calc-input-container');
            if (!container) {
                console.error('calc-input-container not found');
                return;
            }
            container.innerHTML = '';
            
            const maxT = defaults[calcType].maxTenure;

            if (calcMode === 'emi') {
                addSlider(container, 'Loan Amount', 'amount', state.amount, 50000, 10000000, 10000, '₹', true);
                addSlider(container, 'Interest Rate', 'rate', state.rate, 1, 25, 0.1, '%');
                addSlider(container, 'Loan Tenure', 'tenure', state.tenure, 1, maxT, 1, 'Years');
                addSlider(container, 'Net Monthly Income', 'income', state.income, 10000, 1000000, 5000, '₹', true);
            } else if (calcMode === 'bt') {
                addSlider(container, 'Outstanding Balance', 'currentBalance', state.currentBalance, 10000, 5000000, 10000, '₹', true);
                addSlider(container, 'Remaining Tenure', 'remTenure', state.remTenure, 1, maxT, 0.5, 'Years');
                addSlider(container, 'Current Rate', 'currentRate', state.currentRate, 5, 25, 0.1, '%');
                addSlider(container, 'New Rate', 'newRate', state.newRate, 5, 25, 0.1, '%');
            } else if (calcMode === 'prepay') {
                addSlider(container, 'Original Loan', 'origAmount', state.origAmount, 100000, 10000000, 10000, '₹', true);
                addSlider(container, 'Interest Rate', 'rate', state.rate, 1, 20, 0.1, '%');
                addSlider(container, 'Original Tenure', 'origTenure', state.origTenure, 1, maxT, 1, 'Years');
                addSlider(container, 'EMIs Paid', 'paidEmis', state.paidEmis, 1, 120, 1, 'Months');
                addSlider(container, 'Prepayment Amount', 'prepayAmt', state.prepayAmt, 5000, 5000000, 5000, '₹', true);
            }
        }

        function addSlider(parent, label, key, val, min, max, step, suffix, showWords = false) {
            try {
                console.log('addSlider:', label, key, val);
                const div = document.createElement('div');
                div.className = "flex flex-col gap-1";
                
                const wordsHtml = showWords ? `<div id="words-${key}" class="text-[10px] text-blue-600 font-medium h-3 truncate">${numToWords(val)}</div>` : '';

                div.innerHTML = `
                    <div class="flex justify-between items-end">
                        <label class="text-xs font-bold text-gray-500 uppercase tracking-tight">${label}</label>
                        <input type="text" value="${formatVal(val, suffix)}" 
                            class="text-right text-sm font-bold text-gray-800 bg-transparent border-b border-dashed border-gray-300 w-28 outline-none focus:border-blue-500"
                            onchange="updateVal('${key}', this.value, '${suffix}')">
                    </div>
                    ${wordsHtml}
                    <input type="range" min="${min}" max="${max}" step="${step}" value="${val}"
                        class="accent-blue-600 h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer mt-1"
                        oninput="updateSlider('${key}', this.value, '${suffix}', ${showWords})">
                `;
                parent.appendChild(div);
            } catch (error) {
                console.error('Error in addSlider:', error);
                throw error;
            }
        }

        function updateSlider(key, val, suffix, showWords) {
            state[key] = parseFloat(val);
            const container = document.querySelector(`input[oninput="updateSlider('${key}', this.value, '${suffix}', ${showWords})"]`).parentNode;
            const input = container.querySelector('input[type="text"]');
            input.value = formatVal(state[key], suffix);
            
            if(showWords) {
                const w = container.querySelector(`#words-${key}`);
                if(w) w.innerText = numToWords(state[key]);
            }
            calculate();
        }

        function updateVal(key, val, suffix) {
            let num = parseFloat(val.replace(/[^0-9.]/g, ''));
            if(isNaN(num)) num = 0;
            if(key === 'tenure' || key === 'origTenure' || key === 'remTenure') {
                const max = defaults[calcType].maxTenure;
                if(num > max) num = max;
            }
            state[key] = num;
            renderInputs(); 
            calculate();
        }

        function formatVal(val, suffix) {
            if (suffix === '%') return `${val}%`;
            if (suffix === 'Years' || suffix === 'Months') return `${val} ${suffix}`;
            return `₹ ${val.toLocaleString('en-IN')}`;
        }

        function calculate() {
            try {
                console.log('calculate() called, mode:', calcMode);
                if (calcMode === 'emi') {
                    console.log('Running doEMI()');
                    doEMI();
                } else if (calcMode === 'bt') {
                    console.log('Running doBT()');
                    doBT();
                } else if (calcMode === 'prepay') {
                    console.log('Running doPrepay()');
                    doPrepay();
                }
                console.log('calculate() completed');
            } catch (error) {
                console.error('Error in calculate():', error);
                console.error('Stack:', error.stack);
            }
        }

        function doEMI() {
            try {
                console.log('doEMI() started, state:', JSON.stringify(state));
                const { amount, rate, tenure, income } = state;
                console.log('Extracted values:', { amount, rate, tenure, income });
                
                const r = rate / 12 / 100;
                const n = tenure * 12;
                const emi = (amount * r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
                const totalAmt = emi * n;
                const totalInt = totalAmt - amount;
                
                console.log('Calculated:', { emi, totalAmt, totalInt });

                console.log('Calling renderResults...');
                renderResults('Monthly EMI', emi, [
                    { l: 'Principal', v: Math.round(amount) },
                    { l: 'Total Interest', v: Math.round(totalInt), c: 'text-orange-600' },
                    { l: 'Total Payment', v: Math.round(totalAmt) }
                ]);
                console.log('renderResults completed');
                
                console.log('Calling renderChart...');
                renderChart([amount, totalInt], ['Principal', 'Interest']);
                console.log('renderChart completed');
                
                const insightText = document.getElementById('calc-ai-insight-text');
                if(insightText) {
                    const dti = (emi / income) * 100;
                    const isSafe = dti <= 42;
                    const ratio = Math.round((totalInt / amount) * 100);
                    
                    let dtiHtml = '';
                    if(income > 0) {
                        dtiHtml = `
                        <li class="${isSafe ? 'text-green-700' : 'text-red-600'}">
                            <strong>Budget Check (42% Rule):</strong> Your EMI is <strong>${dti.toFixed(1)}%</strong> of your income. 
                            ${isSafe 
                                ? `<span class="text-green-700">Safe! It is within the recommended 42% limit.</span>` 
                                : `<span class="text-red-600">Risky! It exceeds the 42% limit. Consider a longer tenure or lower amount.</span>`}
                        </li>`;
                    }

                    insightText.innerHTML = `
                        <ul class="list-disc pl-4 space-y-1">
                            ${dtiHtml}
                            <li>At <strong>${rate}%</strong>, you pay <strong>${ratio}%</strong> interest on principal.</li>
                            <li><strong>Advice:</strong> ${ratio > 50 ? "Tenure is high. Increasing EMI by 5% reduces tenure significantly." : "Balanced loan structure. Consider prepayments to save interest."}</li>
                        </ul>
                    `;
                }
                
                console.log('Calling genAmort...');
                genAmort(amount, r, n, emi);
                console.log('doEMI() completed successfully');
            } catch (error) {
                console.error('Error in doEMI():', error);
                console.error('Stack:', error.stack);
                throw error;
            }
        }

        function doBT() {
            const { currentBalance, currentRate, newRate, remTenure } = state;
            const n = remTenure * 12;
            const r1 = currentRate / 12 / 100;
            const r2 = newRate / 12 / 100;
            
            const oldEMI = (currentBalance * r1 * Math.pow(1+r1, n)) / (Math.pow(1+r1, n)-1);
            const newEMI = (currentBalance * r2 * Math.pow(1+r2, n)) / (Math.pow(1+r2, n)-1);
            const savings = (oldEMI * n) - (newEMI * n);
            const monthlySave = oldEMI - newEMI;

            renderResults('Total Savings', savings, [
                { l: 'Current EMI', v: Math.round(oldEMI) },
                { l: 'New EMI', v: Math.round(newEMI), c: 'text-green-600 font-bold' },
                { l: 'Monthly Save', v: Math.round(oldEMI - newEMI) }
            ]);
            renderChart([(newEMI*n), savings], ['New Cost', 'Savings'], ['#cbd5e1', '#10b981']);

            const insightText = document.getElementById('calc-ai-insight-text');
            if(insightText) {
                insightText.innerHTML = savings > 0 
                    ? `
                    <ul class="list-disc pl-4 space-y-1">
                        <li><strong>Switch Recommended:</strong> You save a total of <strong>₹${Math.round(savings).toLocaleString('en-IN')}</strong>.</li>
                        <li><strong>Cash Flow:</strong> Instantly free up <strong>₹${Math.round(monthlySave).toLocaleString('en-IN')}</strong> per month.</li>
                    </ul>`
                    : `<p><strong>Stay Put:</strong> No benefit found. Current lender is better.</p>`;
            }
            genAmort(currentBalance, r2, n, newEMI);
        }

        function doPrepay() {
            const { origAmount, rate, origTenure, paidEmis, prepayAmt } = state;
            const r = rate / 12 / 100;
            const n = origTenure * 12;
            const emi = (origAmount * r * Math.pow(1+r, n)) / (Math.pow(1+r, n)-1);
            
            let bal = origAmount;
            for(let i=0; i<paidEmis; i++) bal = bal - (emi - (bal*r));
            if(bal < 0) bal = 0;

            let newBal = bal - prepayAmt;
            if(newBal < 0) newBal = 0;

            const remMonthsOrig = n - paidEmis;
            const totalPayOrig = emi * remMonthsOrig;
            const totalIntOrig = totalPayOrig - bal;

            let monthsA = 0, tempA = newBal;
            while(tempA > 0 && monthsA < 600) {
                tempA = tempA - (emi - (tempA*r));
                monthsA++;
            }
            const totalPayA = emi * monthsA;
            const totalIntA = totalPayA - newBal;
            const savedIntA = totalIntOrig - totalIntA; 

            const newEMIB = (newBal * r * Math.pow(1+r, remMonthsOrig)) / (Math.pow(1+r, remMonthsOrig)-1);
            const totalPayB = newEMIB * remMonthsOrig;
            const totalIntB = totalPayB - newBal;
            const savedIntB = totalIntOrig - totalIntB;

            setText('pp-orig-emi', `₹${Math.round(emi).toLocaleString('en-IN')}`);
            setText('pp-orig-tenure', `${remMonthsOrig} Months`);
            setText('pp-orig-total', `₹${Math.round(totalPayOrig).toLocaleString('en-IN')}`);

            setText('pp-optA-emi', `₹${Math.round(emi).toLocaleString('en-IN')}`);
            setText('pp-optA-tenure', `${monthsA} Months`);
            setText('pp-optA-months-saved', `${Math.max(0, remMonthsOrig - monthsA)}`);
            setText('pp-optA-saved', `₹${Math.round(savedIntA).toLocaleString('en-IN')}`);
            setText('pp-optA-total', `₹${Math.round(totalPayA + prepayAmt).toLocaleString('en-IN')}`);
            const saveA = totalPayOrig - (totalPayA + prepayAmt); 
            setText('pp-optA-total-save', `₹${Math.round(saveA).toLocaleString('en-IN')}`);

            setText('pp-optB-emi', `₹${Math.round(newEMIB).toLocaleString('en-IN')}`);
            setText('pp-optB-tenure', `${remMonthsOrig} Months`);
            setText('pp-optB-saved', `₹${Math.round(savedIntB).toLocaleString('en-IN')}`);
            setText('pp-optB-total', `₹${Math.round(totalPayB + prepayAmt).toLocaleString('en-IN')}`);
            const saveB = totalPayOrig - (totalPayB + prepayAmt); 
            setText('pp-optB-total-save', `₹${Math.round(saveB).toLocaleString('en-IN')}`);

            setText('pp-total-saved', `₹${Math.round(Math.max(savedIntA, savedIntB)).toLocaleString('en-IN')}`);
            renderPrepayChart([totalPayOrig, totalPayA, totalPayB]);

            prepayData = {
                orig: { int: totalIntOrig, tenure: remMonthsOrig, emi: emi, total: totalPayOrig },
                optA: { int: totalIntA, save: savedIntA, tenure: monthsA, emi: emi, total: totalPayA, totalSave: saveA },
                optB: { int: totalIntB, save: savedIntB, emi: newEMIB, tenure: remMonthsOrig, total: totalPayB, totalSave: saveB }
            };

            const isTenureBetter = savedIntA > savedIntB;
            const monthsSaved = Math.max(0, remMonthsOrig - monthsA);
            const diffSave = Math.abs(savedIntA - savedIntB);
            const yearsFaster = (monthsSaved / 12).toFixed(1);
            
            const aiText = document.getElementById('pp-ai-insight-text');
            if(aiText) {
                aiText.innerHTML = `
                    <div class="space-y-4">
                        <div>
                            <h5 class="font-bold text-gray-800 flex items-center gap-2 mb-2 text-sm"><i class="fas fa-chart-bar text-blue-600"></i> Prepayment Comparison:</h5>
                            <ul class="text-[11px] text-gray-700 space-y-2 ml-1 leading-relaxed">
                                <li>• <strong>Without Prepayment:</strong> Pay ₹${Math.round(emi).toLocaleString('en-IN')} EMI for ${(remMonthsOrig/12).toFixed(1)} years = Total ₹${Math.round(totalPayOrig).toLocaleString('en-IN')}</li>
                                <li>• <strong>Option A (Reduce Tenure):</strong> Save ${monthsSaved} months + ₹${Math.round(savedIntA).toLocaleString('en-IN')} interest</li>
                                <li>• <strong>Option B (Reduce EMI):</strong> Pay ₹${Math.round(emi - newEMIB).toLocaleString('en-IN')} less/month + ₹${Math.round(savedIntB).toLocaleString('en-IN')} interest</li>
                            </ul>
                        </div>
                        
                        <div class="bg-blue-50/80 p-3 rounded-lg border border-blue-100">
                            <div class="text-blue-700 font-bold text-xs flex items-center gap-2 mb-2">
                                <i class="fas fa-check-square"></i> RECOMMENDATION: Choose ${isTenureBetter ? 'Option A' : 'Option B'}
                            </div>
                            <p class="text-xs text-gray-600 leading-relaxed">
                                Become debt-free <strong>${yearsFaster} years faster</strong> and save an extra <strong>₹${Math.round(diffSave).toLocaleString('en-IN')}</strong> compared to ${isTenureBetter ? 'Option B' : 'Option A'}!
                            </p>
                        </div>

                        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-2 text-[10px] text-yellow-900 font-medium">
                            <i class="fas fa-lightbulb text-yellow-600 mr-1"></i> <strong>Pro Tip:</strong> Any prepayment gives you a guaranteed tax-free return equal to your loan interest rate (${state.rate}%). This beats most FD rates!
                        </div>
                    </div>
                `;
            }

            genAmort(newBal, r, monthsA, emi);
        }

        function setText(id, text) {
            const el = document.getElementById(id);
            if(el) el.innerText = text;
        }

        function renderResults(mainLabel, mainVal, details) {
            const labelEl = document.getElementById('calc-primary-output-label');
            const valEl = document.getElementById('calc-primary-output-value');
            const wordsEl = document.getElementById('calc-primary-output-words');
            const gridEl = document.getElementById('calc-results-grid');

            if (labelEl) labelEl.innerText = mainLabel;
            if (valEl) valEl.innerText = `₹ ${Math.round(mainVal).toLocaleString('en-IN')}`;
            if (wordsEl) wordsEl.innerText = numToWords(Math.round(mainVal));

            if (gridEl) {
                gridEl.innerHTML = details.map(d => `
                    <div class="flex justify-between border-b border-gray-100 pb-1 last:border-0">
                        <span class="text-gray-500">${d.l}</span>
                        <span class="font-medium text-gray-900 ${d.c || ''}">${typeof d.v === 'number' ? '₹ '+d.v.toLocaleString('en-IN') : d.v}</span>
                    </div>
                `).join('');
            }
        }

        function renderChart(data, labels, colors = ['#4169E1', '#f97316']) {
            const canvas = document.getElementById('calcLoanChart');
            if (!canvas) {
                console.error('calcLoanChart canvas not found');
                return;
            }
            const ctx = canvas.getContext('2d');
            if(chartInstance) chartInstance.destroy();
            chartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: { labels, datasets: [{ data, backgroundColor: colors, borderWidth: 0 }] },
                options: { responsive: true, maintainAspectRatio: false, cutout: '75%', plugins: { legend: { display: false } } }
            });
        }

        function renderPrepayChart(data) {
            const canvas = document.getElementById('calcPrepayChart');
            if (!canvas) {
                console.error('calcPrepayChart canvas not found');
                return;
            }
            const ctx = canvas.getContext('2d');
            if(prepayChartInstance) prepayChartInstance.destroy();
            prepayChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: { 
                    labels: ['Without Prepay', 'Reduce Tenure', 'Reduce EMI'], 
                    datasets: [{ 
                        data: data, 
                        backgroundColor: ['#ef4444', '#3b82f6', '#22c55e'], 
                        borderWidth: 0 
                    }] 
                },
                options: { responsive: true, maintainAspectRatio: false, cutout: '70%', plugins: { legend: { display: false } } }
            });
        }

        function genAmort(P, r, n, emi) {
            currentAmortData = [];
            let bal = P;
            for(let i=1; i<=n; i++) {
                if(bal <= 0) break;
                const int = bal * r;
                let prin = emi - int;
                if(prin > bal) prin = bal;
                currentAmortData.push({ i, open: bal, emi, prin, int, close: bal - prin });
                bal -= prin;
            }
            renderAmortTable();
        }

        function setAmortView(view) {
            amortView = view;
            document.getElementById('btn-view-yearly').className = view === 'yearly' 
                ? 'px-3 py-1 text-[10px] font-bold rounded bg-blue-100 text-blue-700 transition'
                : 'px-3 py-1 text-[10px] font-bold rounded text-gray-500 hover:bg-gray-100 transition';
            document.getElementById('btn-view-monthly').className = view === 'monthly'
                ? 'px-3 py-1 text-[10px] font-bold rounded bg-blue-100 text-blue-700 transition'
                : 'px-3 py-1 text-[10px] font-bold rounded text-gray-500 hover:bg-gray-100 transition';
            renderAmortTable();
        }

        function renderAmortTable() {
            const tbody = document.getElementById('amortization-body');
            tbody.innerHTML = '';
            let dataToShow = [];
            if(amortView === 'yearly') {
                const map = {};
                currentAmortData.forEach(r => {
                    const y = Math.ceil(r.i/12);
                    if(!map[y]) map[y] = { i: `Year ${y}`, open: r.open, emi:0, prin:0, int:0, close: r.close };
                    map[y].emi += r.emi; map[y].prin += r.prin; map[y].int += r.int; map[y].close = r.close;
                });
                dataToShow = Object.values(map);
            } else {
                dataToShow = currentAmortData.map(d => ({ ...d, i: `Month ${d.i}` }));
            }
            dataToShow.forEach(row => {
                tbody.innerHTML += `
                    <tr class="hover:bg-blue-50 transition">
                        <td class="py-2 text-gray-900 font-medium">${row.i}</td>
                        <td class="py-2 text-right text-gray-500">₹${Math.round(row.open).toLocaleString('en-IN')}</td>
                        <td class="py-2 text-right text-gray-900">₹${Math.round(row.emi).toLocaleString('en-IN')}</td>
                        <td class="py-2 text-right text-blue-600">₹${Math.round(row.prin).toLocaleString('en-IN')}</td>
                        <td class="py-2 text-right text-orange-600">₹${Math.round(row.int).toLocaleString('en-IN')}</td>
                        <td class="py-2 text-right text-gray-900 font-bold">₹${Math.round(row.close).toLocaleString('en-IN')}</td>
                    </tr>
                `;
            });
        }

        function toggleAmortization() {
            const box = document.getElementById('amortization-container');
            const icon = document.getElementById('amort-icon');
            box.classList.toggle('hidden');
            icon.classList.toggle('fa-chevron-up');
            icon.classList.toggle('fa-chevron-down');
        }

        async function downloadAmortizationPDFOnly(event) {
            event.stopPropagation();
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const logoUrl = 'https://cashmela.com/assets/images/cashmela-logo.png';
            try {
                const logoData = await loadImage(logoUrl);
                doc.addImage(logoData, 'PNG', 15, 10, 40, 10);
            } catch(e) {
                doc.setFillColor(65, 105, 225); doc.rect(0, 0, 210, 20, 'F');
                doc.setTextColor(255, 255, 255); doc.setFontSize(18); doc.setFont(undefined, 'bold');
                doc.text('CashMela', 15, 13);
            }

            doc.setTextColor(0,0,0); doc.setFontSize(10);
            const title = calcMode === 'prepay' ? 'Revised Repayment Schedule (Option A)' : 'Repayment Schedule';
            doc.text(title, 15, 30);
            const tableData = currentAmortData.map(r => [`Month ${r.i}`, Math.round(r.open).toLocaleString('en-IN'), Math.round(r.emi).toLocaleString('en-IN'), Math.round(r.prin).toLocaleString('en-IN'), Math.round(r.int).toLocaleString('en-IN'), Math.round(r.close).toLocaleString('en-IN')]);
            doc.autoTable({ startY: 35, head: [['Period', 'Opening', 'EMI', 'Principal', 'Interest', 'Closing']], body: tableData, theme: 'grid', headStyles: { fillColor: [65, 105, 225] }, styles: { fontSize: 8 }, });
            
            const pageCount = doc.internal.getNumberOfPages();
            for(let i=1; i<=pageCount; i++) {
                doc.setPage(i); doc.setFontSize(8); doc.setTextColor(150);
                doc.text('CashMela - India\'s Trusted Loan Advisor | www.cashmela.com', 105, 290, { align: 'center' });
            }
            doc.save('CashMela_Amortization.pdf');
        }

        async function downloadCalculationPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const logoUrl = 'https://cashmela.com/assets/images/cashmela-logo.png';
            try {
                const logoData = await loadImage(logoUrl);
                doc.addImage(logoData, 'PNG', 15, 10, 40, 10);
            } catch(e) {
                doc.setFillColor(65, 105, 225); doc.rect(0, 0, 210, 30, 'F');
                doc.setTextColor(255, 255, 255); doc.setFontSize(18); doc.setFont(undefined, 'bold');
                doc.text('CashMela', 15, 15);
            }
            
            doc.setTextColor(0, 0, 0); doc.setFontSize(12); doc.setFont(undefined, 'bold');
            doc.text(`${calcMode.toUpperCase()} Analysis`, 15, 40);
            doc.setFontSize(10); doc.setFont(undefined, 'normal');
            const date = new Date().toLocaleDateString();
            doc.text(`Date: ${date}`, 160, 40);

            let y = 50;

            if(calcMode === 'prepay') {
                doc.setFontSize(11); doc.setTextColor(0, 0, 0); doc.setFont(undefined, 'bold');
                doc.text("Strategic Comparison (Detailed)", 15, y);
                try { const canvas = document.getElementById('calcPrepayChart'); const img = canvas.toDataURL('image/png'); doc.addImage(img, 'PNG', 150, y-10, 40, 40); } catch(e) {}
                y += 8;
                const comparisonData = [
                    ['Metric', 'Current (No Prepay)', 'Option A (Time)', 'Option B (Reduce EMI)'],
                    ['Monthly EMI', `Rs ${Math.round(prepayData.orig.emi).toLocaleString('en-IN')}`, `Rs ${Math.round(prepayData.optA.emi).toLocaleString('en-IN')}`, `Rs ${Math.round(prepayData.optB.emi).toLocaleString('en-IN')}`],
                    ['Remaining Tenure', `${prepayData.orig.tenure} Months`, `${prepayData.optA.tenure} Months`, `${prepayData.optB.tenure} Months`],
                    ['Total Interest', `Rs ${Math.round(prepayData.orig.int).toLocaleString('en-IN')}`, `Rs ${Math.round(prepayData.optA.int).toLocaleString('en-IN')}`, `Rs ${Math.round(prepayData.optB.int).toLocaleString('en-IN')}`],
                    ['Interest Saved', '-', `Rs ${Math.round(prepayData.optA.save).toLocaleString('en-IN')}`, `Rs ${Math.round(prepayData.optB.save).toLocaleString('en-IN')}`],
                    ['Total Payable', `Rs ${Math.round(prepayData.orig.total).toLocaleString('en-IN')}`, `Rs ${Math.round(prepayData.optA.total).toLocaleString('en-IN')}`, `Rs ${Math.round(prepayData.optB.total).toLocaleString('en-IN')}`],
                    ['Net Saving', '-', `Rs ${Math.round(prepayData.optA.totalSave).toLocaleString('en-IN')}`, `Rs ${Math.round(prepayData.optB.totalSave).toLocaleString('en-IN')}`]
                ];
                doc.autoTable({ startY: y, head: [comparisonData[0]], body: comparisonData.slice(1), theme: 'grid', headStyles: { fillColor: [50, 50, 50] }, columnStyles: { 0: { fontStyle: 'bold' }, 1: { fillColor: [255, 235, 235] }, 2: { fillColor: [235, 245, 255] }, 3: { fillColor: [235, 255, 235] } }, styles: { fontSize: 9, halign: 'center' } });
                y = doc.lastAutoTable.finalY + 15;
            } else {
                const mainLabel = document.getElementById('calc-primary-output-label').innerText;
                let mainVal = document.getElementById('calc-primary-output-value').innerText;
                mainVal = mainVal.replace(/₹/g, 'Rs.'); 
                doc.text(`${mainLabel}: ${mainVal}`, 15, y); y += 15;
            }

            doc.setFontSize(11); doc.setTextColor(0, 0, 0); doc.setFont(undefined, 'bold');
            doc.text(calcMode === 'prepay' ? 'Revised Repayment Schedule (Full Monthly)' : 'Amortization Schedule (Yearly)', 15, y); y += 6;
            let tableData = currentAmortData.map(r => [`Month ${r.i}`, Math.round(r.open).toLocaleString('en-IN'), Math.round(r.emi).toLocaleString('en-IN'), Math.round(r.prin).toLocaleString('en-IN'), Math.round(r.int).toLocaleString('en-IN'), Math.round(r.close).toLocaleString('en-IN')]);
            if (calcMode !== 'prepay') {
                const yearly = {}; currentAmortData.forEach(r => { const y = Math.ceil(r.i/12); if(!yearly[y]) yearly[y] = { i: `Year ${y}`, open: r.open, emi:0, prin:0, int:0, close: r.close }; yearly[y].emi += r.emi; yearly[y].prin += r.prin; yearly[y].int += r.int; yearly[y].close = r.close; });
                tableData = Object.values(yearly).map(r => [r.i, Math.round(r.open).toLocaleString('en-IN'), Math.round(r.emi).toLocaleString('en-IN'), Math.round(r.prin).toLocaleString('en-IN'), Math.round(r.int).toLocaleString('en-IN'), Math.round(r.close).toLocaleString('en-IN')]);
            }
            doc.autoTable({ startY: y, head: [['Period', 'Opening', 'EMI', 'Principal', 'Interest', 'Closing']], body: tableData, theme: 'grid', headStyles: { fillColor: [65, 105, 225] }, styles: { fontSize: 8 }, });
            
            const pageCount = doc.internal.getNumberOfPages();
            for(let i=1; i<=pageCount; i++) {
                doc.setPage(i); doc.setFontSize(8); doc.setTextColor(150);
                doc.text('CashMela - India\'s Trusted Loan Advisor | www.cashmela.com', 105, 290, { align: 'center' });
            }
            doc.save('CashMela_Report.pdf');
        }

        function shareOnWhatsApp() {
            let text = "";
            const val = document.getElementById('calc-primary-output-value').innerText;
            
            if(calcMode === 'prepay') {
                const optA_save = document.getElementById('pp-optA-total-save').innerText;
                const monthsSaved = document.getElementById('pp-optA-months-saved').innerText;
                text = `Hi! I used the CashMela Smart Calculator.\n\nBy prepaying, I can become debt-free ${monthsSaved} months earlier and save ${optA_save}!\n\nCheck it out here: https://cashmela.com`;
            } else {
                text = `Check out my financial calculation on CashMela! Result: ${val}. Calculate here: https://cashmela.com`;
            }
            
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            textArea.style.left = "-9999px";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();

            try {
                document.execCommand('copy');
                alert("Summary copied to clipboard! Please paste it in WhatsApp.");
            } catch (err) {
                console.error('Unable to copy to clipboard', err);
            }
            
            document.body.removeChild(textArea);
            window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
        }
    </script>

    <!-- VIEW: SMART SIP AI PLANNER -->
    

    <!-- SIP Planner React Component -->
    <script type="text/babel">
        function initSIPPlanner() {
            const sipRoot = document.getElementById('sip-root');
            if (!sipRoot) {
                console.error('SIP root element not found');
                return;
            }
            if (sipRoot.innerHTML) {
                console.log('SIP Planner already initialized');
                return; // Already initialized
            }

            // Check if React and Recharts are loaded
            if (typeof React === 'undefined') {
                console.error('React not loaded');
                sipRoot.innerHTML = '<div class="text-center p-8"><p class="text-red-600 font-bold">Error: React library not loaded</p></div>';
                return;
            }
            if (typeof Recharts === 'undefined') {
                console.error('Recharts not loaded');
                sipRoot.innerHTML = '<div class="text-center p-8"><p class="text-red-600 font-bold">Error: Recharts library not loaded</p></div>';
                return;
            }

            try {
                const { useState, useEffect } = React;
                const { PieChart, Pie, Cell, ResponsiveContainer, Tooltip, AreaChart, Area, XAxis, YAxis, CartesianGrid } = Recharts;

            function SIPInvestmentPlanner() {
                const [investmentType, setInvestmentType] = useState('sip');
                const [amount, setAmount] = useState(10000);
                const [riskProfile, setRiskProfile] = useState('moderate');
                const [duration, setDuration] = useState(10);
                const [allocation, setAllocation] = useState(null);
                const [projection, setProjection] = useState([]);
                const [activeTab, setActiveTab] = useState('overview');

                const RETURN_RATES = { large: 0.13, multi: 0.16, small: 0.21 };
                const RISK_MATRICES = {
                    conservative: { label: "Conservative", allocations: { large: 70, multi: 20, small: 10 }, color: "text-blue-600", bg: "bg-blue-50" },
                    moderate: { label: "Moderate", allocations: { large: 50, multi: 30, small: 20 }, color: "text-emerald-600", bg: "bg-emerald-50" },
                    aggressive: { label: "Aggressive", allocations: { large: 30, multi: 30, small: 40 }, color: "text-orange-600", bg: "bg-orange-50" },
                    veryAggressive: { label: "High Octane", allocations: { large: 10, multi: 30, small: 60 }, color: "text-purple-600", bg: "bg-purple-50" }
                };

                const COLORS = ['#3b82f6', '#10b981', '#f59e0b'];
                
                const formatCurrency = (val) => {
                    if (val >= 10000000) return `₹${(val / 10000000).toFixed(2)} Cr`;
                    if (val >= 100000) return `₹${(val / 100000).toFixed(2)} L`;
                    return `₹${val.toLocaleString('en-IN')}`;
                };

                useEffect(() => {
                    const profile = RISK_MATRICES[riskProfile];
                    const alloc = profile.allocations;
                    const safeAmount = amount === '' ? 0 : Number(amount);
                    const weightedReturn = (alloc.large * RETURN_RATES.large + alloc.multi * RETURN_RATES.multi + alloc.small * RETURN_RATES.small) / 100;
                    const data = [];
                    const monthlyRate = weightedReturn / 12;

                    for (let year = 0; year <= 30; year++) {
                        let projectedValue, investedValue;
                        if (investmentType === 'lumpsum') {
                            investedValue = safeAmount;
                            projectedValue = safeAmount * Math.pow(1 + weightedReturn, year);
                        } else {
                            const months = year * 12;
                            investedValue = safeAmount * months;
                            projectedValue = year === 0 ? 0 : safeAmount * ((Math.pow(1 + monthlyRate, months) - 1) / monthlyRate) * (1 + monthlyRate);
                        }
                        data.push({ year, amount: Math.round(projectedValue), invested: investedValue });
                    }

                    const resultData = data[duration];
                    setAllocation({
                        ...profile,
                        weightedReturn: (weightedReturn * 100).toFixed(1),
                        totalReturn: resultData.amount - resultData.invested,
                        finalValue: resultData.amount,
                        investedAmount: resultData.invested
                    });
                    setProjection(data);
                }, [amount, riskProfile, duration, investmentType]);

                return (
                    <div className="max-w-6xl mx-auto">
                        {/* Header */}
                        <div className="bg-gradient-to-r from-indigo-900 to-blue-900 text-white rounded-2xl p-8 mb-8 shadow-xl">
                            <div className="flex items-center gap-3 mb-4">
                                <div className="bg-white/20 p-3 rounded-lg">
                                    <i className="fas fa-robot text-2xl"></i>
                                </div>
                                <div>
                                    <h1 className="text-3xl font-bold">Smart Portfolio Planner</h1>
                                    <p className="text-indigo-200">AI-powered wealth building with institutional-grade strategies</p>
                                </div>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
                            {/* Controls */}
                            <div className="lg:col-span-4 space-y-6">
                                <div className="bg-white rounded-2xl shadow-lg p-6">
                                    <h2 className="text-lg font-bold mb-6 flex items-center gap-2">
                                        <i className="fas fa-sliders-h text-indigo-600"></i> Configure Strategy
                                    </h2>

                                    {/* Investment Type */}
                                    <div className="bg-slate-100 p-1.5 rounded-xl flex mb-6">
                                        <button onClick={() => { setInvestmentType('sip'); setAmount(10000); }} className={`flex-1 py-2.5 rounded-lg text-sm font-bold transition-all ${investmentType === 'sip' ? 'bg-white text-indigo-700 shadow' : 'text-slate-500'}`}>SIP Mode</button>
                                        <button onClick={() => { setInvestmentType('lumpsum'); setAmount(100000); }} className={`flex-1 py-2.5 rounded-lg text-sm font-bold transition-all ${investmentType === 'lumpsum' ? 'bg-white text-indigo-700 shadow' : 'text-slate-500'}`}>Lumpsum</button>
                                    </div>

                                    {/* Amount */}
                                    <div className="mb-6">
                                        <label className="block text-xs font-bold text-slate-500 uppercase mb-2">{investmentType === 'lumpsum' ? 'Total Capital' : 'Monthly SIP Amount'}</label>
                                        <div className="relative">
                                            <span className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 font-bold">₹</span>
                                            <input type="number" min="0" value={amount} onChange={(e) => setAmount(e.target.value === '' ? '' : Number(e.target.value))} className="w-full pl-9 pr-4 py-4 bg-slate-50 border-2 border-slate-100 rounded-xl focus:border-indigo-500 outline-none text-xl font-bold" />
                                        </div>
                                        <div className="flex gap-2 mt-3">
                                            {(investmentType === 'lumpsum' ? [100000, 500000, 2500000] : [5000, 10000, 25000]).map(val => (
                                                <button key={val} onClick={() => setAmount(val)} className="text-xs bg-white border border-slate-200 hover:border-indigo-300 px-3 py-1.5 rounded-full transition">{formatCurrency(val)}</button>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Duration */}
                                    <div className="mb-6">
                                        <div className="flex justify-between items-end mb-4">
                                            <label className="text-xs font-bold text-slate-500 uppercase">Time Horizon</label>
                                            <span className="text-2xl font-bold text-indigo-600">{duration} <span className="text-sm text-slate-400">Years</span></span>
                                        </div>
                                        <input type="range" min="3" max="30" value={duration} onChange={(e) => setDuration(Number(e.target.value))} className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-600" />
                                        <div className="flex justify-between mt-2 text-xs text-slate-400">
                                            <span>3Y</span><span>15Y</span><span>30Y</span>
                                        </div>
                                    </div>

                                    {/* Risk Profile */}
                                    <div>
                                        <label className="block text-xs font-bold text-slate-500 uppercase mb-3">Risk Appetite</label>
                                        <div className="space-y-2">
                                            {Object.keys(RISK_MATRICES).map(key => {
                                                const profile = RISK_MATRICES[key];
                                                const isSelected = riskProfile === key;
                                                return (
                                                    <button key={key} onClick={() => setRiskProfile(key)} className={`w-full flex items-center gap-3 p-3 rounded-xl border-2 transition text-left ${isSelected ? `bg-white border-indigo-200 shadow` : 'bg-white border-transparent hover:bg-slate-50'}`}>
                                                        <div className={`p-2 rounded-lg ${profile.bg}`}>
                                                            <i className={`fas fa-chart-line w-5 h-5 ${profile.color}`}></i>
                                                        </div>
                                                        <div className="flex-1">
                                                            <div className={`font-bold text-sm ${isSelected ? 'text-slate-800' : 'text-slate-600'}`}>{profile.label}</div>
                                                        </div>
                                                        {isSelected && <div className={`w-3 h-3 rounded-full bg-indigo-600`}></div>}
                                                    </button>
                                                );
                                            })}
                                        </div>
                                    </div>
                                </div>

                                {/* AI Insight */}
                                <div className="bg-indigo-900 rounded-2xl p-6 text-white shadow-xl">
                                    <div className="flex items-center gap-2 mb-3">
                                        <span className="bg-indigo-700/50 text-indigo-200 text-xs px-2 py-1 rounded border border-indigo-600">AI INSIGHT</span>
                                    </div>
                                    <p className="text-indigo-100 text-sm leading-relaxed">
                                        Your <strong>{RISK_MATRICES[riskProfile].label}</strong> profile targets a <strong className="text-white">{allocation?.weightedReturn}% CAGR</strong>.
                                        {duration < 5 && " Note: Short durations work better with lower risk."}
                                        {duration > 15 && " Excellent! Long horizons maximize compounding."}
                                    </p>
                                </div>
                            </div>

                            {/* Results */}
                            <div className="lg:col-span-8 space-y-6">
                                {/* Stats */}
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div className="bg-white rounded-xl p-6 border-l-4 border-l-slate-400 shadow">
                                        <div className="text-slate-500 text-xs font-bold uppercase mb-2">Invested</div>
                                        <div className="text-2xl font-bold text-slate-800">{formatCurrency(allocation?.investedAmount || 0)}</div>
                                    </div>
                                    <div className="bg-white rounded-xl p-6 border-l-4 border-l-emerald-400 shadow">
                                        <div className="text-slate-500 text-xs font-bold uppercase mb-2">Wealth Gained</div>
                                        <div className="text-2xl font-bold text-emerald-600">+{formatCurrency(allocation?.totalReturn || 0)}</div>
                                    </div>
                                    <div className="bg-gradient-to-br from-indigo-50 to-white rounded-xl p-6 border-l-4 border-l-indigo-500 shadow">
                                        <div className="text-indigo-800 text-xs font-bold uppercase mb-2">Projected Value</div>
                                        <div className="text-3xl font-bold text-indigo-900">{formatCurrency(allocation?.finalValue || 0)}</div>
                                    </div>
                                </div>

                                {/* Tabs & Visualization */}
                                <div className="bg-white rounded-2xl shadow-lg overflow-hidden">
                                    <div className="flex border-b p-2 gap-1 overflow-x-auto">
                                        {['overview', 'growth'].map(tab => (
                                            <button key={tab} onClick={() => setActiveTab(tab)} className={`px-5 py-2.5 rounded-xl text-sm font-semibold transition-all capitalize whitespace-nowrap ${activeTab === tab ? 'bg-slate-800 text-white shadow' : 'text-slate-500 hover:bg-slate-50'}`}>
                                                {tab === 'overview' ? 'Allocation Mix' : 'Growth Chart'}
                                            </button>
                                        ))}
                                    </div>

                                    <div className="p-6 h-[400px]">
                                        {activeTab === 'overview' && allocation && (
                                            <div className="flex flex-col md:flex-row items-center justify-center gap-8 h-full">
                                                <div className="w-64 h-64 relative">
                                                    <ResponsiveContainer width="100%" height="100%">
                                                        <PieChart>
                                                            <Pie data={[
                                                                { name: 'Large Cap', value: allocation.allocations.large },
                                                                { name: 'Multi Cap', value: allocation.allocations.multi },
                                                                { name: 'Small Cap', value: allocation.allocations.small }
                                                            ]} innerRadius={70} outerRadius={95} paddingAngle={5} dataKey="value">
                                                                {COLORS.map((color, index) => <Cell key={`cell-${index}`} fill={color} />)}
                                                            </Pie>
                                                            <Tooltip />
                                                        </PieChart>
                                                    </ResponsiveContainer>
                                                    <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-center">
                                                        <div className="text-2xl font-bold text-slate-800">{allocation.weightedReturn}%</div>
                                                        <div className="text-xs text-slate-400 font-bold">Exp. CAGR</div>
                                                    </div>
                                                </div>

                                                <div className="flex-1 space-y-3 max-w-md">
                                                    {[
                                                        { label: "Large Cap", val: allocation.allocations.large, color: "bg-blue-500", text: "text-blue-700" },
                                                        { label: "Multi Cap", val: allocation.allocations.multi, color: "bg-emerald-500", text: "text-emerald-700" },
                                                        { label: "Small Cap", val: allocation.allocations.small, color: "bg-amber-500", text: "text-amber-700" }
                                                    ].map((item, i) => (
                                                        <div key={i} className="flex items-center justify-between p-4 bg-slate-50 rounded-xl border border-slate-100">
                                                            <div className="flex items-center gap-3">
                                                                <div className={`w-3 h-12 rounded-full ${item.color}`}></div>
                                                                <div className="font-bold text-slate-700">{item.label}</div>
                                                            </div>
                                                            <div className="text-xl font-bold text-slate-800">{item.val}%</div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        )}

                                        {activeTab === 'growth' && (
                                            <div className="h-full w-full pt-4">
                                                <ResponsiveContainer width="100%" height="100%">
                                                    <AreaChart data={projection.filter((_, i) => i <= duration)} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>
                                                        <defs>
                                                            <linearGradient id="colorValue" x1="0" y1="0" x2="0" y2="1">
                                                                <stop offset="5%" stopColor="#6366f1" stopOpacity={0.3}/>
                                                                <stop offset="95%" stopColor="#6366f1" stopOpacity={0}/>
                                                            </linearGradient>
                                                        </defs>
                                                        <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f1f5f9" />
                                                        <XAxis dataKey="year" axisLine={false} tickLine={false} tick={{fill: '#94a3b8', fontSize: 12}} />
                                                        <YAxis axisLine={false} tickLine={false} tick={{fill: '#94a3b8', fontSize: 12}} tickFormatter={(val) => `₹${val >= 100000 ? (val/100000).toFixed(1) + 'L' : val/1000 + 'k'}`} />
                                                        <Tooltip contentStyle={{borderRadius: '12px', border: 'none', boxShadow: '0 10px 25px -5px rgba(0, 0, 0, 0.1)'}} formatter={(value) => [formatCurrency(value), "Value"]} />
                                                        <Area type="monotone" dataKey="amount" stroke="#4f46e5" strokeWidth={3} fillOpacity={1} fill="url(#colorValue)" />
                                                        <Area type="monotone" dataKey="invested" stroke="#cbd5e1" strokeWidth={2} strokeDasharray="4 4" fill="transparent" />
                                                    </AreaChart>
                                                </ResponsiveContainer>
                                            </div>
                                        )}
                                    </div>
                                </div>

                                {/* CTA */}
                                <div className="bg-white rounded-2xl shadow-lg p-6">
                                    <button onclick="navigateTo('application-view', 'Personal Loan')" className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg transition flex items-center justify-center gap-2">
                                        Start Investing Now <i className="fas fa-arrow-right"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            const root = ReactDOM.createRoot(sipRoot);
            root.render(<SIPInvestmentPlanner />);
            console.log('SIP Planner initialized successfully');
            } catch (error) {
                console.error('Error initializing SIP Planner:', error);
                sipRoot.innerHTML = `<div class="text-center p-8"><p class="text-red-600 font-bold">Error loading SIP Planner</p><p class="text-sm text-gray-600 mt-2">${error.message}</p></div>`;
            }
        }
    </script>

    <!-- VIEW: CIBIL SCORE (Placeholder for full CIBIL View) -->
    <div id="cibil-view" class="view-section hidden pt-8 pb-16 flex-grow animate-fade-in">
        <div class="container mx-auto px-4">
            <button onclick="navigateTo('home-view')" class="text-gray-500 hover:text-blue-600 mb-6 flex items-center gap-2"><i class="fas fa-arrow-left"></i> Back to Home</button>
            <div class="bg-white rounded-2xl shadow-xl p-8 max-w-2xl mx-auto">
                <h2 class="text-3xl font-bold text-center text-slate-800 mb-4">Free CIBIL Score Check</h2>
                <p class="text-center text-gray-500 mb-8">Get your credit score and detailed report instantly.</p>
                <div class="text-center p-6 bg-blue-50 border border-green-200 rounded-xl">
                    <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center text-3xl text-blue-600 mx-auto mb-4 border-2 border-blue-600/50 shadow-md">
                        <i class="fas fa-hand-holding-usd"></i>
                    </div>
                    <p class="text-lg font-bold text-green-800">Your Credit Score is Key to the Best Loan Offers.</p>
                    <button class="mt-4 bg-blue-600 text-slate-800 px-8 py-3 rounded-full font-bold hover:bg-blue-600/90 transition shadow-lg btn-shimmer">Check Score Now (It's Free!)</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="login-modal" class="hidden fixed inset-0 z-[60] flex items-center justify-center bg-black/50 backdrop-blur-sm transition-opacity opacity-0" style="transition: opacity 0.3s ease;">
        <div class="bg-white rounded-2xl p-8 max-w-sm w-full mx-4 shadow-2xl relative transform scale-95 transition-transform duration-300" id="login-content">
            <button onclick="toggleLoginModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors"><i class="fas fa-times text-xl"></i></button>
            <h2 class="text-2xl font-bold mb-6 text-center">Login</h2>
            <div class="space-y-4">
                <button class="w-full border border-gray-300 py-3 rounded-lg flex items-center justify-center gap-2 hover:bg-gray-50 transition-colors"><img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-5 h-5"> Continue with Google</button>
                <div class="relative text-center my-4">
                    <div class="absolute inset-0 flex items-center"><div class="w-full border-t border-gray-300"></div></div>
                    <span class="relative bg-white px-2 text-sm text-gray-500">Or</span>
                </div>
                <input type="tel" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500 transition-shadow" placeholder="Mobile Number">
                <button class="w-full bg-blue-600 text-slate-800 font-bold py-3 rounded-lg hover:bg-blue-600/90 transition shadow-lg btn-shimmer" onclick="toggleLoginModal()">Send OTP</button>
            </div>
        </div>
    </div>

    <!-- Footer - Updated accent colors to Urban Green -->
    <footer class="bg-slate-800 text-gray-300 py-16 mt-auto border-t border-gray-800">
        <div class="container mx-auto px-4 md:px-8">
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8 mb-12">
                <div>
                    <div class="mb-6 flex justify-center items-center">
                        <img src="https://cashmela.com/assets/images/cashmelawhite-logo.png" alt="CashMela" class="h-16 w-auto mx-auto mb-4" style="height: 64px !important;">
                    </div>
                    <p class="text-sm leading-relaxed mb-6 text-gray-400">Cashmela is India’s unbiased loan advisor for best deals in loans and unmatched advisory services.</p>
                     <div class="flex gap-4">
                        <a href="#" class="w-8 h-8 rounded-full bg-gray-800 flex items-center justify-center hover:bg-blue-600 hover:scale-110 transition-all duration-300"><i class="fab fa-linkedin-in"></i></a>
                        <a href="#" class="w-8 h-8 rounded-full bg-gray-800 flex items-center justify-center hover:bg-blue-600 hover:scale-110 transition-all duration-300"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="w-8 h-8 rounded-full bg-gray-800 flex items-center justify-center hover:bg-blue-600 hover:scale-110 transition-all duration-300"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
                <div><h4 class="text-white font-bold mb-6">Contact Us</h4><ul class="text-sm space-y-3 text-gray-400"><li>1st Floor, Tower A, Cyber Park, Gurugram, Haryana 122001</li><li><a href="tel:18002083344" class="hover:text-white transition-colors">1800 208 3344</a></li><li><a href="/cdn-cgi/l/email-protection#1a797574747f796e5a797b6972777f767b34797577" class="hover:text-white transition-colors"><span class="__cf_email__" data-cfemail="1a797574747f796e5a797b6972777f767b34797577">[email&#160;protected]</span></a></li></ul></div>
                <div><h4 class="text-white font-bold mb-6">Products</h4><ul class="text-sm space-y-2 text-gray-400"><li class="cursor-pointer hover:text-blue-600 transition-colors" onclick="navigateTo('application-view', 'Home Loan')">Home Loan</li><li class="cursor-pointer hover:text-blue-600 transition-colors" onclick="navigateTo('application-view', 'Personal Loan')">Personal Loan</li><li class="cursor-pointer hover:text-blue-600 transition-colors" onclick="navigateTo('application-view', 'Business Loan')">Business Loan</li><li class="cursor-pointer hover:text-blue-600 transition-colors" onclick="navigateTo('application-view', 'Credit Card')">Credit Card</li></ul></div>
                <div><h4 class="text-white font-bold mb-6">Company</h4><ul class="text-sm space-y-2 text-gray-400"><li class="cursor-pointer hover:text-blue-600 transition-colors" onclick="navigateTo('home-view')">Home</li><li class="cursor-pointer hover:text-blue-600 transition-colors" onclick="navigateTo('partner-view')">Become Partner</li><li class="cursor-pointer hover:text-blue-600 transition-colors">About Us</li><li class="cursor-pointer hover:text-blue-600 transition-colors">Contact Us</li></ul></div>
            </div>
            <div class="border-t border-gray-800 pt-8 flex flex-col md:flex-row justify-between items-center text-xs text-gray-500">
                <p>&copy; 2025 Cashmela. All rights reserved.</p>
                <div class="flex gap-4 mt-4 md:mt-0">
                    <a href="#" class="hover:text-white transition-colors">Terms & Conditions</a>
                    <a href="#" class="hover:text-white transition-colors">Privacy Policy</a>
                </div>
            </div>
        </div>
    </footer>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        // Custom message box function to replace alert()
        function showMessage(message) {
            const tempModal = document.createElement('div');
            tempModal.className = 'fixed inset-0 z-[70] flex items-center justify-center bg-black/50 backdrop-blur-sm transition-opacity opacity-100';
            tempModal.innerHTML = `
                <div class="bg-white rounded-2xl p-8 max-w-xs w-full mx-4 shadow-2xl relative transform scale-100 transition-transform duration-300">
                    <h3 class="text-xl font-bold text-slate-800 mb-4">Notification</h3>
                    <p class="text-gray-600 mb-6">${message}</p>
                    <button onclick="this.closest('.fixed').remove()" class="w-full bg-slate-800 text-blue-600 font-bold py-2 rounded-lg hover:bg-black transition">Close</button>
                </div>
            `;
            document.body.appendChild(tempModal);
        }

        // --- Slider Logic ---
        let currentSlide = 0;
        let totalSlides = 0; // Will be set dynamically
        let slideInterval;

        function showSlide(index) {
            const slides = document.querySelectorAll('.slide');
            const dots = document.querySelectorAll('.slider-dot');
            
            if (!slides.length || index >= slides.length) return;

            // Remove active from all
            slides.forEach(s => s.classList.remove('active'));
            dots.forEach(d => d.classList.remove('active'));
            
            // Add active to current
            if(slides[index]) slides[index].classList.add('active');
            if(dots[index]) dots[index].classList.add('active');
        }

        function nextSlide() {
            const slides = document.querySelectorAll('.slide');
            totalSlides = slides.length;
            if (totalSlides === 0) return;
            
            currentSlide = (currentSlide + 1) % totalSlides;
            showSlide(currentSlide);
        }

        function prevSlide() {
            const slides = document.querySelectorAll('.slide');
            totalSlides = slides.length;
            if (totalSlides === 0) return;

            currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
            showSlide(currentSlide);
        }

        function goToSlide(index) {
            currentSlide = index;
            showSlide(currentSlide);
            resetInterval();
        }

        function startSlider() {
            const slides = document.querySelectorAll('.slide');
            totalSlides = slides.length;
            console.log('Starting slider with', totalSlides, 'slides'); // Debug
            if (totalSlides > 0) {
                currentSlide = 0;
                showSlide(0); // Ensure first slide is shown
                clearInterval(slideInterval); // Clear any existing interval
                slideInterval = setInterval(nextSlide, 4000); // 4 seconds auto-rotate
                console.log('Slider interval started'); // Debug
            }
        }

        function resetInterval() {
            clearInterval(slideInterval);
            startSlider();
        }

        function pauseSlider() {
            clearInterval(slideInterval);
        }

        function resumeSlider() {
            startSlider();
        }

        // --- Navigation Logic ---
        let currentProductName = 'Loan'; // Default product name

        function navigateTo(viewId, param = null) {
            console.log('navigateTo called with viewId:', viewId);
            // Hide all views
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            // Show target view
            const target = document.getElementById(viewId);
            console.log('Target element found:', !!target);
            if(target) {
                target.classList.remove('hidden');
                console.log('Showing view:', viewId);
                // Re-trigger reveal animations if returning to home
                if(viewId === 'home-view') {
                    // Reset all reveal elements
                    document.querySelectorAll('.reveal').forEach(el => {
                        el.classList.remove('active');
                    });
                    // Small delay before re-observing to ensure reset takes effect
                    setTimeout(() => {
                        setupIntersectionObserver();
                        resetCounters();
                        startSlider(); // Restart the hero slider
                    }, 50);
                }
                // Initialize AI calculator when calculator view is shown
                if(viewId === 'calculator-view') {
                    setTimeout(() => initAICalculator(), 100);
                }
                // Initialize Smart Loan Calculator
                if(viewId === 'smart-loan-calculator-view') {
                    console.log('Scheduling initSmartLoanCalculator');
                    setTimeout(() => initSmartLoanCalculator(), 100);
                }
            }
            
            // Show/hide footer based on view
            const footer = document.querySelector('footer');
            if (footer) {
                if (viewId === 'application-view') {
                    footer.style.display = 'none'; // Hide footer in loan journey
                    showPLStep(1); // Reset to step 1
                } else {
                    footer.style.display = 'block'; // Show footer on other pages
                }
            }
            
            // Scroll to top
            window.scrollTo(0, 0);

            // Specific View Setups
            if (viewId === 'application-view' && param) {
                currentProductName = param;
                setupApplicationView(param);
                resetForm();
            }

            if (viewId === 'calculator-view') {
                document.getElementById('calc-title').innerText = param ? param.replace('Calculator', '') : 'EMI';
                updateCalculator(); // Re-render chart
            }
        }

        // Sets up product-specific text in the form
        function setupApplicationView(productName) {
            console.log('Setting up application view for:', productName);
            
            // Small delay to ensure DOM is rendered
            setTimeout(() => {
                // Update the title on all side panels (Step 1, Step 2, Processing screen)
                const sideTitle = document.getElementById('form-title-side');
                if (sideTitle) {
                    sideTitle.innerText = productName;
                    console.log('Updated form-title-side to:', productName);
                } else {
                    console.error('form-title-side element not found!');
                }
                
                // Update Step 2 title
                const step2Title = document.getElementById('form-title-side-step2');
                if (step2Title) {
                    step2Title.innerText = productName;
                    console.log('Updated form-title-side-step2 to:', productName);
                } else {
                    console.error('form-title-side-step2 element not found!');
                }
                
                // Update Processing screen title
                const processingTitle = document.getElementById('form-title-processing');
                if (processingTitle) {
                    processingTitle.innerText = productName;
                    console.log('Updated form-title-processing to:', productName);
                } else {
                    console.error('form-title-processing element not found!');
                }
                
                // Update all occurrences of product name in the form
                document.querySelectorAll('.dynamic-product-name').forEach(el => {
                    el.innerText = productName;
                });
                
                // Update Headers for Step 1
                const step1Header = document.getElementById('step1-header');
                const step1Subheader = document.getElementById('step1-subheader');

            if (productName.includes('Card')) {
                step1Header.innerText = 'Unlock Premium Card Offers';
                step1Subheader.innerText = 'Get personalized Credit Card recommendations based on your profile.';
            } else if (productName.includes('Insurance')) {
                step1Header.innerText = 'Secure Your Financial Future';
                step1Subheader.innerText = 'Compare tailored Insurance plans to protect your family\'s health.';
            } else {
                // For Loans (Personal, Home, Business, Overdraft)
                step1Header.innerText = 'Discover the best offers tailored to your needs.';
                step1Subheader.innerText = 'Enter your 10 Digit Mobile Number to proceed with a quick eligibility check.';
            }

            // Step 3 dynamic text
            const offerText = document.getElementById('offer-comparison-text');
            if (productName.includes('Card')) {
                offerText.innerText = 'Based on your credit profile, here are the best Credit Card options from 40+ banks matched by our AI.';
            } else if (productName.includes('Insurance')) {
                 offerText.innerText = 'Based on your profile, compare personalized Health Insurance plans from leading providers.';
            } else {
                offerText.innerText = 'Based on your credit profile, here are the best Loan options from 40+ banks matched by our AI.';
            }

            // Step 3 dynamic document requirement
            const docLabel = document.getElementById('step3-dynamic-doc');
            if (productName.includes('Home') || productName.includes('Property')) {
                 docLabel.innerText = 'Property Documents & Valuation Report';
            } else if (productName.includes('Card')) {
                 docLabel.innerText = 'Address Proof (Utility Bill/Passport)';
            } else {
                 docLabel.innerText = 'Address Proof & Bank Account Details';
            }

             // Step 4 final message customization
            const finalMessage = document.getElementById('final-sanction-message');
            if (productName.includes('Card')) {
                finalMessage.innerHTML = `Your application for the **${productName}** has been successfully approved by the partner bank. Your card will be dispatched within 7 business days.`;
            } else if (productName.includes('Insurance')) {
                 finalMessage.innerHTML = `Your application for **${productName}** has been successfully processed. Your policy document will be emailed shortly.`;
            } else {
                finalMessage.innerHTML = `Your application for the **${productName}** has been successfully submitted and approved by the partner bank. Funds will be disbursed to your account within 24 hours.`;
            }
            
            console.log('setupApplicationView completed for:', productName);
            }, 100); // 100ms delay to ensure DOM is rendered
        }

        function toggleMobileMenu() {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        }

        // Show Smart Personal Loan Calculator (Coming Soon Placeholder)
        

        function toggleLoginModal() {
            const modal = document.getElementById('login-modal');
            const content = document.getElementById('login-content');
            
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                setTimeout(() => {
                    modal.classList.remove('opacity-0');
                    content.classList.remove('scale-95');
                    content.classList.add('scale-100');
                }, 10);
            } else {
                modal.classList.add('opacity-0');
                content.classList.remove('scale-100');
                content.classList.add('scale-95');
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300);
            }
        }
        
        // Simulates the OTP screen after mobile number is entered
        function simulateOtpStep(nextStep) {
            showMessage('OTP sent to your mobile! Proceeding to Step 2 for simplicity.');
            nextFormStep(nextStep);
        }

        // --- Form Logic - Updated for 4 steps ---
        function nextFormStep(step) {
            // Hide all form parts first
            document.getElementById('loan-form-step1').classList.add('hidden');
            document.getElementById('loan-form-step2').classList.add('hidden');
            document.getElementById('loan-form-step3').classList.add('hidden');
            document.getElementById('loan-form-step4').classList.add('hidden');
            
            // Show target step
            document.getElementById('loan-form-step'+step).classList.remove('hidden');

            // Reset/Set Indicator colors for 4 steps
            const indicatorClasses = [
                { id: 'step-1-ind', text: 'Eligibility' },
                { id: 'step-2-ind', text: 'Offers' },
                { id: 'step-3-ind', text: 'Documents' },
                { id: 'step-4-ind', text: 'Sanction' }
            ];

            indicatorClasses.forEach((indicator, index) => {
                const indEl = document.querySelector('.' + indicator.id);
                if (indEl) {
                    if (index + 1 <= step) {
                        // Active style
                        indEl.classList.remove('bg-gray-300', 'text-gray-600');
                        indEl.classList.add('bg-slate-800', 'text-blue-600', 'shadow-lg', 'shadow-primary-500/50');
                    } else {
                        // Inactive style
                        indEl.classList.add('bg-gray-300', 'text-gray-600');
                        indEl.classList.remove('bg-slate-800', 'text-blue-600', 'shadow-lg', 'shadow-primary-500/50');
                    }
                }
            });
        }

        function resetForm() {
            // Reset to step 1
            nextFormStep(1); 
            
            // Explicitly reset step 2, 3, 4 indicators to gray
            document.querySelectorAll('.step-2-ind, .step-3-ind, .step-4-ind').forEach(el => {
                el.classList.add('bg-gray-300', 'text-gray-600');
                el.classList.remove('bg-slate-800', 'text-blue-600', 'shadow-lg', 'shadow-primary-500/50');
            });
            
            // Reset step 1 to active
            const step1Ind = document.querySelector('.step-1-ind');
             if(step1Ind) {
                step1Ind.classList.remove('bg-gray-300', 'text-gray-600');
                step1Ind.classList.add('bg-slate-800', 'text-blue-600', 'shadow-lg', 'shadow-primary-500/50');
            }
            
            // Reset form inputs (though only step 1 has visible inputs on reset)
            document.getElementById('loan-form-step1').reset();
        }

        // --- Calculator Logic with Chart.js ---
        let emiChart = null;

        function updateCalculator() {
            const amount = parseFloat(document.getElementById('range-amount').value);
            const rate = parseFloat(document.getElementById('range-rate').value);
            const tenure = parseFloat(document.getElementById('range-tenure').value);

            document.getElementById('val-amount').innerText = amount.toLocaleString('en-IN');
            document.getElementById('val-rate').innerText = rate;
            document.getElementById('val-tenure').innerText = tenure;

            const r = rate / 12 / 100;
            const n = tenure * 12;
            const emi = (amount * r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
            
            const totalPayment = emi * n;
            const totalInterest = totalPayment - amount;

            document.getElementById('result-emi').innerText = Math.round(emi).toLocaleString('en-IN');
            document.getElementById('result-principal').innerText = Math.round(amount).toLocaleString('en-IN');
            document.getElementById('result-interest').innerText = Math.round(totalInterest).toLocaleString('en-IN');
            document.getElementById('result-total').innerText = Math.round(totalPayment).toLocaleString('en-IN');

            updateChart(amount, totalInterest);
        }

        function updateChart(principal, interest) {
            // Wrap in try-catch to prevent crashing if Chart.js fails to load
            try {
                const ctx = document.getElementById('emiChart').getContext('2d');
                
                if (emiChart) {
                    emiChart.destroy();
                }

                if (typeof Chart !== 'undefined') {
                    emiChart = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Principal Amount', 'Total Interest'],
                            // Updated Principal color to Urban Green and Interest retained Orange for contrast
                            datasets: [{
                                data: [principal, interest],
                                backgroundColor: ['#4169E1', '#f97316'], 
                                borderWidth: 0,
                                hoverOffset: 4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    labels: {
                                        color: '#9ca3af', // Gray-400
                                        font: {
                                            family: 'Inter'
                                        }
                                    }
                                }
                            },
                            cutout: '70%'
                        }
                    });
                }
            } catch (e) {
                console.warn("Chart.js failed to load or initialize", e);
            }
        }

        // --- Animation Logic (Intersection Observer & Counters) ---
        function setupIntersectionObserver() {
            const observer = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('active');
                        
                        // Handle Counters with safety check
                        const counters = entry.target.querySelectorAll('.counter');
                        if (counters.length > 0) {
                            counters.forEach(counter => {
                                // Prevent re-running if already counted
                                if(counter.classList.contains('counted')) return;
                                
                                counter.classList.add('counted');
                                const target = +counter.getAttribute('data-target');
                                const duration = 2000; // 2 seconds
                                animateValue(counter, 0, target, duration);
                            });
                        }
                        
                        // Stop observing this element once revealed to save performance
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });

            // Standard Reveals
            document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
            
            // CashMela Timeline Trigger
            const timeline = document.querySelector('.um-timeline');
            if(timeline) observer.observe(timeline);
        }

        function animateValue(obj, start, end, duration) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                // Handle decimals for 5.8
                if (end % 1 !== 0) {
                     obj.innerHTML = (progress * (end - start) + start).toFixed(1);
                } else {
                     obj.innerHTML = Math.floor(progress * (end - start) + start);
                }
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }
        
        // Reset counters to 0 (useful when navigating back)
        function resetCounters() {
             document.querySelectorAll('.counter').forEach(c => {
                 c.innerHTML = '0';
                 c.classList.remove('counted'); // Allow re-animation
             });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            setupIntersectionObserver();
            updateCalculator();
            
            // Start slider immediately with a small delay to ensure DOM is ready
            setTimeout(() => {
                startSlider();
            }, 100);
        });

        // Sticky Nav visual effect
        window.addEventListener('scroll', () => {
            const nav = document.getElementById('navbar');
            if (window.scrollY > 20) {
                nav.classList.add('shadow-md');
            } else {
                nav.classList.remove('shadow-md');
            }
        });

        // Dropdown hover logic
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('mouseenter', () => {
                item.querySelector('.dropdown').classList.remove('hidden');
            });
            item.addEventListener('mouseleave', () => {
                item.querySelector('.dropdown').classList.add('hidden');
            });
        });

        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        }

        // Personal Loan Journey Functions
        function selectEmployment(radio, value) {
            // Update hidden field
            document.getElementById('selected-employment').value = value;
            
            // Reset all employment cards
            document.querySelectorAll('.employment-option').forEach(option => {
                const card = option.querySelector('.employment-card');
                const circle = option.querySelector('.employment-circle');
                const dot = option.querySelector('.employment-dot');
                
                // Reset to unselected state
                card.classList.remove('border-blue-600');
                card.classList.add('border-gray-300');
                circle.classList.remove('border-blue-600');
                circle.classList.add('border-gray-400');
                dot.classList.add('bg-transparent');
                dot.classList.remove('bg-blue-600');
            });
            
            // Style selected option
            const selectedOption = radio.closest('.employment-option');
            const selectedCard = selectedOption.querySelector('.employment-card');
            const selectedCircle = selectedOption.querySelector('.employment-circle');
            const selectedDot = selectedOption.querySelector('.employment-dot');
            
            selectedCard.classList.add('border-blue-600');
            selectedCard.classList.remove('border-gray-300');
            selectedCircle.classList.add('border-blue-600');
            selectedCircle.classList.remove('border-gray-400');
            selectedDot.classList.remove('bg-transparent');
            selectedDot.classList.add('bg-blue-600');
        }
        
        function showPLStep(step) {
            // Hide all steps
            document.getElementById('pl-step-1').classList.add('hidden');
            document.getElementById('pl-step-2').classList.add('hidden');
            document.getElementById('pl-step-2-5').classList.add('hidden');
            document.getElementById('pl-step-3').classList.add('hidden');
            
            // Show selected step
            document.getElementById('pl-step-' + step).classList.remove('hidden');
            
            // Hide footer in journey
            const footer = document.querySelector('footer');
            if (footer) {
                footer.style.display = 'none';
            }
            
            // Scroll to top
            window.scrollTo(0, 0);
        }

        // Google Sheets Integration
        const GOOGLE_SHEET_URL = 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE'; // You'll provide this later

        // Auto-fill form with demo data
        function autoFillForm() {
            // Demo data - works on both mobile and desktop
            document.getElementById('pl-fullname').value = 'Adil Patel';
            document.getElementById('pl-mobile').value = '7021148322';
            document.getElementById('pl-email').value = 'adilpatel3110@gmail.com';
            document.getElementById('pl-pan').value = 'ABCDE1234F';
            document.getElementById('pl-dob').value = '31/10/1995';
            document.getElementById('pl-pincode').value = '400037';
            document.getElementById('pl-income').value = '58333';
            document.getElementById('pl-loan-amount').value = '900000';
            
            // Check the terms checkbox
            document.getElementById('pl-terms').checked = true;
            
            // Update income and loan amount words
            const incomeWords = document.getElementById('income-words');
            const loanWords = document.getElementById('loan-words');
            
            if(incomeWords) {
                incomeWords.textContent = 'Fifty Eight Thousand Three Hundred Thirty Three Rupees';
            }
            if(loanWords) {
                loanWords.textContent = 'Nine Lakh Rupees';
            }
            
            // Show success message
            showSuccessToast('Form auto-filled with demo data!');
        }
        
        // Success toast notification
        function showSuccessToast(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-3 animate-fade-in';
            toast.innerHTML = `
                <i class="fas fa-check-circle text-xl"></i>
                <span class="font-semibold">${message}</span>
            `;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(-20px)';
                toast.style.transition = 'all 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 2500);
        }

        function submitPLInfo() {
            // Collect form data
            const formData = {
                timestamp: new Date().toISOString(),
                employmentType: document.getElementById('selected-employment').value,
                mobile: document.getElementById('pl-mobile').value,
                fullName: document.getElementById('pl-fullname').value,
                email: document.getElementById('pl-email').value,
                pan: document.getElementById('pl-pan').value,
                dob: document.getElementById('pl-dob').value,
                pincode: document.getElementById('pl-pincode').value,
                netMonthlySalary: document.getElementById('pl-income').value,
                loanAmount: document.getElementById('pl-loan-amount').value,
                termsAccepted: document.getElementById('pl-terms').checked
            };

            // Update loan amounts in processing page
            const loanAmount = parseInt(formData.loanAmount).toLocaleString('en-IN');
            document.getElementById('display-loan-amount-processing').textContent = loanAmount;
            document.getElementById('display-loan-amount').textContent = loanAmount;

            // Show loading state
            const submitBtn = document.querySelector('#pl-info-form button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Submitting...';
            submitBtn.disabled = true;

            // Show processing page
            showPLStep('2-5');

            // Animate processing steps
            animateProcessingSteps();

            // Send to Google Sheets
            fetch(GOOGLE_SHEET_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            })
            .then(() => {
                // Success handled in animation
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            })
            .catch((error) => {
                console.error('Error:', error);
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            });
        }

        function animateProcessingSteps() {
            // Animate each step with delays
            setTimeout(() => {
                const step2 = document.getElementById('process-step-2');
                step2.classList.remove('opacity-50');
                step2.querySelector('.bg-gray-200').classList.remove('bg-gray-200');
                step2.querySelector('.bg-gray-200, .flex-shrink-0 div').classList.add('bg-blue-600');
                step2.querySelector('.fa-spinner').classList.remove('fa-spinner', 'fa-spin', 'text-gray-500');
                step2.querySelector('i').classList.add('fa-check', 'text-white');
                step2.querySelector('h3').classList.remove('text-gray-700');
                step2.querySelector('h3').classList.add('text-slate-800');
                step2.querySelector('p').classList.remove('text-gray-500');
                step2.querySelector('p').classList.add('text-gray-600');
            }, 1500);

            setTimeout(() => {
                const step3 = document.getElementById('process-step-3');
                step3.classList.remove('opacity-50');
                step3.querySelector('.bg-gray-200').classList.remove('bg-gray-200');
                step3.querySelector('.flex-shrink-0 div').classList.add('bg-blue-600');
                step3.querySelector('.text-gray-400').classList.remove('text-gray-400');
                step3.querySelector('i').classList.add('text-white');
                step3.querySelector('h3').classList.remove('text-gray-700');
                step3.querySelector('h3').classList.add('text-slate-800');
                step3.querySelector('p').classList.remove('text-gray-500');
                step3.querySelector('p').classList.add('text-gray-600');
            }, 3000);

            setTimeout(() => {
                const step4 = document.getElementById('process-step-4');
                step4.classList.remove('opacity-50');
                step4.querySelector('.bg-gray-200').classList.remove('bg-gray-200');
                step4.querySelector('.flex-shrink-0 div').classList.add('bg-blue-600');
                step4.querySelector('.text-gray-400').classList.remove('text-gray-400');
                step4.querySelector('i').classList.add('text-white');
                step4.querySelector('h3').classList.remove('text-gray-700');
                step4.querySelector('h3').classList.add('text-slate-800');
                step4.querySelector('p').classList.remove('text-gray-500');
                step4.querySelector('p').classList.add('text-gray-600');
            }, 4500);

            // Move to offers page after animation
            setTimeout(() => {
                showPLStep(3);
            }, 6000);
        }

        function sendConfirmationEmail(data) {
            // Email will be sent via Google Apps Script
            console.log('Confirmation email will be sent to:', data.email);
            // The Google Apps Script will handle sending email with form details
        }

        function editLoanAmount() {
            showPLStep(2);
        }

        // Format DOB with auto slashes
        function formatDOB(input) {
            let value = input.value.replace(/\D/g, ''); // Remove non-digits
            
            if (value.length >= 2) {
                value = value.substring(0, 2) + '/' + value.substring(2);
            }
            if (value.length >= 5) {
                value = value.substring(0, 5) + '/' + value.substring(5, 9);
            }
            
            input.value = value;
        }

        function applyNow() {
            // This will be replaced with actual UTM link later
            alert('Apply Now functionality will redirect to lender partner page with UTM tracking');
        }

        // Loan Amount Edit Functions
        function toggleEditLoanAmount() {
            const input = document.getElementById('display-loan-amount');
            const editBtn = document.getElementById('edit-loan-btn');
            const saveBtn = document.getElementById('save-loan-btn');
            const lockIcon = document.querySelector('#pl-step-3 .fa-lock');
            
            input.readOnly = false;
            input.classList.add('border-b-2', 'border-blue-600');
            input.focus();
            input.select();
            
            editBtn.classList.add('hidden');
            saveBtn.classList.remove('hidden');
            
            if (lockIcon) {
                lockIcon.classList.remove('fa-lock');
                lockIcon.classList.add('fa-lock-open');
            }
        }

        function saveLoanAmount() {
            const input = document.getElementById('display-loan-amount');
            const editBtn = document.getElementById('edit-loan-btn');
            const saveBtn = document.getElementById('save-loan-btn');
            const lockIcon = document.querySelector('#pl-step-3 .fa-lock-open');
            
            // Format the input value
            let value = input.value.replace(/[^0-9]/g, '');
            if (value) {
                value = parseInt(value).toLocaleString('en-IN');
                input.value = value;
            }
            
            input.readOnly = true;
            input.classList.remove('border-b-2', 'border-blue-600');
            
            editBtn.classList.remove('hidden');
            saveBtn.classList.add('hidden');
            
            if (lockIcon) {
                lockIcon.classList.remove('fa-lock-open');
                lockIcon.classList.add('fa-lock');
            }
        }

        // ============================================
        // FILTER FUNCTIONALITY
        // ============================================

        let currentSortBy = 'approval'; // default sort by approval
        let selectedFeatures = new Set();

        function sortBy(type) {
            currentSortBy = type;
            applyFilters();
        }

        function toggleFeature(feature, checked) {
            if (checked) {
                selectedFeatures.add(feature);
            } else {
                selectedFeatures.delete(feature);
            }
            applyFilters();
        }

        function applyFilters() {
            const offersContainer = document.getElementById('offers-container');
            if (!offersContainer) return;
            
            const offers = Array.from(offersContainer.querySelectorAll('.bank-offer'));
            
            // Filter by features
            offers.forEach(offer => {
                if (selectedFeatures.size === 0) {
                    offer.style.display = 'block';
                } else {
                    const offerFeatures = (offer.getAttribute('data-features') || '').split(',');
                    const processingTime = offer.getAttribute('data-processing') || '';
                    const processType = offer.getAttribute('data-process-type') || '';
                    
                    const hasAllFeatures = Array.from(selectedFeatures).every(feature => {
                        return offerFeatures.includes(feature) || 
                               processingTime === feature || 
                               processType === feature;
                    });
                    offer.style.display = hasAllFeatures ? 'block' : 'none';
                }
            });
            
            // Get visible offers and sort
            const visibleOffers = offers.filter(offer => offer.style.display !== 'none');
            
            visibleOffers.sort((a, b) => {
                switch(currentSortBy) {
                    case 'approval':
                        return (parseInt(b.getAttribute('data-approval')) || 0) - (parseInt(a.getAttribute('data-approval')) || 0);
                    case 'disbursal-low':
                        return (parseInt(a.getAttribute('data-disbursal-days')) || 0) - (parseInt(b.getAttribute('data-disbursal-days')) || 0);
                    case 'emi-low':
                        return (parseInt(a.getAttribute('data-emi')) || 0) - (parseInt(b.getAttribute('data-emi')) || 0);
                    case 'emi-high':
                        return (parseInt(b.getAttribute('data-emi')) || 0) - (parseInt(a.getAttribute('data-emi')) || 0);
                    default:
                        return 0;
                }
            });
            
            // Reorder in DOM
            visibleOffers.forEach(offer => offersContainer.appendChild(offer));
        }

        function clearAllFilters() {
            selectedFeatures.clear();
            currentSortBy = 'approval';
            
            document.querySelectorAll('.feature-checkbox').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            const approvalRadio = document.querySelector('input[name="sort-option"][value="approval"]');
            if (approvalRadio) approvalRadio.checked = true;
            
            applyFilters();
        }

        // Modal Functions
        function openTermsModal() {
            document.getElementById('terms-modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeTermsModal() {
            document.getElementById('terms-modal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        function openPrivacyModal() {
            alert('Privacy Policy modal - Will be implemented');
        }

        function openCreditReportModal() {
            alert('Credit Report Terms modal - Will be implemented');
        }

        // Number to words converter for income display
        document.addEventListener('DOMContentLoaded', function() {
            const incomeInput = document.getElementById('pl-income');
            const loanInput = document.getElementById('pl-loan-amount');
            
            if (incomeInput) {
                incomeInput.addEventListener('input', function(e) {
                    const num = parseInt(e.target.value);
                    if (!isNaN(num)) {
                        document.getElementById('income-words').textContent = numberToWords(num);
                    }
                });
            }

            if (loanInput) {
                loanInput.addEventListener('input', function(e) {
                    const num = parseInt(e.target.value);
                    if (!isNaN(num)) {
                        document.getElementById('loan-words').textContent = numberToWords(num);
                    }
                });
            }
        });

        function numberToWords(num) {
            if (num === 0) return 'Zero';
            
            const ones = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine'];
            const tens = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];
            const teens = ['Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];
            
            function convertLessThan1000(n) {
                if (n === 0) return '';
                else if (n < 10) return ones[n];
                else if (n < 20) return teens[n - 10];
                else if (n < 100) return tens[Math.floor(n / 10)] + (n % 10 !== 0 ? ' ' + ones[n % 10] : '');
                else return ones[Math.floor(n / 100)] + ' Hundred' + (n % 100 !== 0 ? ' ' + convertLessThan1000(n % 100) : '');
            }
            
            if (num < 1000) return convertLessThan1000(num);
            
            const crore = Math.floor(num / 10000000);
            const lakh = Math.floor((num % 10000000) / 100000);
            const thousand = Math.floor((num % 100000) / 1000);
            const remainder = num % 1000;
            
            let result = '';
            if (crore > 0) result += convertLessThan1000(crore) + ' Crore ';
            if (lakh > 0) result += convertLessThan1000(lakh) + ' Lakh ';
            if (thousand > 0) result += convertLessThan1000(thousand) + ' Thousand ';
            if (remainder > 0) result += convertLessThan1000(remainder);
            
            return result.trim();
        }
    </script>

    <!-- Terms and Conditions Modal -->
    <div id="terms-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between">
                <h2 class="text-2xl font-bold text-slate-800">Terms and Conditions</h2>
                <button onclick="closeTermsModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <div class="p-6 prose prose-sm max-w-none">
                <h3>TERMS OF USE</h3>
                
                <h4>1. GENERAL</h4>
                <p>This document is an electronic record in terms of Information Technology Act, 2000 and rules there under as applicable and the amended provisions pertaining to electronic records in various statutes as amended by the Information Technology Act, 2000.</p>
                
                <p>The domain name https://www.cashmela.com ("Website"), is owned and operated by Credpi Advisory Private Limited ("Company"), having its office at Mumbai, Maharashtra, India.</p>
                
                <h4>2. ELIGIBILITY</h4>
                <p>The User represents and warrants that he/she is competent and eligible to enter into legally binding agreements and that he/she has the requisite authority to bind himself/herself to these Terms, as determined solely by the provisions of the Indian Contract Act, 1872.</p>
                
                <h4>3. THE SERVICES</h4>
                <p>We are India's trusted loan advisor for best deals in loans and unmatched advisory services. We manage the entire borrowing process for clients, starting by assisting our clients to choose the right product from the appropriate lending organization, till the time the entire loan is disbursed.</p>
                
                <h4>4. USER OBLIGATIONS</h4>
                <p>The User agrees and acknowledges that by using this Website:</p>
                <ul>
                    <li>User agrees to receive calls, emails, and SMS from CashMela and/or any of its affiliates or partners</li>
                    <li>User provides accurate and complete information</li>
                    <li>User will not misuse the platform for fraudulent activities</li>
                    <li>User authorizes CashMela to process their application and share information with lending partners</li>
                </ul>
                
                <h4>5. PRIVACY AND DATA PROTECTION</h4>
                <p>Your personal information will be handled in accordance with our Privacy Policy. We implement appropriate security measures to protect your data.</p>
                
                <h4>6. DISCLAIMER</h4>
                <p>CashMela is a loan aggregator platform. Final loan approval is subject to lender's terms and conditions. Interest rates, processing fees, and other charges are determined by the respective lenders.</p>
                
                <h4>7. INDEMNITY</h4>
                <p>User agrees to indemnify and hold harmless CashMela from any claims, damages, or losses arising from User's use of the platform or violation of these terms.</p>
                
                <p class="font-bold mt-6">By using CashMela's services, you agree to these Terms and Conditions.</p>
            </div>
            <div class="sticky bottom-0 bg-gray-50 border-t border-gray-200 p-6">
                <button onclick="closeTermsModal()" class="w-full bg-blue-600 text-white font-bold py-3 rounded-xl hover:bg-primary-600 transition">
                    I Understand
                </button>
            </div>
        </div>
    </div>

</body>
</html>
